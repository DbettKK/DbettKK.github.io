<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="JavaWeb初探Day 0125&#x2F;06&#x2F;2020 JAVA反射获取Class实例： 通过静态变量class获取，即直接通过类名获取  通过调用Class.forName(name)方法获取，传递类完整名称为参数  通过实例变量的getClass()方法获取   Class实例在JVM中是唯一的 12345678&#x2F;&#x2F; exampleClass c1 = String.class;Class c2">
<meta name="keywords" content="自学总结">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb初探">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;06&#x2F;25&#x2F;summer%20study&#x2F;index.html">
<meta property="og:site_name" content="Dbettkk-Blog">
<meta property="og:description" content="JavaWeb初探Day 0125&#x2F;06&#x2F;2020 JAVA反射获取Class实例： 通过静态变量class获取，即直接通过类名获取  通过调用Class.forName(name)方法获取，传递类完整名称为参数  通过实例变量的getClass()方法获取   Class实例在JVM中是唯一的 12345678&#x2F;&#x2F; exampleClass c1 = String.class;Class c2">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;26&#x2F;lHTBAeoknaLsbif.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;28&#x2F;pL6JzPvrkig4COR.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;28&#x2F;qF9RrU4kuT8ZGCb.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;qwGEeM6o1KBzSgk.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;WPFQOAz9i1ENkKC.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;w7TlOmZHXcECJY3.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;Te17gIh5qb2FHWE.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;5Cr37imLUd9pPsl.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;RhIEKGckm4Zg29a.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;TDbBVqmEUscFHMj.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;TN62RhXb5WA8auw.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;pOWiNGAd3E9mQVS.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;Oi2EqIUWygDaHVT.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;jDHpKeVcbIhOwRy.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;DP9KeVXEvQUcJ7M.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;HLTiF51eXWyPnrl.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;01&#x2F;jNO1Iy69mvubBMT.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;02&#x2F;tCNjacl82GwU5v6.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;02&#x2F;rW3h8gzknvsJeU1.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;02&#x2F;47i2GSkRPLAW3YB.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;03&#x2F;YzSxaTW74DgGftM.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;07&#x2F;03&#x2F;DTSVv3xPeZFXInH.png">
<meta property="og:updated_time" content="2020-07-03T12:01:00.937Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;26&#x2F;lHTBAeoknaLsbif.jpg">

<link rel="canonical" href="http://yoursite.com/2020/06/25/summer%20study/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>JavaWeb初探 | Dbettkk-Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Dbettkk-Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/25/summer%20study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bcutty Kmy">
      <meta itemprop="description" content="NO DEPENDENCE ONLY PRIDE">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dbettkk-Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JavaWeb初探
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-25 18:45:20" itemprop="dateCreated datePublished" datetime="2020-06-25T18:45:20+08:00">2020-06-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-03 20:01:00" itemprop="dateModified" datetime="2020-07-03T20:01:00+08:00">2020-07-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">学习篇</span></a>
                </span>
            </span>

          
            <span id="/2020/06/25/summer%20study/" class="post-meta-item leancloud_visitors" data-flag-title="JavaWeb初探" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/06/25/summer%20study/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/06/25/summer%20study/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="JavaWeb初探"><a href="#JavaWeb初探" class="headerlink" title="JavaWeb初探"></a>JavaWeb初探</h1><h2 id="Day-01"><a href="#Day-01" class="headerlink" title="Day 01"></a>Day 01</h2><p><em>25/06/2020</em></p>
<h3 id="JAVA反射"><a href="#JAVA反射" class="headerlink" title="JAVA反射"></a>JAVA反射</h3><h4 id="获取Class实例："><a href="#获取Class实例：" class="headerlink" title="获取Class实例："></a>获取Class实例：</h4><ul>
<li><p>通过静态变量class获取，即直接通过类名获取</p>
</li>
<li><p>通过调用Class.forName(name)方法获取，传递类完整名称为参数</p>
</li>
<li><p>通过实例变量的getClass()方法获取</p>
</li>
</ul>
<p>Class实例在JVM中是唯一的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example</span></span><br><span class="line">Class c1 = String<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Class c2 = Class.forName(<span class="string">"java.lang.String"</span>);</span><br><span class="line">String s = <span class="string">"hello"</span>;</span><br><span class="line">Class c3 = s.getClass();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可直接通过==符号判断两Class实例是否相同</span></span><br><span class="line"><span class="keyword">boolean</span> b = (c1 == c2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="访问字段"><a href="#访问字段" class="headerlink" title="访问字段"></a>访问字段</h4><ul>
<li>Field getField(name)：根据字段名获取某个public的field（包括父类）</li>
<li>Field getDeclaredField(name)：根据字段名获取当前类的某个field（不包括父类）</li>
<li>Field[] getFields()：获取所有public的field（包括父类）</li>
<li>Field[] getDeclaredFields()：获取当前类的所有field（不包括父类）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String num;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line">Field f1 = Student.class.getField("age");</span><br><span class="line">Field f2 = Student.class.getDeclaredField("num"); // 访问私有变量不能直接使用getField()方法</span><br></pre></td></tr></table></figure>

<p>Field对象的一些方法</p>
<ul>
<li><code>getName()</code>：返回字段名称，例如，<code>&quot;name&quot;</code>；</li>
<li><code>getType()</code>：返回字段类型，也是一个<code>Class</code>实例，例如，<code>String.class</code>；</li>
<li><code>getModifiers()</code>：返回字段的修饰符，它是一个<code>int</code>，不同的bit表示不同的含义。</li>
</ul>
<p>通过Field实例获取或修改字段的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 还是上面Student的例子</span></span><br><span class="line">Student s = <span class="keyword">new</span> Student();</span><br><span class="line">f1 = s.getclass().getField(<span class="string">"age"</span>);</span><br><span class="line">f2 = s.getclass().getDeclaredField(<span class="string">"age"</span>);</span><br><span class="line">Object value = f1.get(s); <span class="comment">// 获取age字段的值 此处为0</span></span><br><span class="line">f2.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object value = f2.get(s); <span class="comment">// 要想获得private修饰字段的值，需要使用setAccessible方法 不过这也不是万能的 有些是可以限制的</span></span><br><span class="line">f1.set(s, <span class="number">15</span>); <span class="comment">// 设置字段age的值 设置为15</span></span><br><span class="line">f2.set(s, <span class="string">"hello"</span>); <span class="comment">// 同理</span></span><br></pre></td></tr></table></figure>

<h4 id="获取方法"><a href="#获取方法" class="headerlink" title="获取方法"></a>获取方法</h4><ul>
<li><code>Method getMethod(name, Class...)</code>：获取某个<code>public</code>的<code>Method</code>（包括父类）</li>
<li><code>Method getDeclaredMethod(name, Class...)</code>：获取当前类的某个<code>Method</code>（不包括父类）</li>
<li><code>Method[] getMethods()</code>：获取所有<code>public</code>的<code>Method</code>（包括父类）</li>
<li><code>Method[] getDeclaredMethods()</code>：获取当前类的所有<code>Method</code>（不包括父类）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> a, String s)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">Method m1 = Student.class.getMethod("get");</span><br><span class="line">Method m2 = Student.class.getDeclaredMethod("set", int.class, String.class); // 后面的可变参数代表该方法的参数列表</span><br></pre></td></tr></table></figure>

<p>Method对象的一些方法：</p>
<ul>
<li><code>getName()</code>：返回方法名称，例如：<code>&quot;getScore&quot;</code>；</li>
<li><code>getReturnType()</code>：返回方法返回值类型，也是一个Class实例，例如：<code>String.class</code>；</li>
<li><code>getParameterTypes()</code>：返回方法的参数类型，是一个Class数组，例如：<code>{String.class, int.class}</code>；</li>
<li><code>getModifiers()</code>：返回方法的修饰符，它是一个<code>int</code>，不同的bit表示不同的含义。</li>
</ul>
<p>invoke()方法，对Mehtod实例调用该方法，相当于调用Method对应的实例的方法，第一个参数为对象实例，后面跟可变参数，即该方法的参数列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m1.invoke(); <span class="comment">// 相当于student.get()</span></span><br><span class="line">m2.setAccessible(<span class="keyword">true</span>); <span class="comment">// 和Field同理</span></span><br><span class="line">m2.invoke(<span class="number">1</span>, <span class="string">"jack"</span>);</span><br></pre></td></tr></table></figure>

<p>关于多态：</p>
<p>即在子类重写了父类方法时，反射机制又是如何呢？也同样遵循多态的原则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"p"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">P</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"c"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Method m = P.class.getMethod("prin");</span><br><span class="line">m.invoke(<span class="keyword">new</span> P()); <span class="comment">// p</span></span><br><span class="line">m.invoke(<span class="keyword">new</span> C()); <span class="comment">// c</span></span><br></pre></td></tr></table></figure>

<h4 id="调用构造方法"><a href="#调用构造方法" class="headerlink" title="调用构造方法"></a>调用构造方法</h4><p>通过反射创建实例：</p>
<ul>
<li><code>newInstance()方法</code>，要求该构造方法为public无参数构造方法</li>
<li>通过Constructor对象来实现能够调用任意的构造方法</li>
</ul>
<p>对于构造Constructor对象的方法：</p>
<ul>
<li><code>getConstructor(Class...)</code>：获取某个<code>public</code>的<code>Constructor</code>；</li>
<li><code>getDeclaredConstructor(Class...)</code>：获取某个<code>Constructor</code>；</li>
<li><code>getConstructors()</code>：获取所有<code>public</code>的<code>Constructor</code>；</li>
<li><code>getDeclaredConstructors()</code>：获取所有<code>Constructor</code>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Student s = Student<span class="class">.<span class="keyword">class</span>.<span class="title">newInstance</span>()</span>;</span><br><span class="line"><span class="comment">// Constructor</span></span><br><span class="line">Constructor c = Student<span class="class">.<span class="keyword">class</span>.<span class="title">getConstructor</span>(<span class="title">Student</span>.<span class="title">class</span>)</span>;</span><br><span class="line"><span class="comment">// 同样对于私有构造方法 需要调用setAccessible(true)方法</span></span><br><span class="line">Student s2 = (Student) c.newInstance(); <span class="comment">// 这里的newInstance方法可以传递参数 具体根据构造方法来对应</span></span><br></pre></td></tr></table></figure>

<h4 id="获取继承关系"><a href="#获取继承关系" class="headerlink" title="获取继承关系"></a>获取继承关系</h4><p>获取父类Class实例：</p>
<p>getSuperClass()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class i = <span class="keyword">int</span><span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Class n = i.getSuperClass(); <span class="comment">// 获取父类 也就是Number</span></span><br><span class="line">Class s = n.getSuperClass().getSuperClass(); <span class="comment">// 如果已经不存在父类 则返回null</span></span><br></pre></td></tr></table></figure>

<p>获取接口：</p>
<p>getInterfaces()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class i[] = <span class="keyword">int</span><span class="class">.<span class="keyword">class</span>.<span class="title">getInterfaces</span>()</span>; <span class="comment">// 因为存在多个接口 所以返回Class数组 </span></span><br><span class="line"><span class="comment">// 如果想获得父接口 也需要使用getInterfaces()方法 接口使用getSuperClass()方法会返回null</span></span><br></pre></td></tr></table></figure>

<p>两个Class对象判断是否为继承关系：</p>
<p>使用isAssignableFrom()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Number<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">Integer</span>.<span class="title">class</span>)</span>; <span class="comment">// true，因为Integer可以赋值给Number</span></span><br><span class="line"><span class="comment">// 可以类比instanceof</span></span><br></pre></td></tr></table></figure>

<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>可以在运行期动态创建某个<code>interface</code>的实例。</p>
<p>JDK提供的动态创建接口对象的方式，就叫动态代理。</p>
<p>即可以实现在不编写实现类的情况下，创建接口的实例。利用Proxy.newProxyInstance()方法</p>
<p>在运行期动态创建一个<code>interface</code>实例的方法如下：</p>
<ol>
<li>定义一个<code>InvocationHandler</code>实例，它负责实现接口的方法调用；</li>
<li>通过Proxy.newProxyInstance()创建interface实例，它需要3个参数：<ol>
<li>使用的<code>ClassLoader</code>，通常就是接口类的<code>ClassLoader</code>；</li>
<li>需要实现的接口数组，至少需要传入一个接口进去；</li>
<li>用来处理接口方法调用的<code>InvocationHandler</code>实例。</li>
</ol>
</li>
<li>将返回的<code>Object</code>强制转型为接口。</li>
</ol>
<p>但实质其实就是JDK帮我们自动编写了一个上述类（不需要源码，可以直接生成字节码），并不存在可以直接实例化接口的黑魔法。</p>
<p>参考：廖雪峰博客-Java</p>
<hr>
<h2 id="Day-02"><a href="#Day-02" class="headerlink" title="Day 02"></a>Day 02</h2><p><em>26/06/2020</em></p>
<h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><p>定义：XML全称为Extensible Markup Language，意思是可扩展的标记语言。XML语法上和HTML比较相似，但HTML中的元素是固定的，而XML的标签是可以由用户自定义的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--部分xml 例子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"1001"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>zhangSan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>23<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sex</span>&gt;</span>male<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">teacher</span> <span class="attr">name</span>=<span class="string">"liSi"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wife</span> <span class="attr">id</span>=<span class="string">"xxx"</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">wife</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">teacher</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="XML语法"><a href="#XML语法" class="headerlink" title="XML语法"></a>XML语法</h4><p>文档声明：</p>
<ul>
<li><p>文档声明必须为<code>&lt;?xml</code>开头，以<code>?&gt;</code>结束；</p>
</li>
<li><p>文档声明必须从文档的0行0列位置开始；</p>
</li>
<li><p>文档声明只有三个属性：</p>
<ul>
<li><p>versioin：指定XML文档版本。必须属性，因为我们不会选择1.1，只会选择1.0；</p>
</li>
<li><p>encoding：指定当前文档的编码。可选属性，默认值是utf-8；</p>
</li>
<li><p>standalone：指定文档独立性。可选属性，默认值为yes，表示当前文档是独立文档。如果为no表示当前文档不是独立的文档，会依赖外部文件。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>元素</strong></p>
<p>元素是XML文档中最重要的组成部分：</p>
<ul>
<li><p>普通元素的结构：开始标签、元素体、结束标签，例如：<code>&lt;hello&gt;大家好&lt;/hello&gt;</code>；</p>
</li>
<li><p>元素体：元素体可以是元素，也可以是文本，例如：<code>&lt;b&gt;&lt;a&gt;你好&lt;/a&gt;&lt;/b&gt;</code>，其中<code>&lt;b&gt;</code>元素的元素体是<code>&lt;a&gt;</code>元素，而<code>&lt;a&gt;</code>元素的元素体是文本；</p>
</li>
<li><p>空元素：空元素只有开始标签，而没有结束标签，例如：<code>&lt;c/&gt;</code>，但元素必须自己闭合。</p>
</li>
</ul>
<p>元素属性：</p>
<ul>
<li><p>属性是元素的一部分，它必须出现在元素的开始标签中；</p>
</li>
<li><p>属性的定义格式：属性名=属性值，其中属性值必须使用单引或双引；</p>
</li>
<li><p>一个元素可以有0~N个属性，但一个元素中不能出现同名属性；</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"1001"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--.......--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>转义</strong></p>
<p>转义字符：例如<code>&lt;</code>,<code>&gt;</code>等等这类符号，需要使用相应的转义字符来代替。例如：<code>&lt;</code>用<code>&amp;lt;</code>代替。</p>
<p>CDATA段：由于使用转义字符会大大降低XML文档可读性，使用CDATA段就不会有这种问题，格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>&lt;![CDATA[&lt;a&gt;]]&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，在CDATA段中不能包含”]]&gt;”，即CDATA段的结束定界符。</p>
<p><strong>处理指令</strong></p>
<p>处理指令，简称PI（Processing instruction）。处理指令用来指挥解析器如何解析XML文档内容。</p>
<p>例如，在XML文档中可以使用xml-stylesheet指令，通知XML解析器，应用css文件显示xml文档内容。</p>
<p>放于文档声明下方</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="gbk"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/css" href="a.css"?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>格式</strong></p>
<p>格式良好的XML就是格式正确的XML文档，只有XML的格式是良好的，XML解释器才能解释它。下面是对格式良好XML文档的要求：</p>
<ul>
<li><p>必须要有XML文档声明；</p>
</li>
<li><p>必须且仅能有一个根元素；</p>
</li>
<li><p>元素和属性的命名必须遵循XML要求：</p>
<ul>
<li><p>XML命名区分大小写，例如<code>&lt;a&gt;</code>和<code>&lt;A&gt;</code>是两上不同的元素；</p>
</li>
<li><p>名称中可以包含：字母、数字、下划线、减号，但不能以数字、减号开头；</p>
</li>
<li><p>不能以xml开头，无论是大写还是小写都不可以，例如<code>&lt;xml&gt;</code>、<code>&lt;Xml&gt;</code>、<code>&lt;XML&gt;</code>都是错误的；</p>
</li>
<li><p>不能包含空格，例如<code>&lt;ab cd&gt;</code>是错误的。</p>
</li>
</ul>
</li>
<li><p>元素之间必须合理包含，例如：<code>&lt;a&gt;&lt;b&gt;xxx&lt;/b&gt;&lt;/a&gt;</code>是合理的，而<code>&lt;a&gt;&lt;b&gt;xxx&lt;/a&gt;&lt;/b&gt;</code>就是错误的包含。</p>
</li>
</ul>
<h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><p>定义：DTD（Document Type Definition），文档类型定义，用来约束XML文档。或者可以把DTD理解为创建XML文档的结构！例如可以用DTD要求XML文档的根元素名为<code>&lt;students&gt;</code>，<code>&lt;students&gt;</code>中可以有1~N个<code>&lt;student&gt;</code>，<code>&lt;student&gt;</code>子元素为<code>&lt;name&gt;</code>、<code>&lt;age&gt;</code>和<code>&lt;sex&gt;</code>，<code>&lt;student&gt;</code>元素还有number属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--例子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">students</span> (<span class="attr">student</span>+)&gt;</span>	<span class="comment">&lt;!--students元素包含1-n个student元素--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">student</span> (<span class="attr">name</span>,<span class="attr">age</span>,<span class="attr">sex</span>)&gt;</span>	<span class="comment">&lt;!--内容依次为name age sex三个元素--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">name</span> (#<span class="attr">PCDATA</span>)&gt;</span>	<span class="comment">&lt;!--定义name元素内容为文本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">age</span> (#<span class="attr">PCDATA</span>)&gt;</span>	<span class="comment">&lt;!--定义age元素内容为文本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">sex</span> (#<span class="attr">PCDATA</span>)&gt;</span>	<span class="comment">&lt;!--定义sex元素内容为文本--&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><ul>
<li><p>内部DTD：在XML文档内部嵌入DTD，只对当前XML文档有效；</p>
</li>
<li><p>外部DTD：独立的DTD文件，扩展名为.dtd；</p>
<ul>
<li><p>本地DTD：DTD文件在本地，不在网络上。自己项目，或本公司内部使用的；</p>
</li>
<li><p>公共DTD：DTD文件在网络上，不在本地。都是大公司或组织发布的，共大家使用！</p>
</li>
</ul>
</li>
</ul>
<p>内部DTD</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" standalone="yes" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--内部DTD例子--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE students [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT students (student+)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT student (name, age, sex)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT age (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT sex (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">students</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>zhangSan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">age</span>&gt;</span>23<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">sex</span>&gt;</span>male<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>位置：内部DTD在文档声明下面，在根元素上面；</p>
</li>
<li><p>语法格式：放到<code>&lt;!DOCTYPE 根元素名称[ ]&gt;</code>之间；</p>
</li>
<li><p>只对当前XML文档有效；</p>
</li>
</ul>
<p>本地DTD</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" standalone="no" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE students SYSTEM "students.dtd"&gt;</span>	<span class="comment">&lt;!--此处为dtd文件路径--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">students</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>zhangSan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">age</span>&gt;</span>23<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">sex</span>&gt;</span>male<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>位置：本地硬盘上；</p>
</li>
<li><p>语法格式：直接定义元素或属性即可；</p>
</li>
<li><p>本地所有XML文档都可以引用这个dtd文件；</p>
</li>
</ul>
<p>公共DTD</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" standalone="no" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE students PUBLIC "-//qdmmy6//DTD ST 1.0//ZH" "http://www.qdmmy6.com/xml/dtds/st.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">students</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>zhangSan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">age</span>&gt;</span>23<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">sex</span>&gt;</span>male<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>格式为：<code>&lt;!DOCTYPE 根元素 PUBLIC &quot;DTD名称&quot; &quot;DTD网址&quot;&gt;</code></p>
<h4 id="DTD语法"><a href="#DTD语法" class="headerlink" title="DTD语法"></a>DTD语法</h4><h5 id="定义元素"><a href="#定义元素" class="headerlink" title="定义元素"></a>定义元素</h5><p>定义元素语法：<code>&lt;!ELEMENT 元素名 元素描述&gt;</code></p>
<ul>
<li><p><code>&lt;!ELEMENT name (#PCDATA)&gt;</code>，定义名为name的元素，内容为文本类型。</p>
</li>
<li><p><code>&lt;!ELEMENT student (name,age,sex)&gt;</code>，定义名为student元素，内容依次为name、age、sex元素；</p>
</li>
<li><p><code>&lt;!ELEMENT student ANY&gt;</code>，定义名为student元素，内容任意；</p>
</li>
<li><p><code>&lt;!ELEMENT student EMPTY&gt;</code>，定义名为student元素，不能有内容，即空元素，注意空元素是可以有属性的。 </p>
</li>
</ul>
<p>子元素出现次数</p>
<p>可以使用<code>*</code>、<code>+</code>、<code>?</code>来指定子元素出现的次数</p>
<p><code>*</code>：可以出现0~N次；<code>+</code>：可以出现1~N次；<code>?</code>：可以出现0~1次。</p>
<p>例如：<code>&lt;!ELEMENT student(name,age?,hobby*,grade+) &gt;</code>，定义student元素，第一子元素为name，必须且仅能出现一次，age是可有可无的，hobby可以出现0<del>N次，grade可以出现1</del>N次。</p>
<p>枚举类型子元素</p>
<p><code>&lt;!ELEMENT student (name | age | sex)&gt;</code>，表示student子元素为name、age、sex其中之一，必须仅且能选择其一。</p>
<h5 id="定义属性"><a href="#定义属性" class="headerlink" title="定义属性"></a>定义属性</h5><p>定义属性的语法：</p>
<p><code>&lt;!ATTLIST 元素名 属性名 属性类型 设置说明&gt;</code></p>
<p>例如：<code>&lt;!ATTLIST student number CDATA #REQUIRED&gt;</code>，给student元素定义属性number，类型为文本，这个默认是必须的。</p>
<p>属性设置说明：</p>
<p><code>#REQUIRED</code>：说明属性是必须的；<code>#IMPLIED</code>：说明属性是可选的；<code>默认值</code>：在不给出属性值时，使用默认值。</p>
<p> 属性的类型：</p>
<ul>
<li><p><code>CDATA</code>：文本类型；</p>
</li>
<li><p><code>Enumerated</code>：枚举类型；</p>
</li>
<li><p><code>ID</code>：ID类型，ID类型的属性用来标识元素的唯一性，即元素的ID属性值不能与其他元素的ID属性值相同；</p>
</li>
<li><p><code>IDREF</code>：ID引用类型，用来指定另一个元素，与另一个元素建立关联关系，IDREF类型的属性值必须是另一个元素的ID。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--例子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">students</span> (<span class="attr">student</span>+) &gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">student</span> <span class="attr">EMPTY</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">number</span> <span class="attr">ID</span> #<span class="attr">REQUIRED</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">name</span> <span class="attr">CDATA</span> #<span class="attr">REQUIRED</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">sex</span> (<span class="attr">male</span> | <span class="attr">female</span>) "<span class="attr">male</span>" &gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">friend</span> <span class="attr">IDREF</span> #<span class="attr">IMPLIED</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--上面为students.dtd文件内容--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE students SYSTEM "students.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">students</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"itcast_001"</span> <span class="attr">name</span>=<span class="string">"zhangSan"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"itcast_002"</span> <span class="attr">name</span>=<span class="string">"liSi"</span> <span class="attr">sex</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"itcast_003"</span> <span class="attr">name</span>=<span class="string">"wangWu"</span> <span class="attr">sex</span>=<span class="string">"female"</span> <span class="attr">friend</span>=<span class="string">"itcast_002"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="定义实体"><a href="#定义实体" class="headerlink" title="定义实体"></a>定义实体</h5><p>将多而长的字符串定义为用简单符号表示的实体，从而在使用时只用使用该符号就可以了，方便且简洁。</p>
<p>实体分为两种：一般实体和参数实体。</p>
<ul>
<li><p>一般实体：在XML文档中使用；</p>
<ul>
<li>定义一般实体：<code>&lt;!ENTITY 实体名 &quot;实体值&quot;&gt;</code>，例如：<code>&lt;!ENTITY 大美女 &quot;白冰&quot;&gt;</code>；</li>
<li>一般实体引用：<code>&amp;实体名;</code>，例如<code>&lt;xxx&gt;&amp;大美女;&lt;/xxx&gt;</code>。</li>
</ul>
</li>
<li><p>参数实体：在DTD使用。</p>
<ul>
<li>定义参数实体：<code>&lt;!ENTITY % 实体名 &quot;实体值&quot;&gt;</code>，”%”与实体名之间的空格是必须的；例如：<code>&lt;!ENTITY % friend &quot;student friend IDREF #IMPLIED&quot;&gt;</code></li>
<li>参数实体引用：<code>%实体名;</code>；例如：<code>&lt;!ATTLIST %friend;&gt;</code></li>
</ul>
</li>
</ul>
<p>参数实体是在DTD内部使用，而不是在XML中使用。在内部DTD中使用参数实体会有诸多限制</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--参数实体例子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">students</span> (<span class="attr">student</span>+) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">student</span> <span class="attr">EMPTY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">number</span> <span class="attr">ID</span> #<span class="attr">REQUIRED</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">name</span> <span class="attr">CDATA</span> #<span class="attr">REQUIRED</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ATTLIST</span> <span class="attr">student</span> <span class="attr">sex</span> (<span class="attr">male</span> | <span class="attr">female</span>) "<span class="attr">male</span>"&gt;</span></span><br><span class="line">&lt;!ENTITY % friend "&lt;!ATTLIST student friend IDREF #IMPLIED&gt;"&gt;	&lt;!--定义--&gt;</span><br><span class="line">%friend;	<span class="comment">&lt;!--使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ENTITY</span> <span class="attr">itcast</span> "北京传智播客教育科技有限公司"&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><p>特点：</p>
<ul>
<li><p>Schema是新的XML文档约束；</p>
</li>
<li><p>Schema要比DTD强大很多；</p>
</li>
<li><p>Schema本身也是XML文档，但Schema文档的扩展名为xsd，而不是xml。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--students.xsd--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">"http://www.itcast.cn/xml"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">targetNamespace</span>=<span class="string">"http://www.itcast.cn/xml"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span>&gt;</span>	<span class="comment">&lt;!--指定名称空间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"students"</span> <span class="attr">type</span>=<span class="string">"studentsType"</span>/&gt;</span>	<span class="comment">&lt;!--定义studentsType类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:complexType</span> <span class="attr">name</span>=<span class="string">"studentsType"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:sequence</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"student"</span> <span class="attr">type</span>=<span class="string">"studentType"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span> <span class="attr">maxOccurs</span>=<span class="string">"unbounded"</span>/&gt;</span>	<span class="comment">&lt;!--指定其包含的student元素数目--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:sequence</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:complexType</span> <span class="attr">name</span>=<span class="string">"studentType"</span>&gt;</span>	<span class="comment">&lt;!--定义studentType类型--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:sequence</span>&gt;</span>	<span class="comment">&lt;!--指定其元素按顺序出现--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"ageType"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">type</span>=<span class="string">"sexType"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:sequence</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"number"</span> <span class="attr">type</span>=<span class="string">"numberType"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span>	<span class="comment">&lt;!--指定其包含的属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:simpleType</span> <span class="attr">name</span>=<span class="string">"sexType"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:restriction</span> <span class="attr">base</span>=<span class="string">"xsd:string"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span>	<span class="comment">&lt;!--指定枚举选项--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:restriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:simpleType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:simpleType</span> <span class="attr">name</span>=<span class="string">"ageType"</span>&gt;</span>	<span class="comment">&lt;!--定义ageType类型--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:restriction</span> <span class="attr">base</span>=<span class="string">"xsd:integer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:minInclusive</span> <span class="attr">value</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:maxInclusive</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span>	<span class="comment">&lt;!--指定范围--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:restriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:simpleType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:simpleType</span> <span class="attr">name</span>=<span class="string">"numberType"</span>&gt;</span>	<span class="comment">&lt;!--定义numberType类型--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:restriction</span> <span class="attr">base</span>=<span class="string">"xsd:string"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:pattern</span> <span class="attr">value</span>=<span class="string">"ITCAST_\d&#123;4&#125;"</span>/&gt;</span>	<span class="comment">&lt;!--正则表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:restriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:simpleType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--students.xml--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">students</span> <span class="attr">xmlns</span>=<span class="string">"http://www.itcast.cn/xml"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.itcast.cn/xml students.xsd"</span> &gt;</span>	<span class="comment">&lt;!--指定约束文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"ITCAST_1001"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>zhangSan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>20<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sex</span>&gt;</span>male<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">student</span> <span class="attr">number</span>=<span class="string">"ITCAST_1002"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>liSi<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>25<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sex</span>&gt;</span>female<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">students</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="schema名称空间"><a href="#schema名称空间" class="headerlink" title="schema名称空间"></a>schema名称空间</h4><p>名称空间定义：如果一个XML文档中使用多个Schema文件，而这些Schema文件中定义了相同名称的元素时就会出现名字冲突。这就像一个Java文件中使用了import java.util.*和import java.sql.*时，在使用Date类时，那么就不明确Date是哪个包下的Date了。</p>
<p>总之名称空间就是用来处理元素和属性的名称冲突问题，与Java中的包是同一用途。如果每个元素和属性都有自己的名称空间，那么就不会出现名字冲突问题，就像是每个类都有自己所在的包一样，那么类名就不会出现冲突。</p>
<h5 id="目标名称空间"><a href="#目标名称空间" class="headerlink" title="目标名称空间"></a>目标名称空间</h5><p>在XSD文件中为定义的元素指定名称，即指定目标名称空间。这需要给<code>&lt;xsd:schema&gt;</code>元素添加<code>targetNamespace</code>属性。</p>
<p>例如：<code>&lt;xsd:schema targetNamespace=&quot;http://www.itcast.cn/xml&quot;&gt;</code></p>
<p>名称空间可以是任意字符串，但通常我们会使用公司的域名作为名称空间，这与Java中的包名使用域名的倒序是一样的！千万不要以为这个域名是真实的，它可以是不存在的域名。</p>
<p>如果每个公司发布的Schema都随意指定名称空间，如a、b之类的，那么很可能会出现名称空间的名字冲突，所以还是使用域名比较安全，因为域名是唯一的。</p>
<p>当使用了<code>targetNamespace</code>指定目标名称空间后，那么当前XSD文件中定义的元素和属性就在这个名称空间之中了。</p>
<h5 id="XML指定XSD文件"><a href="#XML指定XSD文件" class="headerlink" title="XML指定XSD文件"></a>XML指定XSD文件</h5><p>在XML文件中需要指定XSD约束文件，这需要使用在根元素中使用<code>schemaLocation</code>属性来指定XSD文件的路径，以及目标名称空间。格式为：<code>schemaLocation=&quot;目标名称空间 XSD文件路径&quot;</code></p>
<p>例如：<code>&lt;students schemaLocation=&quot;http://www.itcast.cn/xml students.xsd&quot;&gt;</code></p>
<p><code>schemaLocation</code>是用来指定XSD文件的路径，也就是说为当前XML文档指定约束文件。但它不只要指定XSD文件的位置，还要指定XSD文件的目标名称空间。</p>
<p>其中<code>http://www.itcast.cn/xml</code>为目标名称空间，<code>students.xsd</code>为XSD文件的位置，它们中间使用空白符（空格或换行）分隔。</p>
<p>也可以指定多个XSD文件，格式为：</p>
<p><code>schemaLocation=&quot;目标名称空间1 XSD文件路径1 目标名称空间2 XSD文件路径2&quot;</code></p>
<p>下面是spring配置文件的例子，它一共指定两个XSD文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="定义名称空间"><a href="#定义名称空间" class="headerlink" title="定义名称空间"></a>定义名称空间</h5><p>现在我们已经知道一个XML中可以指定多个XSD文件，例如上面Spring的配置文件中就指定了多个XSD文件，那么如果我在<code>&lt;beans&gt;</code>元素中给出一个子元素<code>&lt;bean&gt;</code>，你知道它是哪个名称空间中的么？显然是无法知道的。</p>
<p>所以只是使用<code>schemaLocation</code>指定XSD是不够的，它只是导入了这个XSD及XSD的名称空间而已。<code>schemaLocation</code>的作用就相当于Java中导入Jar包的作用！最终还是在Java文件中使用import来指定包名的。</p>
<p><code>xmlns</code>是用来指定名称空间前缀的，所谓前缀就是”简称”，例如中华人民共和国简称中国一样，然后我们在每个元素前面加上前缀，就可以处理名字冲突了。</p>
<p>格式为：<code>xmln:前缀=&quot;名称空间&quot;</code></p>
<p>注意，使用<code>xmlns</code>指定的名称空间必须是在<code>schemaLocation</code>中存在的名称空间。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:b</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line">xmlns:aop="http://www.springframework.org/schema/aop"	&lt;!--这里指定了两个前缀--&gt;</span><br><span class="line">    xsi:schemaLocation="http://www.springframework.org/schema/beans </span><br><span class="line">                      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd </span><br><span class="line">                      http://www.springframework.org/schema/aop </span><br><span class="line">                      http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">b:bean</span>&gt;</span><span class="tag">&lt;/<span class="name">b:bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="默认名称空间"><a href="#默认名称空间" class="headerlink" title="默认名称空间"></a>默认名称空间</h5><p>在一个XML文件中，可以指定一个名称空间没有前缀，那么在当前XML文档中没有前缀的元素就来自默认名称空间。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span></span></span><br><span class="line">xmlns="http://www.springframework.org/schema/beans"	&lt;!--默认名称空间--&gt;</span><br><span class="line">xmlns:aop="http://www.springframework.org/schema/aop"</span><br><span class="line">    xsi:schemaLocation="http://www.springframework.org/schema/beans </span><br><span class="line">                      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd </span><br><span class="line">                      http://www.springframework.org/schema/aop </span><br><span class="line">                      http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>	<span class="comment">&lt;!--使用默认名称空间--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="W3C的元素和属性"><a href="#W3C的元素和属性" class="headerlink" title="W3C的元素和属性"></a>W3C的元素和属性</h5><p>如果我们的XML文件中需要使用W3C提供的元素和属性，那么可以不在schemaLocation属性中指定XSD文件的位置，但一定要定义名称空间，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"	&lt;!--指定名称空间--&gt;</span><br><span class="line">      xsi:schemaLocation="http://www.springframework.org/schema/beans </span><br><span class="line">                      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd </span><br><span class="line">                      http://www.springframework.org/schema/aop </span><br><span class="line">                      http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"&gt;</span><br><span class="line">				<span class="comment">&lt;!--这里无需指定--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面定义了一个名称空间，前缀为xsi，名称空间为<code>http://www.w3.org/2001/XMLSchema-instance</code>。这个名称空间无需在<code>schemaLocation</code>中存在。</p>
<p>你可能已经发现了，<code>schemaLocation</code>这个属性其实是w3c定义的属性，与元素一定，属性也需要指定”出处”，<code>xsi:schemaLocation</code>中的<code>xsi</code>就是名称空间前缀。也就是说，上面我们在没有指定<code>xsi</code>名称空间时，就直接使用<code>schemaLocation</code>是错误的。也就是在上面其他的例子中，我们是没有指明<code>xsi</code>代表什么的，所以就是错误的，因为不存在<code>xsi</code>这个前缀。</p>
<h3 id="XML解析器"><a href="#XML解析器" class="headerlink" title="XML解析器"></a>XML解析器</h3><h4 id="DOM-and-SAX-简介"><a href="#DOM-and-SAX-简介" class="headerlink" title="DOM and SAX 简介"></a>DOM and SAX 简介</h4><p>定义：XML是保存数据的文件，XML中保存的数据也需要被程序读取然后使用。那么程序使用什么来读取XML文件中的数据呢？XML解析器！例如.properties文件的解析器是Properties类一样！</p>
<p>XML不只被Java语言使用，还被C++、C#、Javascript等等语言使用，所以解析XML不是一门语言的工作！</p>
<p>主流的XML解析有两种标准：DOM和SAX。它们是标准，是思想，不是真正的解析器，它们是跨语言的！！！</p>
<ul>
<li><p>DOM（Document Object Model）：W3C组织提供的解析XML文档的标准接口；</p>
</li>
<li><p>SAX（Simple API for XML）：社区讨论的产物，是一种事实上的标准。</p>
</li>
</ul>
<p>Apache的xerces组件实现了DOM和SAX，所以在我们在Java中解析XML需要使用xerces。所以我们称xerces是DOM、SAX解析器。</p>
<p><strong>DOM解析原理</strong></p>
<p>DOM要求解析器把整个XML文档装载到一个Document对象中。即使用DOM解析器解析XML文档的结果就是一个Document对象。</p>
<p>一个XML文档解析后对应一个Document对象，可以通过Document对象获取根元素，然后在通过根元素获取根元素的子元素…，这说明DOM解析方式保留了元素之间的结构关系！</p>
<ul>
<li><p>优点：元素与元素之间的结构关系保留了下来；</p>
</li>
<li><p>缺点：如果XML文档过大，那么把整个XML文档装载进内存，可能会出现内存溢出的现象！</p>
</li>
</ul>
<p><strong>SAX解析原理</strong></p>
<p>DOM解析后的结果是一个Document对象，而SAX解析没有结果！SAX要求在开始解析之前用户提供一个接口的实现对象，然后把接口实现对象传递给SAX解析器，然后在SAX解析器的过程中不断调用实现对象的方法。</p>
<ul>
<li><p>DOM是解析时把数据放到了Document对象中，然后用户从Document中获取需要的数据；</p>
</li>
<li><p>SAX要求用户参与到解析过程中来，把想要做的事情写到接口实现对象中，然后SAX在解析过程中来调用接口实现对象的方法。</p>
</li>
</ul>
<p>SAX解析器会在解析XML文档的过程中，在发生特定事件时，调用接口中特定的方法。例如在SAX解析到某个元素的开始标签时，输出元素名称！其中解析到开始标签就是特定的事件，而输出元素名称，就是接口中方法的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口中方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startDocument</span><span class="params">()</span></span>;	<span class="comment">// 开始解析时调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endDocument</span><span class="params">()</span></span>;	<span class="comment">// 结束解析时调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String qName, Attibutes atts)</span></span>;	<span class="comment">// 遇到元素开始标签调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String qName)</span>	<span class="comment">// 遇到元素结束标签调用</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">characters</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span></span>;	<span class="comment">// 遇到文本内容调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ignorableWhitespace</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span></span>;	<span class="comment">// 遇到元素和元素之间空白调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processingInstruction</span><span class="params">(String target, String data)</span></span>;	<span class="comment">// 遇到处理指令时调用</span></span><br></pre></td></tr></table></figure>

<p>接口的实现由我们来完成，然后我们需要把接口实现类对象”交给”SAX解析器，然后让SAX开始解析。SAX会在特定事件发生时，调用接口中的方法，完成我们交给它的任务。</p>
<ul>
<li><p>优点：适合解析大XML文件（内存空间占用小），因为是解析一行处理一行，处理完了就不需要在保留数据了；</p>
</li>
<li><p>缺点：因为是解析一行处理一行，解析之后数据就丢失了，所以元素与元素之间的结构关系没有保留下来。</p>
</li>
</ul>
<p><strong>JAXP</strong></p>
<p>JAXP（Java API for XML Processing）是由Java提供的，JAXP是对所有像xerces一样的解析的提供统一接口的API。</p>
<p>当我们使用JAXP完成解析工作时，还需要为JAXP指定xerces或其他解析器，当需要更换解析器时，无需修改代码，只需要修改配置即可。</p>
<p>JAXP不是解析器，但使用它可以方便的切换解析器。所以在我们的程序中只会使用JAXP，而不会直接使用Xeces。</p>
<p><strong>JDOM和DOM4j</strong></p>
<p>DOM和SAX是跨语言的XML解析准备，在Java中使用并不方便。而JDOM和DOM4j是专门为Java语言提供的解析工具！使用起来很方便，所以真实开发中使用JDOM或DOM4J比较多。</p>
<p>又因为DOM4J与JDOM比较结果为DOM4j完胜，所以这里只会对DOM4j介绍，而不会介绍JDOM。</p>
<h4 id="DOM-和-SAX-解析"><a href="#DOM-和-SAX-解析" class="headerlink" title="DOM 和 SAX 解析"></a>DOM 和 SAX 解析</h4><p>DOM中的核心概念就是节点，在XML文档中的元素、属性、文本、处理指令，在DOM中都是节点！ </p>
<h5 id="JAXP-DOM"><a href="#JAXP-DOM" class="headerlink" title="JAXP-DOM"></a>JAXP-DOM</h5><p>使用DOM解析XML的目标就是获取到Document对象，然后在从Document中获取到需要的数据。Document对象就是XML文档在内存中的样子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取Document对象 三步</span></span><br><span class="line">DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();	<span class="comment">// 获取工厂</span></span><br><span class="line">DocumentBuilder builder = factory.newDocumentBuilder();	<span class="comment">// 获取解析器</span></span><br><span class="line">Document document = builder.parse(<span class="keyword">new</span> File(<span class="string">"students.xml"</span>));	<span class="comment">// 解析xml获得Document</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历Document</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> <span class="keyword">throws</span> SAXException, IOException, ParserConfigurationException </span>&#123;</span><br><span class="line">    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span><br><span class="line">    DocumentBuilder builder = factory.newDocumentBuilder();</span><br><span class="line">    Document document = builder.parse(<span class="keyword">new</span> File(<span class="string">"src/students.xml"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取根元素</span></span><br><span class="line">    Element rootEle = document.getDocumentElement();</span><br><span class="line">    <span class="comment">// 获取元素的所有子节点</span></span><br><span class="line">    NodeList nodeList = rootEle.getChildNodes();</span><br><span class="line">    <span class="comment">// 循环遍历所有节点</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) &#123;</span><br><span class="line">        <span class="comment">// 获取其中每个节点</span></span><br><span class="line">        Node node = nodeList.item(i);</span><br><span class="line">        <span class="comment">// 判断节点的类型是否为元素</span></span><br><span class="line">        <span class="keyword">if</span>(node.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">            <span class="comment">// 强转成元素类型</span></span><br><span class="line">            Element stuEle = (Element) node;</span><br><span class="line">            <span class="comment">// 获取元素的名称</span></span><br><span class="line">            String eleName = stuEle.getNodeName();</span><br><span class="line">            <span class="comment">// 获取元素的number属性值</span></span><br><span class="line">            String number = stuEle.getAttribute(<span class="string">"number"</span>);</span><br><span class="line">            <span class="comment">// 获取名为name的子元素，因为返回值为NodeList，</span></span><br><span class="line">            <span class="comment">// 所以需要使用item(0)方法获取第一个name子元素</span></span><br><span class="line">            <span class="comment">// getTextContent()是获取节点的文本内容</span></span><br><span class="line">            String name = stuEle.getElementsByTagName(<span class="string">"name"</span>).item(<span class="number">0</span>).getTextContent();</span><br><span class="line">            String age = stuEle.getElementsByTagName(<span class="string">"age"</span>).item(<span class="number">0</span>).getTextContent();</span><br><span class="line">            String sex = stuEle.getElementsByTagName(<span class="string">"sex"</span>).item(<span class="number">0</span>).getTextContent();</span><br><span class="line"></span><br><span class="line">            System.out.println(eleName + <span class="string">":[number="</span> + number + <span class="string">", name="</span> + name + <span class="string">", age="</span> + age + <span class="string">", sex="</span> + sex + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="JAXP-SAX"><a href="#JAXP-SAX" class="headerlink" title="JAXP-SAX"></a>JAXP-SAX</h5><p>使用SAX解析XML文档需要先给出DefaultHandler的子类，重写其中的方法。然后在使用SAX开始解析时把DefaultHandler子类对象传递给SAX解析器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyContentHandler</span> <span class="keyword">extends</span> <span class="title">DefaultHandler</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"开始解析..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"解析结束..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String qName,</span></span></span><br><span class="line"><span class="function"><span class="params">			Attributes atts)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">		System.out.println(qName + <span class="string">"元素解析开始"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String qName)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">		System.out.println(qName + <span class="string">"元素解析结束"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">characters</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">		System.out.print(<span class="keyword">new</span> String(ch, start, length).trim());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用SAX解析首先需要获取工厂，再通过工厂获取解析器对象，然后使用解析对象完成解析工作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SAXParserFactory factory = SAXParserFactory.newInstance();</span><br><span class="line">SAXParser parser = factory.newSAXParser();</span><br><span class="line">parser.parse(<span class="keyword">new</span> File(<span class="string">"src/students.xml"</span>), <span class="keyword">new</span> MyContentHandler());</span><br></pre></td></tr></table></figure>

<h4 id="DOM4j-解析"><a href="#DOM4j-解析" class="headerlink" title="DOM4j 解析"></a>DOM4j 解析</h4><p>DOM4J是针对Java开发人员专门提供的XML文档解析规范，它不同与DOM，但与DOM相似。DOM4J针对Java开发人员而设计，所以对于Java开发人员来说，使用DOM4J要比使用DOM更加方便。</p>
<p>在DOM4J中，也有Node、Document、Element等接口，结构上与DOM中的接口比较相似。但它们是不同的类：</p>
<p><img src="https://i.loli.net/2020/06/26/lHTBAeoknaLsbif.jpg" alt="img"></p>
<p>Node</p>
<ul>
<li><p>Attribute：表示属性节点；</p>
</li>
<li><p>Branch：表示可以包含子元素的节点：</p>
<ul>
<li>Document：表示整个文档；</li>
<li>Element：表示元素节点；</li>
</ul>
</li>
<li><p>CharacterData：表示文本节点：</p>
<ul>
<li>Text：表示文本内容；</li>
<li>CDATA：表示CDATA段内容；</li>
<li>Comment：表示注释内容。</li>
</ul>
</li>
</ul>
<p>再次强调，DOM和DOM4J是不同的，DOM中的Document是org.w3c.Document，而DOM4J中的Document是org.dom4j.Document，它们是不同的类，其他Node、Element也是一样。</p>
<h5 id="读取、保存、创建Document"><a href="#读取、保存、创建Document" class="headerlink" title="读取、保存、创建Document"></a>读取、保存、创建Document</h5><p>使用dom4j需要导入：</p>
<ul>
<li><p>dom4j.jar</p>
</li>
<li><p>jaxen.jar</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取</span></span><br><span class="line">SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存xml文档</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建格式化器，使用\t缩进，添加换行</span></span><br><span class="line">OutputFormat format = <span class="keyword">new</span> OutputFormat(<span class="string">"\t"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 清空数据中原有的换行</span></span><br><span class="line">format.setTrimText(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 创建XML输出流对象</span></span><br><span class="line">XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileWriter(<span class="string">"src/a.xml"</span>), format);</span><br><span class="line"><span class="comment">// 输出Document</span></span><br><span class="line">writer.write(doc);</span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Document</span></span><br><span class="line">Document doc = DocumentHelper.createDocument();</span><br></pre></td></tr></table></figure>

<p>遍历Document</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> <span class="keyword">throws</span> DocumentException </span>&#123;</span><br><span class="line">    SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">    Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取根元素</span></span><br><span class="line">    Element rootEle = doc.getRootElement();</span><br><span class="line">    <span class="comment">// 获取根元素的所有子元素</span></span><br><span class="line">    List&lt;Element&gt; eleList = rootEle.elements();</span><br><span class="line">    <span class="comment">// 遍历元素集合</span></span><br><span class="line">    <span class="keyword">for</span> (Element stuEle : eleList) &#123;</span><br><span class="line">        <span class="comment">// 获取元素名称</span></span><br><span class="line">        String eleName = stuEle.getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取元素的number属性值</span></span><br><span class="line">        String number = stuEle.attributeValue(<span class="string">"number"</span>);</span><br><span class="line">        <span class="comment">// 获取元素的name子元素内容</span></span><br><span class="line">        String name = stuEle.elementText(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// 获取元素的age子元素内容</span></span><br><span class="line">        String age = stuEle.elementText(<span class="string">"age"</span>);</span><br><span class="line">        <span class="comment">// 获取元素的sex子元素内容</span></span><br><span class="line">        String sex = stuEle.elementText(<span class="string">"sex"</span>);</span><br><span class="line">        System.out.println(eleName + <span class="string">": [number="</span> + number + <span class="string">", name="</span></span><br><span class="line">                           + name + <span class="string">", age="</span> + age + <span class="string">", sex="</span> + sex + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加student元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取根元素&lt;students&gt;</span></span><br><span class="line">Element root = doc.getRootElement();</span><br><span class="line"><span class="comment">// 为root添加名为student的子元素，并返回这个新添加的子元素</span></span><br><span class="line">Element stuEle = root.addElement(<span class="string">"student"</span>);</span><br><span class="line"><span class="comment">// 给元素添加属性number，值为123</span></span><br><span class="line">stuEle.addAttribute(<span class="string">"number"</span>, <span class="string">"123"</span>);</span><br><span class="line"><span class="comment">// 添加子元素name，并设置name子元素的文本内容为wangWu</span></span><br><span class="line">stuEle.addElement(<span class="string">"name"</span>).setText(<span class="string">"wangWu"</span>);</span><br><span class="line">stuEle.addElement(<span class="string">"age"</span>).setText(<span class="string">"30"</span>);</span><br><span class="line">stuEle.addElement(<span class="string">"sex"</span>).setText(<span class="string">"male"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建格式化器，使用\t缩进，添加换行</span></span><br><span class="line">OutputFormat format = <span class="keyword">new</span> OutputFormat(<span class="string">"\t"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 清空数据中原有的换行</span></span><br><span class="line">format.setTrimText(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 创建XML输出流对象</span></span><br><span class="line">XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileWriter(<span class="string">"src/a.xml"</span>), format);</span><br><span class="line"><span class="comment">// 输出Document</span></span><br><span class="line">writer.write(doc);</span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure>

<p>查询元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * selectSingNode()方法的参数是XPath</span></span><br><span class="line"><span class="comment"> * XPath是在XML文档中查找的一门表达式语言</span></span><br><span class="line"><span class="comment"> * "//"表示查找整个XML文档</span></span><br><span class="line"><span class="comment"> * student表示查找名为student的元素</span></span><br><span class="line"><span class="comment"> * []表示条件</span></span><br><span class="line"><span class="comment"> * @number表示number属性</span></span><br><span class="line"><span class="comment"> * @number='ITCAST_1001'表示条件为number属性等于ITCAST_1001</span></span><br><span class="line"><span class="comment"> * selectSingNode()方法在查找到多个满足XPath的元素时，只返回第一个。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Element stuEle1 = (Element)doc.selectSingleNode(<span class="string">"//student[@number='ITCAST_1001']"</span>);</span><br><span class="line"><span class="comment">// 把元素转换成字符串</span></span><br><span class="line">System.out.println(stuEle1.asXML());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找name子元素内容为liSi的student元素</span></span><br><span class="line">Element stuEle2 = (Element) doc.selectSingleNode(<span class="string">"//student[name='liSi']"</span>);</span><br><span class="line">System.out.println(stuEle2.asXML());</span><br></pre></td></tr></table></figure>

<p>修改元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找元素</span></span><br><span class="line">Element stuEle = (Element)doc.selectSingleNode(<span class="string">"//student[@number='ITCAST_1001']"</span>);</span><br><span class="line"><span class="comment">// 修改student元素的name子元素内容为"张三"</span></span><br><span class="line">stuEle.element(<span class="string">"name"</span>).setText(<span class="string">"张三"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建格式化器，使用\t缩进，添加换行</span></span><br><span class="line">OutputFormat format = <span class="keyword">new</span> OutputFormat(<span class="string">"\t"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 清空数据中原有的换行</span></span><br><span class="line">format.setTrimText(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 创建XML输出流对象</span></span><br><span class="line">XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileWriter(<span class="string">"src/a.xml"</span>), format);</span><br><span class="line"><span class="comment">// 输出Document</span></span><br><span class="line">writer.write(doc);</span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure>

<p>删除学生元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document doc = reader.read(<span class="string">"src/students.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找元素</span></span><br><span class="line">Element stuEle = (Element)doc.selectSingleNode(<span class="string">"//student[@number='ITCAST_1001']"</span>);</span><br><span class="line"><span class="comment">// 获取父元素来删除元素</span></span><br><span class="line">stuEle.getParent().remove(stuEle);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建格式化器，使用\t缩进，添加换行</span></span><br><span class="line">OutputFormat format = <span class="keyword">new</span> OutputFormat(<span class="string">"\t"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 清空数据中原有的换行</span></span><br><span class="line">format.setTrimText(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 创建XML输出流对象</span></span><br><span class="line">XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileWriter(<span class="string">"src/a.xml"</span>), format);</span><br><span class="line"><span class="comment">// 输出Document</span></span><br><span class="line">writer.write(doc);</span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure>

<h5 id="DOM4j-API-介绍"><a href="#DOM4j-API-介绍" class="headerlink" title="DOM4j API 介绍"></a>DOM4j API 介绍</h5><p>Node方法：</p>
<ul>
<li><p>String asXML()：把当前节点转换成字符串，如果当前Node是Document，那么就会把整个XML文档返回；</p>
</li>
<li><p>String getName()：获取当前节点名字；Document的名字就是绑定的XML文档的路径；Element的名字就是元素名称；Attribute的名字就是属性名；</p>
</li>
<li><p>Document getDocument()：返回当前节点所在的Document对象；</p>
</li>
<li><p>short getNodeType()：获取当前节点的类型；</p>
</li>
<li><p>String getNodeTypeName()：获取当前节点的类型名称，例如当前节点是Document的话，那么该方法返回Document；</p>
</li>
<li><p>String getStringValue()：获取当前节点的子孙节点中所有文本内容连接成的字符串；</p>
</li>
<li><p>String getText()：获取当前节点的文本内容。如果当前节点是Text等文本节点，那么本方法返回文本内容；例如当前节点是Element，那么当前节点的内容不是子元素，而是纯文本内容，那么返回文本内容，否则返回空字符串；</p>
</li>
<li><p>void setDocument(Document doc)：给当前节点设置文档元素；</p>
</li>
<li><p>void setParent(Element parent)：给当前节点设置父元素；</p>
</li>
<li><p>void setText(String text)：给当前节点设置文本内容；</p>
</li>
</ul>
<p>Branch方法：</p>
<ul>
<li>void add(Element e)：添加子元素；</li>
<li>void add(Node node)：添加子节点；</li>
<li>void add(Comment comment)：添加注释；</li>
<li>Element addElement(String eleName)：通过名字添加子元素，返回值为子元素对象；</li>
<li>void clearContent()：清空所有子内容；</li>
<li>List content()：获取所有子内容，与获取所有子元素的区别是，<name>liSi</name>元素没有子元素，但有子内容；</li>
<li>Element elementById(String id)：如果元素有名为”ID”的属性，那么可以使用这个方法来查找；</li>
<li>int indexOf(Node node)：查找子节点在子节点列表中的下标位置；</li>
<li>Node node(int index)：通过下标获取子节点；</li>
<li>int nodeCount()：获取子节点的个数；</li>
<li>Iterator nodeIterator()：获取子节点列表的迭代器对象；</li>
<li>boolean remove(Node node)：移除指定子节点；</li>
<li>boolean remove(Commont commont)：移除指定注释；</li>
<li>boolean remove(Element e)：移除指定子元素；</li>
<li>void setContent(List content) ：设置子节点内容；</li>
</ul>
<p>Document方法：</p>
<ul>
<li>Element getRootElement()：获取根元素；</li>
<li>void setRootElement()：设置根元素；</li>
<li>String getXmlEncoding()：获取XML文档的编码；</li>
<li>void setXmlEncoding()：设置XML文档的编码；</li>
</ul>
<p>Element方法：</p>
<ul>
<li>void add(Attribute attr)：添加属性节点；</li>
<li>void add(CDATA cdata)：添加CDATA段节点；</li>
<li>void add(Text Text)：添加Text节点；</li>
<li>Element addAttribute(String name, String value)：添加属性，返回值为当前元素本身；</li>
<li>Element addCDATA(String cdata)：添加CDATA段节点；</li>
<li>Element addComment(String comment)：添加属性节点；</li>
<li>Element addText(String text)：添加Text节点；</li>
<li>void appendAttributes(Element e)：把参数元素e的所有属性添加到当前元素中；</li>
<li>Attribute attribute(int index)：获取指定下标位置上的属性对象；</li>
<li>Attribute attribute(String name)：通过指定属性名称获取属性对象；</li>
<li>int attributeCount()：获取属性个数；</li>
<li>Iterator attributeIterator()：获取当前元素属性集合的迭代器；</li>
<li>List attributes()：获取当前元素的属性集合；</li>
<li>String attributeValue(String name)：获取当前元素指定名称的属性值；</li>
<li>Element createCopy()：clone当前元素对象，但不会copy父元素。也就是说新元素没有父元素，但有子元素；</li>
<li>Element element(String name)：获取当前元素第一个名称为name的子元素；</li>
<li>Iterator elementIterator()：获取当前元素的子元素集合的迭代器；</li>
<li>Iterator elementIterator(String name)：获取当前元素中指定名称的子元素集合的迭代器；</li>
<li>List elements()：获取当前元素子元素集合；</li>
<li>List elements(String name)：获取当前元素指定名称的子元素集合；</li>
<li>String elementText(String name)：获取当前元素指定名称的第一个元素文件内容；</li>
<li>String elementTextTrime(String name)：同上，只是去除了无用空白；</li>
<li>boolean isTextOnly()：当前元素是否为纯文本内容元素；</li>
<li>boolean remove(Attribute attr)：移除属性；</li>
<li>boolean remove(CDATA cdata)：移除CDATA；</li>
<li>boolean remove(Text text)：移除Text。</li>
</ul>
<p>DocumentHelper静态方法介绍：</p>
<ul>
<li>static Document createDocument()：创建Dcoument对象；</li>
<li>static Element createElement(String name)：创建指定名称的元素对象；</li>
<li>static Attribute createAttrbute(Element owner, String name, String value)：创建属性对象；</li>
<li>static Text createText(String text)：创建属性对象；</li>
<li>static Document parseText(String text)：通过给定的字符串生成Document对象；</li>
</ul>
<hr>
<h2 id="Day-03"><a href="#Day-03" class="headerlink" title="Day 03"></a>Day 03</h2><p><em>27/06/2020</em></p>
<h4 id="C-S"><a href="#C-S" class="headerlink" title="C/S"></a>C/S</h4><ul>
<li><p>C/S结构即客户端/服务器（Client/Server），例如QQ；</p>
</li>
<li><p>需要编写服务器端程序，以及客户端程序，例如我们安装的就是QQ的客户端程序；</p>
</li>
<li><p>缺点：软件更新时需要同时更新客户端和服务器端两端，比较麻烦；</p>
</li>
<li><p>优点：安全性比较好。</p>
</li>
</ul>
<h4 id="B-S"><a href="#B-S" class="headerlink" title="B/S"></a>B/S</h4><ul>
<li>B/S结构即浏览器/服务器（Browser/Server）；</li>
<li>优点：只需要编写服务器端程序；</li>
<li>缺点：安全性较差。</li>
</ul>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>Tomcat的目录结构</p>
<ul>
<li><p>bin：该目录下存放的是二进制可执行文件，如果是安装版，那么这个目录下会有两个exe文件：tomcat6.exe、tomcat6w.exe，前者是在控制台下启动Tomcat，后者是弹出UGI窗口启动Tomcat；如果是解压版，那么会有startup.bat和shutdown.bat文件，startup.bat用来启动Tomcat，但需要先配置JAVA_HOME环境变量才能启动，shutdawn.bat用来停止Tomcat；</p>
</li>
<li><p>conf：这是一个非常非常重要的目录，这个目录下有四个最为重要的文件：</p>
<ul>
<li>server.xml：配置整个服务器信息。例如修改端口号，添加虚拟主机等；下面会详细介绍这个文件；</li>
<li>tomcatusers.xml：存储tomcat用户的文件，这里保存的是tomcat的用户名及密码，以及用户的角色信息。可以按着该文件中的注释信息添加tomcat用户，然后就可以在Tomcat主页中进入Tomcat Manager页面了；</li>
<li>web.xml：部署描述符文件，这个文件中注册了很多MIME类型，即文档类型。这些MIME类型是客户端与服务器之间说明文档类型的，如用户请求一个html网页，那么服务器还会告诉客户端浏览器响应的文档是text/html类型的，这就是一个MIME类型。客户端浏览器通过这个MIME类型就知道如何处理它了。当然是在浏览器中显示这个html文件了。但如果服务器响应的是一个exe文件，那么浏览器就不可能显示它，而是应该弹出下载窗口才对。MIME就是用来说明文档的内容是什么类型的！</li>
<li>context.xml：对所有应用的统一配置，通常我们不会去配置它。</li>
</ul>
</li>
<li><p>lib：Tomcat的类库，里面是一大堆jar文件。如果需要添加Tomcat依赖的jar文件，可以把它放到这个目录中，当然也可以把应用依赖的jar文件放到这个目录中，这个目录中的jar所有项目都可以共享之，但这样你的应用放到其他Tomcat下时就不能再共享这个目录下的Jar包了，所以建议只把Tomcat需要的Jar包放到这个目录下；</p>
</li>
<li><p>logs：这个目录中都是日志文件，记录了Tomcat启动和关闭的信息，如果启动Tomcat时有错误，那么异常也会记录在日志文件中。</p>
</li>
<li><p>temp：存放Tomcat的临时文件，这个目录下的东西可以在停止Tomcat后删除！</p>
</li>
<li><p>webapps：存放web项目的目录，其中每个文件夹都是一个项目；如果这个目录下已经存在了目录，那么都是tomcat自带的。项目。其中ROOT是一个特殊的项目，在地址栏中没有给出项目目录时，对应的就是ROOT项目。<code>http://localhost:8080/examples</code>，进入示例项目。其中examples就是项目名，即文件夹的名字。</p>
</li>
<li><p>work：运行时生成的文件，最终运行的文件都在这里。通过webapps中的项目生成的！可以把这个目录下的内容删除，再次运行时会生再次生成work目录。当客户端用户访问一个JSP文件时，Tomcat会通过JSP生成Java文件，然后再编译Java文件生成class文件，生成的java和class文件都会存放到这个目录下。</p>
</li>
<li><p>LICENSE：许可证。</p>
</li>
<li><p>NOTICE：说明文件。</p>
</li>
</ul>
<h4 id="Web-应用"><a href="#Web-应用" class="headerlink" title="Web 应用"></a>Web 应用</h4><h5 id="静态应用"><a href="#静态应用" class="headerlink" title="静态应用"></a>静态应用</h5><ul>
<li>在webapps下创建一个hello目录；</li>
<li>在webapps\hello\下创建index.html；</li>
<li>启动tomcat；</li>
<li>打开浏览器访问<code>http://localhost:8080/hello/index.html</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="动态应用"><a href="#动态应用" class="headerlink" title="动态应用"></a>动态应用</h5><ul>
<li>在webapps下创建hello1目录；</li>
<li>在webapps\hello1\下创建WEB-INF目录；</li>
<li>在webapps\hello1\WEB-INF\下创建web.xml；</li>
<li>在webapps\hello1\下创建index.html。</li>
<li>打开浏览器访问<code>http://localhost:8080/hello/index.html</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">"2.5"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>完整的Web应用还需要在WEB-INF目录下创建：</p>
<ul>
<li>classes；</li>
<li>lib目录；</li>
</ul>
<p>webapps</p>
<p>|- hello</p>
<p>​    |-index.html</p>
<p>​    |-WEB-INF</p>
<p>​        |-web.xml</p>
<p>​        |-classes</p>
<p>​        |-lib</p>
<ul>
<li>hello：应用目录，hello就是应用的名称；</li>
<li>index.html：应用资源。应用下可以有多个资源，例如css、js、html、jsp等，也可以把资源放到文件夹中，例如：hello\html\index.html，这时访问URL为：<a href="http://localhost:8080/hello/html/index.html；" target="_blank" rel="noopener">http://localhost:8080/hello/html/index.html；</a></li>
<li>WEB-INF：这个目录名称必须是大写，这个目录下的东西是无法通过浏览器直接访问的，也就是说放到这里的东西是安全的；</li>
<li>web.xml：应用程序的部署描述符文件，可以在该文件中对应用进行配置，例如配置应用的首页</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>classes：存放class文件的目录；</p>
</li>
<li><p>lib：存放jar包的目录；</p>
</li>
</ul>
<h5 id="配置外部应用"><a href="#配置外部应用" class="headerlink" title="配置外部应用"></a>配置外部应用</h5><p>也可以把应用放到Tomcat之外，这就是外部应用了。例如我们把上面写的hello应用从webapps目录中剪切到C盘下，即C:/hello。现在hello这个Web应用已经不在Tomcat中了，这时我们需要在tomcat中配置外部应用的位置，配置的方式一共有两种：</p>
<ul>
<li>conf/server.xml：打开server.xml文件，找到<code>&lt;Host&gt;</code>元素，在其中添加<code>&lt;Context&gt;</code>元素，代码如下：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span> <span class="attr">appBse</span>=<span class="string">"webapps"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"itcast_hello"</span> <span class="attr">docBse</span>=<span class="string">"C:/hello/"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1）path：指定当前应用的名称</p>
<p>2）docBase：指定应用的物理位置</p>
<p>3）浏览器访问路径：<code>http://localhost:8080/itcast_hello/index.html</code></p>
<ul>
<li>conf/catalana/localhost：在该目录下创建itcast_hello.xml文件，在该文件中编写<code>&lt;Context&gt;</code>元素，代码如下：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"C:/hello/"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>1）文件名：指定当前应用的名称；</p>
<p>2）docBase：指定应用的物理位置；</p>
<p>3）浏览器访问路径：<code>http://localhost:8080/itcast_hello/index.html</code></p>
<h5 id="server-xml"><a href="#server-xml" class="headerlink" title="server.xml"></a>server.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Servier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Engine</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Host</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;Server&gt;</code>：根元素，表示整个服务器的配置信息；</li>
<li><code>&lt;Service&gt;</code>：<code>&lt;Server&gt;</code>的子元素，在<code>&lt;Server&gt;</code>中只能有一个<code>&lt;Service&gt;</code>元素，它表示服务；</li>
<li><code>&lt;Connector&gt;</code>：<code>&lt;Service&gt;</code>的子元素，在<code>&lt;Service&gt;</code>中可以有N个<code>&lt;Connector&gt;</code>元素，它表示连接。</li>
<li><code>&lt;Engine&gt;</code>：<code>&lt;Service&gt;</code>的子元素，在<code>&lt;Service&gt;</code>中只能有一<code>&lt;Engine&gt;</code>元素，该元素表示引擎，它是<code>&lt;Service&gt;</code>组件的核心。</li>
<li><code>&lt;Host&gt;</code>：<code>&lt;Engine&gt;</code>的子元素，在<code>&lt;Engine&gt;</code>中可以有N个<code>&lt;Host&gt;</code>元素，每个<code>&lt;Host&gt;</code>元素表示一个虚拟主机。所谓虚拟主机就像是真的主机一样，每个主机都有自己的主机名和项目目录。例如<code>&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot;&gt;</code>表示主机名为localhost，这个主机的项目存放在webapps目录中。访问这个项目下的主机时，需要使用localhost主机名，项目都存放在webapps目录下。</li>
<li><code>&lt;Context&gt;</code>：<code>&lt;Host&gt;</code>元素的子元素，在<code>&lt;Host&gt;</code>中可以有N个<code>&lt;Context&gt;</code>元素，每个<code>&lt;Context&gt;</code>元素表示一个应用。如果应用在<code>&lt;Host&gt;</code>的appBase指定的目录下，那么可以不配置<code>&lt;Context&gt;</code>元素，如果是外部应用，那么就必须配置<code>&lt;Context&gt;</code>。如果要为应用指定资源，也需要配置<code>&lt;Context&gt;</code>元素。</li>
</ul>
<p>我们可以把<code>&lt;Server&gt;</code>看作是一个大酒店：</p>
<ul>
<li><p><code>&lt;Service&gt;</code>：酒店的服务部门；</p>
</li>
<li><p><code>&lt;Connector&gt;</code>：服务员；</p>
</li>
<li><p><code>&lt;Engine&gt;</code>：后厨；</p>
</li>
<li><p><code>&lt;Host&gt;</code>：后厨中的一个区，例如川菜区是一个<code>&lt;Host&gt;</code>、粤菜区是一个<code>&lt;Host&gt;</code>；</p>
</li>
<li><p><code>&lt;Context&gt;</code>：后厨的一个厨师。</p>
</li>
</ul>
<p>用户发出一个请求：<code>http://localhost:8080/hello/index.jsp</code>。发现是http/1.1协议，而且还是8080端口，所以就交给了处理这一请求的”服务员（处理HTTP请求的<code>&lt;Connector&gt;</code>）”，”服务员”再把请求交给了”后厨（<code>&lt;Engine&gt;</code>）”，因为请求是要一盘水煮鱼，所以由”川菜区（<code>&lt;Host&gt;</code>）”负责，因为”大老王师傅<code>&lt;Context&gt;</code>“做水煮鱼最地道，所以由它完成。</p>
<ul>
<li><code>&lt;Connector&gt;</code>：关心请求中的http、和8080；</li>
<li><code>&lt;Host&gt;</code>：关心localhost；</li>
<li><code>&lt;Context&gt;</code>：关心hello</li>
</ul>
<h5 id="映射虚拟主机"><a href="#映射虚拟主机" class="headerlink" title="映射虚拟主机"></a>映射虚拟主机</h5><p>我们的目标是，在浏览器中输出：<code>http://www.itcast.cn</code>就可以访问我们的项目。</p>
<p>完成这一目标，我们需要做三件事：</p>
<ul>
<li><p>修改端口号为80，这一点应该没有问题吧；</p>
</li>
<li><p>在本机上可以解析域名为127.0.0.1，这需要修改C:\WINDOWS\system32\drivers\etc\hosts文件，添加对<code>http://www.itcast.cn</code>和127.0.01的绑定关系；</p>
</li>
<li><p>在server.xml文件中添加一个<code>&lt;Host&gt;</code>（主机）。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"www.itcast.cn"</span> <span class="attr">appBase</span>=<span class="string">"F:/itcastapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>name=&quot;www.itcast.cn&quot;</code>：指定虚拟主机名为<code>www.itcast.cn</code>；</li>
<li>appBase=”F:/itcastapps”：指定当前虚拟主机的应用程序存放目录为F:/itcastapps。</li>
<li>在itcastapps目录下创建名为ROOT的应用，因为一个主机只可以有一个名为ROOT的应用，名为ROOT的应用在浏览器中访问是可以不给出应用名称。</li>
</ul>
<h3 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h3><p>HTTP（hypertext transport protocol），即超文本传输协议。这个协议详细规定了浏览器和万维网服务器之间互相通信的规则。</p>
<p>HTTP就是一个通信规则，通信规则规定了客户端发送给服务器的内容格式，也规定了服务器发送给客户端的内容格式。其实我们要学习的就是这个两个格式！客户端发送给服务器的格式叫”请求协议”；服务器发送给客户端的格式叫”响应协议”。  </p>
<h4 id="URL-和-URI"><a href="#URL-和-URI" class="headerlink" title="URL 和 URI"></a>URL 和 URI</h4><p>URL：统一资源定位符，就是一个网址，例如：<code>http://www.itcast.cn</code>就是一个URL。<code>/hello/index.html</code>也是一个URL，URL必须是一个真实存在的网址。</p>
<p>URI：统一资源标识符：比URI包含了URL，URI的范围更加宽泛，URI可以是一个不存在的网址。在网络上用来标签资源的都是URI，例如<code>zhangSan@163.com</code>也是URI。</p>
<h4 id="请求协议"><a href="#请求协议" class="headerlink" title="请求协议"></a>请求协议</h4><p>请求协议的格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求首行；  </span><br><span class="line">请求头信息；  </span><br><span class="line">空行；  </span><br><span class="line">请求体。</span><br></pre></td></tr></table></figure>

<p>浏览器发送给服务器的内容就这个格式的，如果不是这个格式服务器将无法解读！在HTTP协议中，请求有很多请求方法，其中最为常用的就是GET和POST。不同的请求方法之间的区别，后面会一点一点的介绍。</p>
<h4 id="响应协议"><a href="#响应协议" class="headerlink" title="响应协议"></a>响应协议</h4><p>响应协议的格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">响应首行；</span><br><span class="line">响应头信息；</span><br><span class="line">空行；</span><br><span class="line">响应体。</span><br></pre></td></tr></table></figure>

<p>响应内容是由服务器发送给浏览器的内容，浏览器会根据响应内容来显示。</p>
<hr>
<h2 id="Day-04"><a href="#Day-04" class="headerlink" title="Day 04"></a>Day 04</h2><p><em>28/06/2020</em></p>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><p>Servlet是JavaWeb的三大组件之一，它属于动态资源。Servlet的作用是处理请求，服务器会把接收到的请求交给Servlet来处理，在Servlet中通常需要：</p>
<ul>
<li>接收请求数据；</li>
<li>处理请求；</li>
<li>完成响应。</li>
</ul>
<p>　　例如客户端发出登录请求，或者输出注册请求，这些请求都应该由Servlet来完成处理！Servlet需要我们自己来编写，每个Servlet必须实现<code>javax.servlet.Servlet</code>接口。</p>
<h4 id="实现Servlet的方式"><a href="#实现Servlet的方式" class="headerlink" title="实现Servlet的方式"></a>实现Servlet的方式</h4><p>实现Servlet有三种方式：</p>
<ul>
<li>实现javax.servlet.Servlet接口；</li>
<li>继承javax.servlet.GenericServlet类；</li>
<li>继承javax.servlet.http.HttpServlet类；</li>
</ul>
<p>通常我们会去继承HttpServlet类来完成我们的Servlet，但学习Servlet还要从javax.servlet.Servlet接口开始学习。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Servlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><p>开始第一个Servlet应用！首先在webapps目录下创建helloservlet目录，它就是我们的应用目录了，然后在helloservlet目录中创建准备JavaWeb应用所需内容：</p>
<ul>
<li><p>创建/helloservlet/WEB-INF目录；</p>
</li>
<li><p>创建/helloservlet/WEB-INF/classes目录；</p>
</li>
<li><p>创建/helloservlet/WEB-INF/lib目录；</p>
</li>
<li><p>创建/helloservlet/WEB-INF/web.xml文件；</p>
</li>
</ul>
<p>接下来我们开始准备完成Servlet，完成Servlet需要分为两步：</p>
<ul>
<li><p>编写Servlet类；</p>
</li>
<li><p>在web.xml文件中配置Servlet；</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"hello servlet!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们暂时忽略Servlet中其他四个方法，只关心service()方法，因为它是用来处理请求的方法。我们在该方法内给出一条输出语句！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--web.xml 重要 背--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/helloworld<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在web.xml中配置Servlet的目的其实只有一个，就是把访问路径与一个Servlet绑定到一起，上面配置是把访问路径：”/helloworld”与”cn.itcast.servlet.HelloServlet”绑定到一起。</p>
<ul>
<li><p><code>&lt;servlet&gt;</code>：指定HelloServlet这个Servlet的名称为hello；</p>
</li>
<li><p><code>&lt;servlet-mapping&gt;</code>：指定/helloworld访问路径所以访问的Servlet名为hello。</p>
</li>
<li><p><code>&lt;servlet&gt;</code>和<code>&lt;servlet-mapping&gt;</code>通过<code>&lt;servlet-name&gt;</code>这个元素关联在一起了！</p>
</li>
</ul>
<p>接下来，我们编译HelloServlet，注意，编译HelloServlet时需要导入servlet-api.jar，因为Servlet.class等类都在servlet-api.jar中。</p>
<p>javac -classpath F:/tomcat6/lib/servlet-api.jar -d . HelloServlet.java</p>
<p>然后把HelloServlet.class放到/helloworld/WEB-INF/classes/目录下，然后启动Tomcat，在浏览器中访问：<code>http://localhost:8080/helloservlet/helloworld</code>即可在控制台上看到输出！</p>
<ul>
<li>/helloservlet/WEB-INF/classes/cn/itcast/servlet/HelloServlet.class；</li>
</ul>
<h3 id="Servlet接口"><a href="#Servlet接口" class="headerlink" title="Servlet接口"></a>Servlet接口</h3><h4 id="Servlet-的生命周期"><a href="#Servlet-的生命周期" class="headerlink" title="Servlet 的生命周期"></a>Servlet 的生命周期</h4><p>所谓xxx的生命周期，就是说xxx的出生、服务，以及死亡。Servlet生命周期也是如此！与Servlet的生命周期相关的方法有：</p>
<ul>
<li><p>void init(ServletConfig)；</p>
</li>
<li><p>void service(ServletRequest,ServletResponse)；</p>
</li>
<li><p>void destroy()；</p>
<h5 id="init"><a href="#init" class="headerlink" title="init"></a>init</h5></li>
</ul>
<p>服务器会在Servlet第一次被访问时创建Servlet，或者是在服务器启动时创建Servlet。如果服务器启动时就创建Servlet，那么还需要在web.xml文件中配置。也就是说默认情况下，Servlet是在第一次被访问时由服务器创建的。</p>
<p>而且一个Servlet类型，服务器只创建一个实例对象，例如在我们首次访问<code>http://localhost:8080/helloservlet/helloworld</code>时，服务器通过”/helloworld”找到了绑定的Servlet名称为cn.itcast.servlet.HelloServlet，然后服务器查看这个类型的Servlet是否已经创建过，如果没有创建过，那么服务器才会通过反射来创建HelloServlet的实例。当我们再次访问<code>http://localhost:8080/helloservlet/helloworld</code>时，服务器就不会再次创建HelloServlet实例了，而是直接使用上次创建的实例。</p>
<p>在Servlet被创建后，服务器会马上调用Servlet的<code>void init(ServletConfig)</code>方法。请记住， Servlet出生后马上就会调用<code>init()</code>方法，而且一个Servlet的一生。这个方法只会被调用一次。这好比小孩子出生后马上就要去剪脐带一样，而且剪脐带一生只有一次。</p>
<p>我们可以把一些对Servlet的初始化工作放到init方法中！</p>
<h5 id="service"><a href="#service" class="headerlink" title="service"></a>service</h5><p>当服务器每次接收到请求时，都会去调用Servlet的<code>service()</code>方法来处理请求。服务器接收到一次请求，就会调用<code>service()</code>方法一次，所以<code>service()</code>方法是会被调用多次的。正因为如此，所以我们才需要把处理请求的代码写到<code>service()</code>方法中！</p>
<h5 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h5><p>Servlet是不会轻易离去的，通常都是在服务器关闭时Servlet才会离去！在服务器被关闭时，服务器会去销毁Servlet，在销毁Servlet之前服务器会先去调用Servlet的<code>destroy()</code>方法，我们可以把Servlet的临终遗言放到<code>destroy()</code>方法中，例如对某些资源的释放等代码放到<code>destroy()</code>方法中。</p>
<h4 id="Servlet-接口相关类型"><a href="#Servlet-接口相关类型" class="headerlink" title="Servlet 接口相关类型"></a>Servlet 接口相关类型</h4><p>在Servlet接口中还存在三个我们不熟悉的类型：</p>
<ul>
<li><p>ServletRequest：<code>service()</code> 方法的参数，它表示请求对象，它封装了所有与请求相关的数据，它是由服务器创建的；</p>
</li>
<li><p>ServletResponse：<code>service()</code>方法的参数，它表示响应对象，在<code>service()</code>方法中完成对客户端的响应需要使用这个对象；</p>
</li>
<li><p>ServletConfig：<code>init()</code>方法的参数，它表示Servlet配置对象，它对应Servlet的配置信息，那对应web.xml文件中的<code>&lt;servlet&gt;</code>元素。</p>
</li>
</ul>
<h5 id="ServletRequest和ServletResponse"><a href="#ServletRequest和ServletResponse" class="headerlink" title="ServletRequest和ServletResponse"></a>ServletRequest和ServletResponse</h5><p>ServletRequest和ServletResponse是Servlet#<code>service()</code> 方法的两个参数，一个是请求对象，一个是响应对象，可以从ServletRequest对象中获取请求数据，可以使用ServletResponse对象完成响应。你以后会发现，这两个对象就像是一对恩爱的夫妻，永远不分离，总是成对出现。</p>
<p>ServletRequest和ServletResponse的实例由服务器创建，然后传递给service()方法。如果在service() 方法中希望使用HTTP相关的功能，那么可以把ServletRequest和ServletResponse强转成HttpServletRequest和HttpServletResponse。这也说明我们经常需要在service()方法中对ServletRequest和ServletResponse进行强转，这是很心烦的事情。不过后面会有一个类来帮我们解决这一问题的。</p>
<p>HttpServletRequest方法：</p>
<ul>
<li><p>String getParameter(String paramName)：获取指定请求参数的值；</p>
</li>
<li><p>String getMethod()：获取请求方法，例如GET或POST；</p>
</li>
<li><p>String getHeader(String name)：获取指定请求头的值；</p>
</li>
<li><p>void setCharacterEncoding(String encoding)：设置请求体的编码！因为GET请求没有请求体，所以这个方法只只对POST请求有效。当调用<code>request.setCharacterEncoding(&quot;utf-8&quot;)</code>之后，再通过getParameter()方法获取参数值时，那么参数值都已经通过了转码，即转换成了UTF-8编码。所以，这个方法必须在调用getParameter()方法之前调用！</p>
</li>
</ul>
<p>HttpServletResponse方法：</p>
<ul>
<li><p>PrintWriter getWriter()：获取字符响应流，使用该流可以向客户端输出响应信息。例如<code>response.getWriter().print(&quot;&lt;h1&gt;Hello JavaWeb!&lt;/h1&gt;&quot;)</code>；</p>
</li>
<li><p>ServletOutputStream getOutputStream()：获取字节响应流，当需要向客户端响应字节数据时，需要使用这个流，例如要向客户端响应图片；</p>
</li>
<li><p>void setCharacterEncoding(String encoding)：用来设置字符响应流的编码，例如在调用<code>setCharacterEncoding(&quot;utf-8&quot;)</code>;之后，再<code>response.getWriter()</code>获取字符响应流对象，这时的响应流的编码为utf-8，使用response.getWriter()输出的中文都会转换成utf-8编码后发送给客户端；</p>
</li>
<li><p>void setHeader(String name, String value)：向客户端添加响应头信息，例如<code>setHeader(&quot;Refresh&quot;, &quot;3;url=http://www.itcast.cn&quot;)</code>，表示3秒后自动刷新到<code>http://www.itcast.cn</code>；</p>
</li>
<li><p>void setContentType(String contentType)：该方法是<code>setHeader(&quot;content-type&quot;, &quot;xxx&quot;)</code>的简便方法，即用来添加名为content-type响应头的方法。content-type响应头用来设置响应数据的MIME类型，例如要向客户端响应jpg的图片，那么可以<code>setContentType(&quot;image/jepg&quot;)</code>，如果响应数据为文本类型，那么还要台同时设置编码，例如<code>setContentType(&quot;text/html;chartset=utf-8&quot;)</code>表示响应数据类型为文本类型中的html类型，并且该方法会调用<code>setCharacterEncoding(&quot;utf-8&quot;)</code>方法；</p>
</li>
<li><p>void sendError(int code, String errorMsg)：向客户端发送状态码，以及错误消息。例如给客户端发送404：<code>response(404, &quot;您要查找的资源不存在！&quot;)</code>。</p>
</li>
</ul>
<h5 id="ServletConfig"><a href="#ServletConfig" class="headerlink" title="ServletConfig"></a>ServletConfig</h5><p>ServletConfig对象对应web.xml文件中的<code>&lt;servlet&gt;</code>元素。例如你想获取当前Servlet在web.xml文件中的配置名，那么可以使用servletConfig.getServletName()方法获取！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>One<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        cn.itcast.servlet.OneServlet</span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ServletConfig对象是由服务器创建的，然后传递给Servlet的init()方法，你可以在init()方法中使用它！</p>
<ul>
<li><p>String getServletName()：获取Servlet在web.xml文件中的配置名称，即<code>&lt;servlet-name&gt;</code>指定的名称；</p>
</li>
<li><p>ServletContext getServletContext()：用来获取ServletContext对象，ServletContext会在后面讲解；</p>
</li>
<li><p>String getInitParameter(String name)：用来获取在web.xml中配置的初始化参数，通过参数名来获取参数值；</p>
</li>
<li><p>Enumeration getInitParameterNames()：用来获取在web.xml中配置的所有初始化参数名称；</p>
</li>
</ul>
<p>在<code>&lt;servlet&gt;</code>元素中还可以配置初始化参数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>One<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.OneServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>paramName1<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>paramValue1<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>paramName2<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>paramValue2<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在OneServlet中，可以使用ServletConfig对象的getInitParameter()方法来获取初始化参数，例如：</p>
<p><code>String value1 = servletConfig.getInitParameter(&quot;paramName1&quot;);//获取到paramValue1</code></p>
<h3 id="GenericServlet"><a href="#GenericServlet" class="headerlink" title="GenericServlet"></a>GenericServlet</h3><p>GenericServlet是Servlet接口的实现类，我们可以通过继承GenericServlet来编写自己的Servlet。下面是GenericServlet类的源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GenericServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span>, <span class="title">ServletConfig</span>,</span></span><br><span class="line"><span class="class">        <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ServletConfig config;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericServlet</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInitParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getInitParameter(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Enumeration&lt;String&gt; <span class="title">getInitParameterNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getInitParameterNames();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletContext <span class="title">getServletContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        getServletContext().log(getServletName() + <span class="string">": "</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message, Throwable t)</span> </span>&#123;</span><br><span class="line">        getServletContext().log(getServletName() + <span class="string">": "</span> + message, t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config.getServletName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在GenericServlet中，定义了一个ServletConfig config实例变量，并在init(ServletConfig)方法中把参数ServletConfig赋给了实例变量。然后在该类的很多方法中使用了实例变量config。</p>
<p>如果子类覆盖了GenericServlet的init(StringConfig)方法，那么this.config=config这一条语句就会被覆盖了，也就是说GenericServlet的实例变量config的值为null，那么所有依赖config的方法都不能使用了。如果真的希望完成一些初始化操作，那么去覆盖GenericServlet提供的init()方法，它是没有参数的init()方法，它会在init(ServletConfig)方法中被调用。</p>
<p>GenericServlet还实现了ServletConfig接口，所以可以直接调用getInitParameter()、getServletContext()等ServletConfig的方法。</p>
<h3 id="HttpServlet"><a href="#HttpServlet" class="headerlink" title="HttpServlet"></a>HttpServlet</h3><p>HttpServlet类是GenericServlet的子类，它提供了对HTTP请求的特殊支持，所以通常我们都会通过继承HttpServlet来完成自定义的Servlet。</p>
<p>HttpServlet类中提供了service(HttpServletRequest,HttpServletResponse)方法，这个方法是HttpServlet自己的方法，不是从Servlet继承来的。在HttpServlet的service(ServletRequest,ServletResponse)方法中会把ServletRequest和ServletResponse强转成HttpServletRequest和HttpServletResponse，然后调用service(HttpServletRequest,HttpServletResponse)方法，这说明子类可以去覆盖service(HttpServletRequest,HttpServletResponse)方法即可，这就不用自己去强转请求和响应对象了。</p>
<p>其实子类也不用去覆盖service(HttpServletRequest,HttpServletResponse)方法，因为HttpServlet还要做另一步简化操作，下面会介绍。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HttpServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ……</span><br><span class="line">&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        HttpServletRequest  request;</span><br><span class="line">        HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            request = (HttpServletRequest) req;</span><br><span class="line">            response = (HttpServletResponse) res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"non-HTTP request or response"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        service(request, response);</span><br><span class="line">&#125;</span><br><span class="line">……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="doGet-和doPost"><a href="#doGet-和doPost" class="headerlink" title="doGet()和doPost()"></a>doGet()和doPost()</h4><p>在HttpServlet的service(HttpServletRequest,HttpServletResponse)方法会去判断当前请求是GET还是POST，如果是GET请求，那么会去调用本类的doGet()方法，如果是POST请求会去调用doPost()方法，这说明我们在子类中去覆盖doGet()或doPost()方法即可。</p>
<h3 id="Servlet-细节"><a href="#Servlet-细节" class="headerlink" title="Servlet 细节"></a>Servlet 细节</h3><h4 id="Servlet与线程安全"><a href="#Servlet与线程安全" class="headerlink" title="Servlet与线程安全"></a>Servlet与线程安全</h4><p>因为一个类型的Servlet只有一个实例对象，那么就有可能会现时出一个Servlet同时处理多个请求，那么Servlet是否为线程安全的呢？答案是：”不是线程安全的”。这说明Servlet的工作效率很高，但也存在线程安全问题！</p>
<p>所以我们不应该在Servlet中随意创建成员变量，因为可能会存在一个线程对这个成员变量进行写操作，另一个线程对这个成员变量进行读操作。</p>
<h4 id="让服务器在启动时就创建Servlet"><a href="#让服务器在启动时就创建Servlet" class="headerlink" title="让服务器在启动时就创建Servlet"></a>让服务器在启动时就创建Servlet</h4><p>默认情况下，服务器会在某个Servlet第一次收到请求时创建它。也可以在web.xml中对Servlet进行配置，使服务器启动时就创建Servlet。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.Hello1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.Hello2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello2<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello3<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.Hello3Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello3<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello3<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>&lt;servlet&gt;</code>元素中配置<code>&lt;load-on-startup&gt;</code>元素可以让服务器在启动时就创建该Servlet，其中<code>&lt;load-on-startup&gt;</code>元素的值必须是大于等于0的整数，它的使用是服务器启动时创建Servlet的顺序。上例中，根据<code>&lt;load-on-startup&gt;</code>的值可以得知服务器创建Servlet的顺序为Hello1Servlet、Hello2Servlet、Hello3Servlet。</p>
<h4 id="lt-url-pattern-gt"><a href="#lt-url-pattern-gt" class="headerlink" title="&lt;url-pattern&gt;"></a><code>&lt;url-pattern&gt;</code></h4><p><code>&lt;url-pattern&gt;</code>是<code>&lt;servlet-mapping&gt;</code>的子元素，用来指定Servlet的访问路径，即URL。它必须是以”/“开头！</p>
<p>1）可以在<code>&lt;servlet-mapping&gt;</code>中给出多个<code>&lt;url-pattern&gt;</code>，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/AServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/BServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么这说明一个Servlet绑定了两个URL，无论访问/AServlet还是/BServlet，访问的都是AServlet。</p>
<p>2）还可以在<code>&lt;url-pattern&gt;</code>中使用通配符，所谓通配符就是星号”*“，星号可以匹配任何URL前缀或后缀，使用通配符可以命名一个Servlet绑定一组URL，例如：</p>
<ul>
<li><p><code>&lt;url-pattern&gt;/servlet/*&lt;url-patter&gt;</code>：/servlet/a、/servlet/b，都匹配/servlet/*；</p>
</li>
<li><p><code>&lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</code>：/abc/def/ghi.do、/a.do，都匹配*.do；</p>
</li>
<li><p><code>&lt;url-pattern&gt;/*&lt;url-pattern&gt;</code>：匹配所有URL；</p>
</li>
</ul>
<p>请注意，通配符要么为前缀，要么为后缀，不能出现在URL中间位置，也不能只有通配符。例如：<code>/*.do</code>就是错误的，因为星号出现在URL的中间位置上了。<em>.</em>也是不对的，因为一个URL中最多只能出现一个通配符。</p>
<p>注意，通配符是一种模糊匹配URL的方式，如果存在更具体的<code>&lt;url-pattern&gt;</code>，那么访问路径会去匹配具体的<code>&lt;url-pattern&gt;</code>。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.Hello1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet/hello1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.itcast.servlet.Hello2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当访问路径为<code>http://localhost:8080/hello/servlet/hello1</code>时，因为访问路径即匹配hello1的<code>&lt;url-pattern&gt;</code>，又匹配hello2的<code>&lt;url-pattern&gt;</code>，但因为hello1的<code>&lt;url-pattern&gt;</code>中没有通配符，所以优先匹配，即设置hello1。</p>
<h4 id="web-xml文件的继承（了解）"><a href="#web-xml文件的继承（了解）" class="headerlink" title="web.xml文件的继承（了解）"></a>web.xml文件的继承（了解）</h4><p>每个完整的JavaWeb应用中都需要有web.xml，但我们不知道所有的web.xml文件都有一个共同的父文件，它在Tomcat的conf/web.xml路径。</p>
<h3 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h3><p>服务器会为每个应用创建一个ServletContext对象：</p>
<ul>
<li><p>ServletContext对象的创建是在服务器启动时完成的；</p>
</li>
<li><p>ServletContext对象的销毁是在服务器关闭时完成的。</p>
</li>
</ul>
<p>ServletContext对象的作用是在整个Web应用的动态资源之间共享数据！例如在AServlet中向ServletContext对象中保存一个值，然后在BServlet中就可以获取这个值，这就是共享数据了。</p>
<h4 id="获取ServletContext"><a href="#获取ServletContext" class="headerlink" title="获取ServletContext"></a>获取ServletContext</h4><p>在Servlet中获取ServletContext对象：</p>
<ul>
<li><p>在void init(ServletConfig config)中：<code>ServletContext context = config.getServletContext();</code>，ServletConfig类的getServletContext()方法可以用来获取ServletContext对象；</p>
</li>
<li><p>在GenericeServlet或HttpServlet中获取ServletContext对象：</p>
</li>
<li><p>GenericServlet类有getServletContext()方法，所以可以直接使用this.getServletContext()来获取；</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> </span>&#123;</span><br><span class="line">        ServletContext context = config.getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line">…</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        ServletContext context = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="域对象的功能"><a href="#域对象的功能" class="headerlink" title="域对象的功能"></a>域对象的功能</h4><p>ServletContext是JavaWeb四大域对象之一：</p>
<ul>
<li><p>PageContext；</p>
</li>
<li><p>ServletRequest；</p>
</li>
<li><p>HttpSession；</p>
</li>
<li><p>ServletContext；</p>
</li>
</ul>
<p>所有域对象都有存取数据的功能，因为域对象内部有一个Map，用来存储数据，下面是ServletContext对象用来操作数据的方法：</p>
<ul>
<li><p>void setAttribute(String name, Object value)：用来存储一个对象，也可以称之为存储一个域属性，例如：servletContext.setAttribute(“xxx”, “XXX”)，在ServletContext中保存了一个域属性，域属性名称为xxx，域属性的值为XXX。请注意，如果多次调用该方法，并且使用相同的name，那么会覆盖上一次的值，这一特性与Map相同；</p>
</li>
<li><p>Object getAttribute(String name)：用来获取ServletContext中的数据，当前在获取之前需要先去存储才行，例如：String value = (String)servletContext.getAttribute(“xxx”);，获取名为xxx的域属性；</p>
</li>
<li><p>void removeAttribute(String name)：用来移除ServletContext中的域属性，如果参数name指定的域属性不存在，那么本方法什么都不做；</p>
</li>
<li><p>Enumeration getAttributeNames()：获取所有域属性的名称；</p>
</li>
</ul>
<h4 id="获取应用初始化参数"><a href="#获取应用初始化参数" class="headerlink" title="获取应用初始化参数"></a>获取应用初始化参数</h4><p>还可以使用ServletContext来获取在web.xml文件中配置的应用初始化参数！注意，应用初始化参数与Servlet初始化参数不同：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>paramName1<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>paramValue1<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>paramName2<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>paramValue2<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ServletContext context = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">String value1 = context.getInitParameter(<span class="string">"paramName1"</span>);</span><br><span class="line">String value2 = context.getInitParameter(<span class="string">"paramName2"</span>);</span><br><span class="line">System.out.println(value1 + <span class="string">", "</span> + value2);</span><br><span class="line"></span><br><span class="line">Enumeration names = context.getInitParameterNames();</span><br><span class="line"><span class="keyword">while</span>(names.hasMoreElements()) &#123;</span><br><span class="line">    System.out.println(names.nextElement());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取资源相关方法"><a href="#获取资源相关方法" class="headerlink" title="获取资源相关方法"></a>获取资源相关方法</h4><p><img src="https://i.loli.net/2020/06/28/pL6JzPvrkig4COR.png" alt></p>
<h5 id="获取真实路径"><a href="#获取真实路径" class="headerlink" title="获取真实路径"></a>获取真实路径</h5><p>还可以使用ServletContext对象来获取Web应用下的资源，例如在hello应用的根目录下创建a.txt文件，现在想在Servlet中获取这个资源，就可以使用ServletContext来获取。</p>
<ul>
<li><p>获取a.txt的真实路径：String realPath = servletContext.getRealPath(“/a.txt”)，realPath的值为a.txt文件的绝对路径：F:\tomcat6\webapps\hello\a.txt；</p>
</li>
<li><p>获取b.txt的真实路径：String realPath = servletContext.getRealPath(“/WEB-INF/b.txt”)；</p>
</li>
</ul>
<h5 id="获取资源流"><a href="#获取资源流" class="headerlink" title="获取资源流"></a>获取资源流</h5><p>不只可以获取资源的路径，还可以通过ServletContext获取资源流，即把资源以输入流的方式获取：</p>
<ul>
<li><p>获取a.txt资源流：InputStream in = servletContext.getResourceAsStream(“/a.txt”)；</p>
</li>
<li><p>获取b.txt资源流：InputStream in = servletContext.getResourceAsStream(“/WEB-INF/b.txt”)；</p>
</li>
</ul>
<h5 id="获取指定目录下所有资源路径"><a href="#获取指定目录下所有资源路径" class="headerlink" title="获取指定目录下所有资源路径"></a>获取指定目录下所有资源路径</h5><p>还可以使用ServletContext获取指定目录下所有资源路径，例如获取/WEB-INF下所有资源的路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set set = context.getResourcePaths(<span class="string">"/WEB-INF"</span>);</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure>

<h4 id="访问量统计"><a href="#访问量统计" class="headerlink" title="访问量统计"></a>访问量统计</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ServletContext application  = <span class="keyword">this</span>.getServletContext();	<span class="comment">// 获取ServletContext对象</span></span><br><span class="line">Integer count = (Integer)application.getAttribute(<span class="string">"count"</span>);	<span class="comment">// 获取对象的count属性</span></span><br><span class="line"><span class="keyword">if</span>(count == <span class="keyword">null</span>) &#123;	<span class="comment">// 如果不存在 则创建访问量 并置1</span></span><br><span class="line">    count = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">response.getWriter().print(<span class="string">"&lt;h1&gt;本页面一共被访问"</span> + count + <span class="string">"次！&lt;/h1&gt;"</span>);	<span class="comment">// 向客户端返访问次数</span></span><br><span class="line">application.setAttribute(<span class="string">"count"</span>, count);	<span class="comment">// 保存</span></span><br></pre></td></tr></table></figure>

<h3 id="获取类路径资源"><a href="#获取类路径资源" class="headerlink" title="获取类路径资源"></a>获取类路径资源</h3><p>这里要讲的是获取类路径下的资源，对于JavaWeb应用而言，就是获取classes目录下的资源。</p>
<p><img src="https://i.loli.net/2020/06/28/qF9RrU4kuT8ZGCb.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = <span class="keyword">this</span>.getClass().getResourceAsStream(<span class="string">"/xxx.txt"</span>);</span><br><span class="line">System.out.println(IOUtils.toString(in));</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">InputStream in = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">"xxx.txt"</span>);</span><br><span class="line">System.out.println(IOUtils.toString(in));</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Class类的getResourceAsStream(String path)：</p>
<ul>
<li>路径以”/“开头，相对classes路径；</li>
<li>路径不以”/“开头，相对当前class文件所有路径，例如在cn.itcast.servlet.MyServlet中执行，那么相对/classes/cn/itcast/servlet/路径；</li>
</ul>
</li>
<li><p>ClassLoader类的getResourceAsStream(String path)：</p>
<ul>
<li>相对classes路径；</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Day-05"><a href="#Day-05" class="headerlink" title="Day 05"></a>Day 05</h2><p><em>29/06/2020</em></p>
<p><img src="https://i.loli.net/2020/06/29/qwGEeM6o1KBzSgk.png" alt="2.png"></p>
<h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><p>response是Servlet.service方法的一个参数，类型为javax.servlet.http.HttpServletResponse。在客户端发出每个请求时，服务器都会创建一个response对象，并传入给Servlet.service()方法。response对象是用来对客户端进行响应的，这说明在service()方法中使用response对象可以完成对客户端的响应工作。</p>
<p>response对象的功能分为以下四种：</p>
<ul>
<li>设置响应头信息；</li>
<li>发送状态码；</li>
<li>设置响应正文；</li>
<li>重定向；</li>
</ul>
<h4 id="响应正文"><a href="#响应正文" class="headerlink" title="响应正文"></a>响应正文</h4><p>response是响应对象，向客户端输出响应正文（响应体）可以使用response的响应流，repsonse一共提供了两个响应流对象：</p>
<ul>
<li><p>PrintWriter out = response.getWriter()：获取字符流；</p>
</li>
<li><p>ServletOutputStream out = response.getOutputStream()：获取字节流；</p>
</li>
</ul>
<p>当然，如果响应正文内容为字符，那么使用response.getWriter()，如果响应内容是字节，例如下载时，那么可以使用response.getOutputStream()。</p>
<p>注意，在一个请求中，不能同时使用这两个流！也就是说，要么你使用repsonse.getWriter()，要么使用response.getOutputStream()，但不能同时使用这两个流。不然会抛出<code>IllegalStateException</code>异常。</p>
<h5 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h5><ul>
<li>字符编码</li>
</ul>
<p>在使用response.getWriter()时需要注意默认字符编码为ISO-8859-1，如果希望设置字符流的字符编码为utf-8，可以使用response.setCharaceterEncoding(“utf-8”)来设置。这样可以保证输出给客户端的字符都是使用UTF-8编码的！</p>
<p>但客户端浏览器并不知道响应数据是什么编码的！如果希望通知客户端使用UTF-8来解读响应数据，那么还是使用response.setContentType(“text/html;charset=utf-8”)方法比较好，因为这个方法不只会调用response.setCharaceterEncoding(“utf-8”)，还会设置content-type响应头，客户端浏览器会使用content-type头来解读响应数据。</p>
<ul>
<li>缓冲区</li>
</ul>
<p>response.getWriter()是PrintWriter类型，所以它有缓冲区，缓冲区的默认大小为8KB。也就是说，在响应数据没有输出8KB之前，数据都是存放在缓冲区中，而不会立刻发送到客户端。当Servlet执行结束后，服务器才会去刷新流，使缓冲区中的数据发送到客户端。</p>
<p>如果希望响应数据马上发送给客户端：</p>
<ul>
<li>向流中写入大于8KB的数据；</li>
<li>调用response.flushBuffer()方法来手动刷新缓冲区；</li>
</ul>
<h4 id="设置响应头"><a href="#设置响应头" class="headerlink" title="设置响应头"></a>设置响应头</h4><p>可以使用response对象的setHeader()方法来设置响应头！使用该方法设置的响应头最终会发送给客户端浏览器！</p>
<ul>
<li><p>response.setHeader(“content-type”, “text/html;charset=utf-8”)：设置content-type响应头，该头的作用是告诉浏览器响应内容为html类型，编码为utf-8。而且同时会设置response的字符流编码为utf-8，即response.setCharaceterEncoding(“utf-8”)；</p>
</li>
<li><p><code>response.setHeader(&quot;Refresh&quot;,&quot;5; URL=http://www.itcast.cn&quot;)</code>：5秒后自动跳转到传智主页。</p>
</li>
</ul>
<h4 id="设置状态码及其他方法"><a href="#设置状态码及其他方法" class="headerlink" title="设置状态码及其他方法"></a>设置状态码及其他方法</h4><ul>
<li><p>response.setContentType(“text/html;charset=utf-8”)：等同与调用response.setHeader(“content-type”, “text/html;charset=utf-8”)；</p>
</li>
<li><p>response.setCharacterEncoding(“utf-8”)：设置字符响应流的字符编码为utf-8； </p>
</li>
<li><p>response.setStatus(200)：设置状态码；</p>
</li>
<li><p>response.sendError(404, “您要查找的资源不存在”)：当发送错误状态码时，Tomcat会跳转到固定的错误页面去，但可以显示错误信息。</p>
</li>
</ul>
<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><p>当你访问<code>http://www.sun.com</code>时，你会发现浏览器地址栏中的URL会变成<code>http://www.oracle.com/us/sun/index.html</code>，这就是重定向了。</p>
<p>重定向是服务器通知浏览器去访问另一个地址，即再发出另一个请求。</p>
<p>响应码为200表示响应成功，而响应码为302表示重定向。所以完成重定向的第一步就是设置响应码为302。</p>
<p>因为重定向是通知浏览器再第二个请求，所以浏览器需要知道第二个请求的URL，所以完成重定向的第二步是设置Location头，指定第二个请求的URL地址。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setStatus(<span class="number">302</span>);</span><br><span class="line">		response.setHeader(<span class="string">"Location"</span>, <span class="string">"http://www.itcast.cn"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码的作用是：当访问AServlet后，会通知浏览器重定向到传智主页。客户端浏览器解析到响应码为302后，就知道服务器让它重定向，所以它会马上获取响应头Location，然后发出第二个请求。</p>
<h5 id="更便捷的重定向"><a href="#更便捷的重定向" class="headerlink" title="更便捷的重定向"></a>更便捷的重定向</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.sendRedirect(<span class="string">"http://www.itcast.cn"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>response.sendRedirect()方法会设置响应头为302，以设置Location响应头。</p>
<p>如果要重定向的URL是在同一个服务器内，那么可以使用相对路径，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.sendRedirect(<span class="string">"/hello/BServlet"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重定向的URL地址为：<code>http://localhost:8080/hello/BServlet</code></p>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><ul>
<li>重定向是两次请求；</li>
<li>重定向的URL可以是其他应用，不局限于当前应用；</li>
<li>重定向的响应头为302，并且必须要有Location响应头；</li>
<li>重定向就不要再使用response.getWriter()或response.getOutputStream()输出数据，不然可能会出现异常；</li>
</ul>
<h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><p>request是Servlet.service()方法的一个参数，类型为javax.servlet.http.HttpServletRequest。在客户端发出每个请求时，服务器都会创建一个request对象，并把请求数据封装到request中，然后在调用Servlet.service()方法时传递给service()方法，这说明在service()方法中可以通过request对象来获取请求数据。</p>
<p>request的功能可以分为以下几种：</p>
<ul>
<li><p>封装了请求头数据；</p>
</li>
<li><p>封装了请求正文数据，如果是GET请求，那么就没有正文；</p>
</li>
<li><p>request是一个域对象，可以把它当成Map来添加获取数据；</p>
</li>
<li><p>request提供了请求转发和请求包含功能。</p>
</li>
</ul>
<h4 id="域方法"><a href="#域方法" class="headerlink" title="域方法"></a>域方法</h4><p>request是域对象！在JavaWeb中一共四个域对象，其中ServletContext就是域对象，它在整个应用中只创建一个ServletContext对象。request其中一个，request可以在一个请求中共享数据。</p>
<p>一个请求会创建一个request对象，如果在一个请求中经历了多个Servlet，那么多个Servlet就可以使用request来共享数据。现在我们还不知道如何在一个请求中经历多个Servlet，后面在学习请求转发和请求包含后就知道了。</p>
<p>下面是request的域方法：</p>
<ul>
<li><p>void setAttribute(String name, Object value)：用来存储一个对象，也可以称之为存储一个域属性，例如：servletContext.setAttribute(“xxx”, “XXX”)，在request中保存了一个域属性，域属性名称为xxx，域属性的值为XXX。请注意，如果多次调用该方法，并且使用相同的name，那么会覆盖上一次的值，这一特性与Map相同；</p>
</li>
<li><p>Object getAttribute(String name)：用来获取request中的数据，当前在获取之前需要先去存储才行，例如：String value = (String)request.getAttribute(“xxx”);，获取名为xxx的域属性；</p>
</li>
<li><p>void removeAttribute(String name)：用来移除request中的域属性，如果参数name指定的域属性不存在，那么本方法什么都不做；</p>
</li>
<li><p>Enumeration getAttributeNames()：获取所有域属性的名称；</p>
</li>
</ul>
<h4 id="request获取请求头数据"><a href="#request获取请求头数据" class="headerlink" title="request获取请求头数据"></a>request获取请求头数据</h4><p>request与请求头相关的方法有：</p>
<ul>
<li><p>String getHeader(String name)：获取指定名称的请求头；</p>
</li>
<li><p>Enumeration getHeaderNames()：获取所有请求头名称；</p>
</li>
<li><p>int getIntHeader(String name)：获取值为int类型的请求头。</p>
</li>
</ul>
<h4 id="request其他方法"><a href="#request其他方法" class="headerlink" title="request其他方法"></a>request其他方法</h4><p>request中还提供了与请求相关的其他方法，有些方法是为了我们更加便捷的方法请求头数据而设计，有些是与请求URL相关的方法。</p>
<ul>
<li><p>int getContentLength()：获取请求体的字节数，GET请求没有请求体，没有请求体返回-1；</p>
</li>
<li><p>String getContentType()：获取请求类型，如果请求是GET，那么这个方法返回null；如果是POST请求，那么默认为application/x-www-form-urlencoded，表示请求体内容使用了URL编码；</p>
</li>
<li><p>String getMethod()：返回请求方法，例如：GET</p>
</li>
<li><p>Locale getLocale()：返回当前客户端浏览器的Locale。java.util.Locale表示国家和言语，这个东西在国际化中很有用；</p>
</li>
<li><p>String getCharacterEncoding()：获取请求体编码，如果没有setCharacterEncoding()，那么返回null，表示使用ISO-8859-1编码；</p>
</li>
<li><p>void setCharacterEncoding(String code)：设置请求编码，只对请求体有效！注意，对于GET而言，没有请求体！！！所以此方法只能对POST请求中的参数有效！</p>
</li>
<li><p>String getContextPath()：返回上下文路径，例如：/hello</p>
</li>
<li><p>String getQueryString()：返回请求URL中的参数，例如：name=zhangSan</p>
</li>
<li><p>String getRequestURI()：返回请求URI路径，例如：/hello/oneServlet</p>
</li>
<li><p>StringBuffer getRequestURL()：返回请求URL路径，例如：<a href="http://localhost/hello/oneServlet，即返回除了参数以外的路径信息；" target="_blank" rel="noopener">http://localhost/hello/oneServlet，即返回除了参数以外的路径信息；</a></p>
</li>
<li><p>String getServletPath()：返回Servlet路径，例如：/oneServlet</p>
</li>
<li><p>String getRemoteAddr()：返回当前客户端的IP地址；</p>
</li>
<li><p>String getRemoteHost()：返回当前客户端的主机名，但这个方法的实现还是获取IP地址；</p>
</li>
<li><p>String getScheme()：返回请求协议，例如：http；</p>
</li>
<li><p>String getServerName()：返回主机名，例如：localhost</p>
</li>
<li><p>int getServerPort()：返回服务器端口号，例如：8080</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/06/29/WPFQOAz9i1ENkKC.png" alt="2.png"></p>
<p>eg. 可以使用request.getRemoteAddr()方法获取客户端的IP地址，然后判断IP是否为禁用IP。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String ip = request.getRemoteAddr();</span><br><span class="line">System.out.println(ip);</span><br><span class="line"><span class="keyword">if</span>(ip.equals(<span class="string">"127.0.0.1"</span>)) &#123;</span><br><span class="line">    response. getWriter().print(<span class="string">"您的IP已被禁止！"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.getWriter().print(<span class="string">"Hello!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="request获取请求参数"><a href="#request获取请求参数" class="headerlink" title="request获取请求参数"></a>request获取请求参数</h4><p>最为常见的客户端传递参数方式有两种：</p>
<ul>
<li><p>浏览器地址栏直接输入：一定是GET请求；</p>
</li>
<li><p>超链接：一定是GET请求；</p>
</li>
<li><p>表单：可以是GET，也可以是POST，这取决与<code>&lt;form&gt;</code>的method属性值；</p>
</li>
</ul>
<p>GET请求和POST请求的区别：</p>
<ul>
<li><p>GET请求：</p>
<ul>
<li><p>请求参数会在浏览器的地址栏中显示，所以不安全；</p>
</li>
<li><p>请求参数长度限制长度在1K之内；</p>
</li>
<li><p>GET请求没有请求体，无法通过request.setCharacterEncoding()来设置参数的编码；</p>
</li>
</ul>
</li>
<li><p>POST请求：</p>
<ul>
<li><p>请求参数不会显示浏览器的地址栏，相对安全；</p>
</li>
<li><p>请求参数长度没有限制；</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/hello/ParamServlet?p1=v1&amp;p2=v2"</span>&gt;</span>超链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/hello/ParamServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    参数1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"p1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    参数2：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"p2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面是使用request获取请求参数的API：</p>
<ul>
<li>String getParameter(String name)：通过指定名称获取参数值；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String v1 = request.getParameter(<span class="string">"p1"</span>);</span><br><span class="line">    String v2 = request.getParameter(<span class="string">"p2"</span>);</span><br><span class="line">    System.out.println(<span class="string">"p1="</span> + v1);</span><br><span class="line">    System.out.println(<span class="string">"p2="</span> + v2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String v1 = request.getParameter(<span class="string">"p1"</span>);</span><br><span class="line">    String v2 = request.getParameter(<span class="string">"p2"</span>);</span><br><span class="line">    System.out.println(<span class="string">"p1="</span> + v1);</span><br><span class="line">    System.out.println(<span class="string">"p2="</span> + v2);		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>String[] getParameterValues(String name)：当多个参数名称相同时，可以使用方法来获取；</p>
</li>
<li><p>Enumeration getParameterNames()：获取所有参数的名字；</p>
</li>
<li><p>Map getParameterMap()：获取所有参数封装到Map中，其中key为参数名，value为参数值，因为一个参数名称可能有多个值，所以参数值是String[]，而不是String。</p>
</li>
</ul>
<h4 id="请求转发与请求包含"><a href="#请求转发与请求包含" class="headerlink" title="请求转发与请求包含"></a>请求转发与请求包含</h4><p>无论是请求转发还是请求包含，都表示由多个Servlet共同来处理一个请求。例如Servlet1来处理请求，然后Servlet1又转发给Servlet2来继续处理这个请求。</p>
<h5 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h5><p>在AServlet中，把请求转发到BServlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"AServlet"</span>);</span><br><span class="line">		RequestDispatcher rd = request.getRequestDispatcher(<span class="string">"/BServlet"</span>);</span><br><span class="line">		rd.forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------------------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"BServlet"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="请求包含"><a href="#请求包含" class="headerlink" title="请求包含"></a>请求包含</h5><p>在AServlet中，把请求包含到BServlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"AServlet"</span>);</span><br><span class="line">		RequestDispatcher rd = request.getRequestDispatcher(<span class="string">"/BServlet"</span>);</span><br><span class="line">		rd.include (request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"BServlet"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="请求转发与请求包含比较"><a href="#请求转发与请求包含比较" class="headerlink" title="请求转发与请求包含比较"></a>请求转发与请求包含比较</h5><ul>
<li><p>如果在AServlet中请求转发到BServlet，那么在AServlet中就不允许再输出响应体，即不能再使用response.getWriter()和response.getOutputStream()向客户端输出，这一工作应该由BServlet来完成；如果是使用请求包含，那么没有这个限制；</p>
</li>
<li><p>请求转发虽然不能输出响应体，但还是可以设置响应头的，例如：response.setContentType(“text/html;charset=utf-8”);</p>
</li>
<li><p>请求包含大多是应用在JSP页面中，完成多页面的合并；</p>
</li>
<li><p>请求转发大多是应用在Servlet中，转发目标大多是JSP页面；</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/06/29/w7TlOmZHXcECJY3.png" alt="2.png"></p>
<h5 id="请求转发与重定向比较"><a href="#请求转发与重定向比较" class="headerlink" title="请求转发与重定向比较"></a>请求转发与重定向比较</h5><ul>
<li><p>请求转发是一个请求，而重定向是两个请求；</p>
</li>
<li><p>请求转发后浏览器地址栏不会有变化，而重定向会有变化，因为重定向是两个请求；</p>
</li>
<li><p>请求转发的目标只能是本应用中的资源，重定向的目标可以是其他应用；</p>
</li>
<li><p>请求转发对AServlet和BServlet的请求方法是相同的，即要么都是GET，要么都是POST，因为请求转发是一个请求；</p>
</li>
<li><p>重定向的第二个请求一定是GET；</p>
</li>
</ul>
<h3 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h3><p>与路径相关的操作</p>
<ul>
<li><p>超链接</p>
</li>
<li><p>表单</p>
</li>
<li><p>转发</p>
</li>
<li><p>包含</p>
</li>
<li><p>重定向</p>
</li>
<li><p><code>&lt;url-pattern&gt;</code></p>
</li>
<li><p>ServletContext获取资源</p>
</li>
<li><p>Class获取资源</p>
</li>
<li><p>ClassLoader获取资源</p>
</li>
</ul>
<h4 id="客户端路径"><a href="#客户端路径" class="headerlink" title="客户端路径"></a>客户端路径</h4><p>超链接、表单、重定向都是客户端路径，客户端路径可以分为三种方式：</p>
<ul>
<li><p>绝对路径；</p>
</li>
<li><p>以”/“开头的相对路径；</p>
</li>
<li><p>不以”/“开头的相对路径；</p>
</li>
</ul>
<p>例如：<code>http://localhost:8080/hello1/pages/a.html</code>中的超链接和表单如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">绝对路径：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://localhost:8080/hello2/index.html"</span>&gt;</span>链接1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">客户端路径：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/hello3/pages/index.html"</span>&gt;</span>链接2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">相对路径：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"index.html"</span>&gt;</span>链接3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">绝对路径：</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:8080/hello2/index.html"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"表单1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">客户端路径：</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/hello2/index.html"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"表单2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">相对路径：</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"index.html"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"表单3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>链接1和表单1：没什么可说的，它使用绝对路径；</p>
</li>
<li><p>链接2和表单2：以”/“开头，相对主机，与当前a.html的主机相同，即最终访问的页面为<code>http://localhost:8080/hello2/index.html</code>；</p>
</li>
<li><p>链接3和表单3：不以”/“开头，相对当前页面的路径，即a.html所有路径，即最终访问的路径为：<code>http://localhost:8080/hello1/pages/index.html</code>；</p>
</li>
</ul>
<h5 id="建议使用”-“"><a href="#建议使用”-“" class="headerlink" title="建议使用”/“"></a>建议使用”/“</h5><p>强烈建议使用”/“开头的路径，这说明在页面中的超链接和表单都要以”/“开头，后面是当前应用的名称，再是访问路径：</p>
<p><code>&lt;form action=&quot;/hello/servlet/AServlet&quot;&gt;</code></p>
<p><code>&lt;/form&gt;</code></p>
<p><code>&lt;a href=&quot;/hello/b.html&quot;&gt;链接&lt;/a&gt;</code></p>
<p>其中/hello是当前应用名称，这也说明如果将来修改了应用名称，那么页面中的所有路径也要修改，这一点确实是个问题。这一问题的处理方案会在学习了JSP之后讲解！</p>
<p>在Servlet中的重定向也建议使用”/“开头。同理，也要给出应用的名称！例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">"/hello/BServlet"</span>);</span><br></pre></td></tr></table></figure>

<p>其中/hello是当前应用名，如果将来修改了应用名称，那么也要修改所有重定向的路径，这一问题的处理方案是使用request.getContextPath()来获取应用名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(request.getContextPath() + <span class="string">"/BServlet"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="服务器端路径"><a href="#服务器端路径" class="headerlink" title="服务器端路径"></a>服务器端路径</h4><p>服务器端路径必须是相对路径，不能是绝对路径。但相对路径有两种形式：</p>
<ul>
<li><p>以”/“开头；</p>
</li>
<li><p>不以”/“开头；</p>
</li>
</ul>
<p>其中请求转发、请求包含都是服务器端路径，服务器端路径与客户端路径的区别是：</p>
<ul>
<li><p>客户端路径以”/“开头：相对当前主机；</p>
</li>
<li><p>服务器端路径以”/“开头：相对当前应用；</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.getRequestDispatcher(<span class="string">"/BServlet"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设访问AServlet的路径为：<code>http://localhost:8080/hello/servlet/AServlet</code></p>
<p>因为路径以”/“开头，所以相对当前应用，即<code>http://localhost:8080/hello/BServlet</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.getRequestDispatcher(<span class="string">"BServlet"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设访问AServlet的路径为：<code>http://localhost:8080/hello/servlet/AServlet</code></p>
<p>因为路径不以”/“开头，所以相对当前应用，即<code>http://localhost:8080/hello/servlet/BServlet</code>。</p>
<h4 id="lt-url-pattern-gt-路径"><a href="#lt-url-pattern-gt-路径" class="headerlink" title="&lt;url-pattern&gt;路径"></a><code>&lt;url-pattern&gt;</code>路径</h4><p><code>&lt;url-pattern&gt;</code>必须使用”/“开头，并且相对的是当前应用。</p>
<h4 id="ServletContext获取资源"><a href="#ServletContext获取资源" class="headerlink" title="ServletContext获取资源"></a>ServletContext获取资源</h4><p>必须是相对路径，可以”/“开头，也可以不使用”/“开头，但无论是否使用”/“开头都是相对当前应用路径。</p>
<p>例如在AServlet中获取资源，AServlet的路径路径为：<code>http://localhost:8080/hello/servlet/AServlet</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String path1 = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"a.txt"</span>);</span><br><span class="line">		String path2 = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/a.txt"</span>);</span><br><span class="line">		System.out.println(path1);</span><br><span class="line">		System.out.println(path2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>path1和path2是相同的结果：<code>http://localhost:8080/hello/a.txt</code></p>
<h4 id="Class获取资源"><a href="#Class获取资源" class="headerlink" title="Class获取资源"></a>Class获取资源</h4><p>Class获取资源也必须是相对路径，可以”/“开头，也可以不使用”/“开头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		InputStream in = Demo.class.getResourceAsStream("/a.txt");</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		InputStream in = Demo.class.getResourceAsStream("a.txt");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中fun1()方法获取资源时以”/“开头，那么相对的是当前类路径，即/hello/WEB-INF/classes/a.txt文件；</p>
<p>其中fun2()方法获取资源时没有以”/“开头，那么相对当前Demo.class所在路径，因为Demo类在cn.itcast包下，所以资源路径为：/hello/WEB-INF/classes/cn/itcast/a.txt。</p>
<h4 id="ClassLoader获取资源"><a href="#ClassLoader获取资源" class="headerlink" title="ClassLoader获取资源"></a>ClassLoader获取资源</h4><p>ClassLoader获取资源也必须是相对路径，可以”/“开头，也可以不使用”/“开头。但无论是否以”/“开头，资源都是相对当前类路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		InputStream in = Demo.class.getClassLoader().getResourceAsStream("/a.txt");</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		InputStream in = Demo.class.getClassLoader().getResourceAsStream("a.txt");</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>fun1()和fun2()方法的资源都是相对类路径，即classes目录，即/hello/WEB-INF/classes/a.txt</p>
<h3 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h3><h4 id="请求编码"><a href="#请求编码" class="headerlink" title="请求编码"></a>请求编码</h4><h5 id="直接在地址栏中给出中文"><a href="#直接在地址栏中给出中文" class="headerlink" title="直接在地址栏中给出中文"></a>直接在地址栏中给出中文</h5><p>请求数据是由客户端浏览器发送服务器的，请求数据的编码是由浏览器决定的。例如在浏览器地址栏中给出：<code>http://localhost:8080/hello/AServlet?name=传智</code>，那么其中”传智”是什么编码的呢？不同浏览器使用不同的编码，所以这是不确定的！</p>
<ul>
<li><p>IE：使用GB2312；</p>
</li>
<li><p>FireFox：使用GB2312；</p>
</li>
<li><p>Chrome：使用UTF-8； </p>
</li>
</ul>
<p>通常没有哪个应用要求用户在浏览器地址栏中输入请求数据的，所以大家只需了解一下即可。</p>
<h5 id="在页面中发出请求"><a href="#在页面中发出请求" class="headerlink" title="在页面中发出请求"></a>在页面中发出请求</h5><p>通常向服务器发送请求数据都需要先请求一个页面，然后用户在页面中输入数据。页面中有超链接和表单，通过超链接和表单就可以向服务器发送数据了。</p>
<p>因为页面是服务器发送到客户端浏览器的，所以这个页面本身的编码由服务器决定。而用户在页面中输入的数据也是由页面本身的编码决定的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/hello/servlet/AServlet"</span>&gt;</span></span><br><span class="line">  名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/hello/servlet/AServlet?name=传智"</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当用户在index.html页面中输入数据时，都是UTF-8列表的。因为这个页面本身就是UTF-8编码的！</p>
<p><strong>页面的编译就是页面中输入数据的编码。</strong></p>
<h5 id="GET请求解读编码"><a href="#GET请求解读编码" class="headerlink" title="GET请求解读编码"></a>GET请求解读编码</h5><p>当客户端通过GET请求发送数据给服务器时，使用request.getParameter()获取的数据是被服务器误认为ISO-8859-1编码的，也就是说客户端发送过来的数据无论是UTF-8还是GBK，服务器都认为是ISO-8859-1，这就说明我们需要在使用request.getParameter()获取数据后，再转发成正确的编码。</p>
<p>例如客户端以UTF-8发送的数据，使用如下转码方式：</p>
<p>String name = request.getParameter(“name”);</p>
<p>name = new String(name.getBytes(“iso-8859-1”), “utf-8”);</p>
<h5 id="POST请求解读编码"><a href="#POST请求解读编码" class="headerlink" title="POST请求解读编码"></a>POST请求解读编码</h5><p>当客户端通过POST请求发送数据给服务器时，可以在使用request.getParameter()获取请求参数之前先通过request.setCharacterEncoding()来指定编码，然后再使用reuqest.getParameter()方法来获取请求参数，那么就是用指定的编码来读取了。</p>
<p>也就是说，如果是POST请求，服务器可以指定编码！但如果没有指定编码，那么默认还是使用ISO-8859-1来解读。</p>
<p>request.setCharacterEncoding(“utf-8”);</p>
<p>String name = request.getParameter(“name”);</p>
<h4 id="响应编码"><a href="#响应编码" class="headerlink" title="响应编码"></a>响应编码</h4><p>响应：服务器发送给客户端数据！响应是由response对象来完成，如果响应的数据不是字符数据，那么就无需去考虑编码问题。当然，如果响应的数据是字符数据，那么就一定要考虑编码的问题了。</p>
<p>response.getWriter().print(“传智”);</p>
<p>上面代码因为没有设置repsonse.getWriter()字符流的编码，所以服务器使用默认的编码（ISO-8859-1）来处理，因为ISO-8859-1不支持中文，所以一定会出现乱码的。</p>
<p>所以在使用response.getWriter()发送数据之前，一定要设置response.getWriter()的编码，这需要使用response.setCharacterEncoding()方法：</p>
<p>response.setCharacterEncoding(“utf-8”);</p>
<p>response.getWriter().print(“传智”);</p>
<p>上面代码因为在使用response.getWriter()输出之前已经设置了编码，所以输出的数据为utf-8编码。但是，因为没有告诉浏览器使用什么编码来读取响应数据，所以很可能浏览器会出现错误的解读，那么还是会出现乱码的。当然，通常浏览器都支持来设置当前页面的编码，如果用户在看到编码时，去设置浏览器的编码，如果设置的正确那么乱码就会消失。但是我们不能让用户总去自己设置编码，而且应该直接通知浏览器，服务器发送过来的数据是什么编码，这样浏览器就直接使用服务器告诉他的编码来解读！这需要使用content-type响应头。</p>
<p>response.setContentType(“text/html;charset=utf-8”);</p>
<p>response.getWriter().print(“传智”);</p>
<p>上面代码使用setContentType()方法设置了响应头content-type编码为utf-8，这不只是在响应中添加了响应头，还等于调用了一次response.setCharacterEncoding(“utf-8”)，也就是说，通过我们只需要调用一次response.setContentType(“text/html;charset=utf-8”)即可，而无需再去调用response.setCharacterEncoding(“utf-8”)了。</p>
<p>在静态页面中，使用<code>&lt;meta&gt;</code>来设置content-type响应头，例如：</p>
<p><code>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</code></p>
<h4 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h4><p>通过页面传输数据给服务器时，如果包含了一些特殊字符是无法发送的。这时就需要先把要发送的数据转换成URL编码格式，再发送给服务器。</p>
<p>其实需要我们自己动手给数据转换成URL编码的只有GET超链接，因为表单发送数据会默认使用URL编码，也就是说，不用我们自己来编码。</p>
<p>例如：”传智”这两个字通过URL编码后得到的是：”%E4%BC%A0%E6%99%BA”。URL编码是先需要把”传智”转换成字节，例如我们现在使用UTF-8把”传智”转换成字符，得到的结果是：”[-28, -68, -96, -26, -103, -70]”，然后再把所有负数加上256，得到[228, 188, 160, 230, 153, 186]，再把每个int值转换成16进制，得到[E4, BC, A0, E6, 99, BA]，最后再每个16进制的整数前面加上”%”。</p>
<p>通过URL编码，把”传智”转换成了”%E4%BC%A0%E6%99%BA”，然后发送给服务器！服务器会自动识别出数据是使用URL编码过的，然后会自动把数据转换回来。</p>
<p>当然，在页面中我们不需要自己去通过上面的过程把”传智”转换成”%E4%BC%A0%E6%99%BA”，而是使用Javascript来完成即可。当后面我们学习了JSP后，就不用再使用Javascript了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">_go</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        location = <span class="string">"/day05_2/AServlet?name="</span> + <span class="built_in">encodeURIComponent</span>(<span class="string">"传智+播客"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为URL默认只支持ISO-8859-1，这说明在URL中出现中文和一些特殊字符可能无法发送到服务器。所以我们需要对包含中文或特殊字符的URL进行URL编码。</p>
<p>服务器会自动识别数据是否使用了URL编码，如果使用了服务器会自动把数据解码，无需我们自己动手解码。</p>
<p>String s = “传智”;</p>
<p>s = URLEncoder.encode(s, “utf-8”);// %E4%BC%A0%E6%99%BA</p>
<p>s = URLDecoderdecode(s, “utf-8”);//传智</p>
<hr>
<h2 id="Day-06"><a href="#Day-06" class="headerlink" title="Day 06"></a>Day 06</h2><p><em>30/06/2020</em></p>
<h3 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h3><p>JSP（Java Server Pages）是JavaWeb服务器端的<strong>动态资源</strong>。它与html页面的作用是相同的，<strong>显示数据和获取数据</strong>。</p>
<p>JSP = html + Java脚本（代码片段） + JSP动作标签</p>
<h4 id="JSP语法"><a href="#JSP语法" class="headerlink" title="JSP语法"></a>JSP语法</h4><h5 id="JSP-脚本"><a href="#JSP-脚本" class="headerlink" title="JSP 脚本"></a>JSP 脚本</h5><p>JSP脚本就是Java代码片段，它分为三种：</p>
<ul>
<li><p><code>&lt;%...%&gt;</code>：Java语句；</p>
</li>
<li><p><code>&lt;%=…%&gt;</code>：Java表达式；</p>
</li>
<li><p><code>&lt;%!...%&gt;</code>：Java定义类成员；</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">	&lt;title&gt;JSP演示&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;JSP演示&lt;/h1&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    	<span class="comment">// Java语句</span></span><br><span class="line">    	String s1 = <span class="string">"hello jsp"</span>;</span><br><span class="line">    	<span class="comment">// 不会输出到客户端，而是在服务器端的控制台打印</span></span><br><span class="line">    	System.out.println(s1);</span><br><span class="line">    %&gt;</span><br><span class="line">  &lt;!-- 输出到客户端浏览器上 --&gt;</span><br><span class="line">    输出变量：&lt;%=s1 %&gt;&lt;br/&gt;</span><br><span class="line">    输出<span class="keyword">int</span>类型常量：&lt;%=<span class="number">100</span> %&gt;&lt;br/&gt;</span><br><span class="line">    输出String类型常量：&lt;%=<span class="string">"你好"</span> %&gt;&lt;br/&gt;</span><br><span class="line">    &lt;br/&gt;</span><br><span class="line">    使用表达式输出常量是很傻的一件事，因为可以直接使用html即可，下面是输出上面的常量：&lt;br/&gt;</span><br><span class="line">    <span class="number">100</span>&lt;br/&gt;</span><br><span class="line">    你好   </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h5 id="内置对象-out"><a href="#内置对象-out" class="headerlink" title="内置对象 out"></a>内置对象 out</h5><p>out对象在JSP页面中无需创建就可以使用，它的作用是用来向客户端输出。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;out.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    <span class="comment">//向客户端输出</span></span><br><span class="line">    out.print(<span class="string">"你好！"</span>);</span><br><span class="line">    </span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>其中<code>&lt;%=…%&gt;</code>与<code>out.print()</code>功能是相同的！它们都是向客户端输出，例如：</p>
<p><code>&lt;%=s1%&gt;</code>等同于<code>&lt;% out.print(s1); %&gt;</code></p>
<p><code>&lt;%=&quot;hello&quot;%&gt;</code>等同于<code>&lt;% out.print(&quot;hello&quot;); %&gt;</code>，也等同于直接在页面中写hello一样。</p>
<h5 id="多个-lt-gt-可以通用"><a href="#多个-lt-gt-可以通用" class="headerlink" title="多个&lt;%...%&gt;可以通用"></a>多个<code>&lt;%...%&gt;</code>可以通用</h5><p>在一个JSP中多个&lt;%…%&gt;是相通的。例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;out.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    String s = <span class="string">"hello"</span>;</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">    out.print(s);</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>循环打印表格：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;表格&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;table border=<span class="string">"1"</span> width=<span class="string">"50%"</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;用户名&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;密码&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;	</span><br><span class="line">            %&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=i+1 %&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;user&lt;%=i %&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=100 + 1 %&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        &#125;</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h4 id="JSP-原理"><a href="#JSP-原理" class="headerlink" title="JSP 原理"></a>JSP 原理</h4><p>JSP是一种特殊的Servlet，当JSP页面首次被访问时，容器（Tomcat）会先把JSP编译成Servlet，然后再去执行Servlet。所以JSP其实就是一个Servlet！</p>
<p><img src="https://i.loli.net/2020/06/30/Te17gIh5qb2FHWE.png" alt="2.png"></p>
<h5 id="JSP真身存放目录"><a href="#JSP真身存放目录" class="headerlink" title="JSP真身存放目录"></a>JSP真身存放目录</h5><p>JSP生成的Servlet存放在${CATALANA}/work目录下，我经常开玩笑的说，它是JSP的”真身”。我们打开看看其中的内容，了解一下JSP的”真身”。</p>
<p>你会发现，在JSP中的静态信息（例如<code>&lt;html&gt;</code>等）在”真身”中都是使用out.write()完成打印！这些静态信息都是作为字符串输出给了客户端。</p>
<p>JSP的整篇内容都会放到名为<code>_jspService</code>的方法中！你可能会说<code>&lt;@page&gt;</code>不在”真身”中，<code>&lt;%@page&gt;</code>我们明天再看。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(<span class="keyword">final</span> javax.servlet.http.HttpServletRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException, javax.servlet.ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> javax.servlet.jsp.PageContext pageContext;</span><br><span class="line">    javax.servlet.http.HttpSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletContext application;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletConfig config;</span><br><span class="line">    javax.servlet.jsp.JspWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> java.lang.Object page = <span class="keyword">this</span>;</span><br><span class="line">    javax.servlet.jsp.JspWriter _jspx_out = <span class="keyword">null</span>;</span><br><span class="line">    javax.servlet.jsp.PageContext _jspx_page_context = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">      			<span class="keyword">null</span>, <span class="keyword">true</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      session = pageContext.getSession();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line"></span><br><span class="line">…	<span class="comment">// JSP页面中的内容都会在这个位置出现！这时上面所说的对象已经创建完了，所以在JSP页面中是可以使用的。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JSP脚本"><a href="#JSP脚本" class="headerlink" title="JSP脚本"></a>JSP脚本</h4><p>JSP脚本一共三种形式：</p>
<ul>
<li><p><code>&lt;%...%&gt;</code>：内容会直接放到”真身”中；</p>
</li>
<li><p><code>&lt;%=…%&gt;</code>：内容会放到out.print()中，作为out.print()的参数；</p>
</li>
<li><p><code>&lt;%!…%&gt;</code>：内容会放到_jspService()方法之外，被类直接包含；</p>
</li>
</ul>
<p>前面已经讲解了<code>&lt;%...%&gt;</code>和<code>&lt;%=…%&gt;</code>，但还没有讲解<code>&lt;%!...%&gt;</code>的作用！</p>
<p>现在我们已经知道了，JSP其实就是一个类，一个Servlet类。<code>&lt;%!...%&gt;</code>的作用是在类中添加方法或成员的，所以<code>&lt;%!...%&gt;</code>中的内容不会出现在<code>_jspService()</code>中。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"hello JSP!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<h4 id="JSP注释"><a href="#JSP注释" class="headerlink" title="JSP注释"></a>JSP注释</h4><p>我们现在已经知道JSP是需要先编译成.java，再编译成.class的。其中<code>&lt;%-- ... --%&gt;</code>中的内容在JSP编译成.java时会被忽略的，即JSP注释。</p>
<p>也可以在JSP页面中使用html注释：<code>&lt;!-- … --&gt;</code>，但这个注释在JSP编译成的.java中是存在的，它不会被忽略，而且会被发送到客户端浏览器。但是在浏览器显示服务器发送过来的html时，因为<code>&lt;!-- … --&gt;</code>是html的注释，所以浏览器是不会显示它的。</p>
<p><img src="https://i.loli.net/2020/06/30/5Cr37imLUd9pPsl.png" alt="2.png"></p>
<h3 id="会话跟踪技术"><a href="#会话跟踪技术" class="headerlink" title="会话跟踪技术"></a>会话跟踪技术</h3><h4 id="什么是会话跟踪技术"><a href="#什么是会话跟踪技术" class="headerlink" title="什么是会话跟踪技术"></a>什么是会话跟踪技术</h4><p>我们需要先了解一下什么是会话！可以把会话理解为客户端与服务器之间的一次会晤，在一次会晤中可能会包含多次请求和响应。例如你给10086打个电话，你就是客户端，而10086服务人员就是服务器了。从双方接通电话那一刻起，会话就开始了，到某一方挂断电话表示会话结束。在通话过程中，你会向10086发出多个请求，那么这多个请求都在一个会话中。</p>
<p>在JavaWeb中，客户向某一服务器发出第一个请求开始，会话就开始了，直到客户关闭了浏览器会话结束。</p>
<p>在一个会话的多个请求中共享数据，这就是会话跟踪技术。例如在一个会话中的请求如下：</p>
<ul>
<li><p>请求银行主页；</p>
</li>
<li><p>请求登录（请求参数是用户名和密码）；</p>
</li>
<li><p>请求转账（请求参数与转账相关的数据）；</p>
</li>
<li><p>请求信誉卡还款（请求参数与还款相关的数据）。</p>
</li>
</ul>
<p>在这上会话中当前用户信息必须在这个会话中共享的，因为登录的是张三，那么在转账和还款时一定是相对张三的转账和还款！这就说明我们必须在一个会话过程中有共享数据的能力。</p>
<h4 id="会话路径技术使用Cookie或session完成"><a href="#会话路径技术使用Cookie或session完成" class="headerlink" title="会话路径技术使用Cookie或session完成"></a>会话路径技术使用Cookie或session完成</h4><p>我们知道HTTP协议是无状态协议，也就是说每个请求都是独立的！无法记录前一次请求的状态。但HTTP协议中可以使用Cookie来完成会话跟踪！</p>
<p>在JavaWeb中，使用session来完成会话跟踪，session底层依赖Cookie技术。</p>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><h4 id="Cookie概述"><a href="#Cookie概述" class="headerlink" title="Cookie概述"></a>Cookie概述</h4><p>Cookie翻译成中文是小甜点，小饼干的意思。在HTTP中它表示服务器送给客户端浏览器的小甜点。其实Cookie就是一个键和一个值构成的，随着服务器端的响应发送给客户端浏览器。然后客户端浏览器会把Cookie保存起来，当下一次再访问服务器时把Cookie再发送给服务器。</p>
<p><img src="https://i.loli.net/2020/06/30/RhIEKGckm4Zg29a.png" alt="2.png"></p>
<p>Cookie是由服务器创建，然后通过响应发送给客户端的一个键值对。客户端会保存Cookie，并会标注出Cookie的来源（哪个服务器的Cookie）。当客户端向服务器发出请求时会把所有这个服务器Cookie包含在请求中发送给服务器，这样服务器就可以识别客户端了！</p>
<h5 id="Cookie规范"><a href="#Cookie规范" class="headerlink" title="Cookie规范"></a>Cookie规范</h5><ul>
<li><p>Cookie大小上限为4KB；</p>
</li>
<li><p>一个服务器最多在客户端浏览器上保存20个Cookie；</p>
</li>
<li><p>一个浏览器最多保存300个Cookie；</p>
</li>
</ul>
<p>上面的数据只是HTTP的Cookie规范，但在浏览器大战的今天，一些浏览器为了打败对手，为了展现自己的能力起见，可能对Cookie规范”扩展”了一些，例如每个Cookie的大小为8KB，最多可保存500个Cookie等！但也不会出现把你硬盘占满的可能！</p>
<p>注意，不同浏览器之间是不共享Cookie的。也就是说在你使用IE访问服务器时，服务器会把Cookie发给IE，然后由IE保存起来，当你在使用FireFox访问服务器时，不可能把IE保存的Cookie发送给服务器。</p>
<h5 id="Cookie与HTTP头"><a href="#Cookie与HTTP头" class="headerlink" title="Cookie与HTTP头"></a>Cookie与HTTP头</h5><p>Cookie是通过HTTP请求和响应头在客户端和服务器端传递的：</p>
<ul>
<li>Cookie：请求头，客户端发送给服务器端；<ul>
<li>格式：Cookie: a=A; b=B; c=C。即多个Cookie用分号离开；</li>
</ul>
</li>
<li>Set-Cookie：响应头，服务器端发送给客户端；<ul>
<li>一个Cookie对应一个Set-Cookie：</li>
<li>Set-Cookie: a=A</li>
<li>Set-Cookie: b=B</li>
<li>Set-Cookie: c=C</li>
</ul>
</li>
</ul>
<h5 id="Cookie的覆盖"><a href="#Cookie的覆盖" class="headerlink" title="Cookie的覆盖"></a>Cookie的覆盖</h5><p>如果服务器端发送重复的Cookie那么会覆盖原有的Cookie，例如客户端的第一个请求服务器端发送的Cookie是：Set-Cookie: a=A；第二请求服务器端发送的是：Set-Cookie: a=AA，那么客户端只留下一个Cookie，即：a=AA。</p>
<h5 id="Cookie第一例"><a href="#Cookie第一例" class="headerlink" title="Cookie第一例"></a>Cookie第一例</h5><p>我们这个案例是，客户端访问AServlet，AServlet在响应中添加Cookie，浏览器会自动保存Cookie。然后客户端访问BServlet，这时浏览器会自动在请求中带上Cookie，BServlet获取请求中的Cookie打印出来。</p>
<p><img src="https://i.loli.net/2020/06/30/TDbBVqmEUscFHMj.png" alt="2.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AServlet.java</span></span><br><span class="line"><span class="keyword">package</span> cn.itcast.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给客户端发送Cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		String id = UUID.randomUUID().toString();<span class="comment">//生成一个随机字符串</span></span><br><span class="line">		Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"id"</span>, id);<span class="comment">//创建Cookie对象，指定名字和值</span></span><br><span class="line">		response.addCookie(cookie);<span class="comment">//在响应中添加Cookie对象</span></span><br><span class="line">		response.getWriter().print(<span class="string">"已经给你发送了ID"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BServlet.java</span></span><br><span class="line"><span class="keyword">package</span> cn.itcast.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取客户端请求中的Cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		Cookie[] cs = request.getCookies();<span class="comment">//获取请求中的Cookie</span></span><br><span class="line">		<span class="keyword">if</span>(cs != <span class="keyword">null</span>) &#123;<span class="comment">//如果请求中存在Cookie</span></span><br><span class="line">			<span class="keyword">for</span>(Cookie c : cs) &#123;<span class="comment">//遍历所有Cookie</span></span><br><span class="line">				<span class="keyword">if</span>(c.getName().equals(<span class="string">"id"</span>)) &#123;<span class="comment">//获取Cookie名字，如果Cookie名字是id</span></span><br><span class="line">					response.getWriter().print(<span class="string">"您的ID是："</span> + c.getValue());<span class="comment">//打印Cookie值</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cookie-生命"><a href="#Cookie-生命" class="headerlink" title="Cookie 生命"></a>Cookie 生命</h4><h5 id="什么是Cookie的生命"><a href="#什么是Cookie的生命" class="headerlink" title="什么是Cookie的生命"></a>什么是Cookie的生命</h5><p>Cookie不只是有name和value，Cookie还有生命。所谓生命就是Cookie在客户端的有效时间，可以通过setMaxAge(int)来设置Cookie的有效时间。</p>
<ul>
<li><p>cookie.setMaxAge(-1)：cookie的maxAge属性的默认值就是-1，表示只在浏览器内存中存活。一旦关闭浏览器窗口，那么cookie就会消失。</p>
</li>
<li><p>cookie.setMaxAge(60*60)：表示cookie对象可存活1小时。当生命大于0时，浏览器会把Cookie保存到硬盘上，就算关闭浏览器，就算重启客户端电脑，cookie也会存活1小时；</p>
</li>
<li><p>cookie.setMaxAge(0)：cookie生命等于0是一个特殊的值，它表示cookie被作废！也就是说，如果原来浏览器已经保存了这个Cookie，那么可以通过Cookie的setMaxAge(0)来删除这个Cookie。无论是在浏览器内存中，还是在客户端硬盘上都会删除这个Cookie。 </p>
</li>
</ul>
<h5 id="案例：显示上次访问时间"><a href="#案例：显示上次访问时间" class="headerlink" title="案例：显示上次访问时间"></a>案例：显示上次访问时间</h5><ul>
<li><p>创建Cookie，名为lasttime，值为当前时间，添加到response中；</p>
</li>
<li><p>在AServlet中获取请求中名为lasttime的Cookie；</p>
</li>
<li><p>如果不存在输出”您是第一次访问本站”，如果存在输出”您上一次访问本站的时间是xxx”；</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AServlet.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"lasttime"</span>, <span class="keyword">new</span> Date().toString());	<span class="comment">// 这里可能会出现小bug</span></span><br><span class="line">    cookie.setMaxAge(<span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">    response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">    Cookie[] cs = request.getCookies();</span><br><span class="line">    String s = <span class="string">"您是首次访问本站！"</span>;</span><br><span class="line">    <span class="keyword">if</span>(cs != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Cookie c : cs) &#123;</span><br><span class="line">            <span class="keyword">if</span>(c.getName().equals(<span class="string">"lasttime"</span>)) &#123;</span><br><span class="line">                s = <span class="string">"您上次的访问时间是："</span> + c.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response.getWriter().print(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cookie的path"><a href="#Cookie的path" class="headerlink" title="Cookie的path"></a>Cookie的path</h4><h5 id="什么是Cookie的路径"><a href="#什么是Cookie的路径" class="headerlink" title="什么是Cookie的路径"></a>什么是Cookie的路径</h5><p>现在有WEB应用A，向客户端发送了10个Cookie，这就说明客户端无论访问应用A的哪个Servlet都会把这10个Cookie包含在请求中！但是也许只有AServlet需要读取请求中的Cookie，而其他Servlet根本就不会获取请求中的Cookie。这说明客户端浏览器有时发送这些Cookie是多余的！</p>
<p>可以通过设置Cookie的path来指定浏览器，在访问什么样的路径时，包含什么样的Cookie。</p>
<h5 id="Cookie路径与请求路径的关系"><a href="#Cookie路径与请求路径的关系" class="headerlink" title="Cookie路径与请求路径的关系"></a>Cookie路径与请求路径的关系</h5><p>下面我们来看看Cookie路径的作用：</p>
<p>下面是客户端浏览器保存的3个Cookie的路径：</p>
<p>a:　/cookietest；</p>
<p>b:　/cookietest/servlet；</p>
<p>c:　/cookietest/jsp；</p>
<p>下面是浏览器请求的URL：</p>
<p>A:　<code>http://localhost:8080/cookietest/AServlet</code>；</p>
<p>B:　<code>http://localhost:8080/cookietest/servlet/BServlet</code>；</p>
<p>C:　<code>http://localhost:8080/cookietest/jsp/CServlet</code>；</p>
<ul>
<li><p>请求A时，会在请求中包含a；</p>
</li>
<li><p>请求B时，会在请求中包含a、b；</p>
</li>
<li><p>请求C时，会在请求中包含a、c；</p>
</li>
</ul>
<p>也就是说，请求路径如果包含了Cookie路径，那么会在请求中包含这个Cookie，否则不会请求中不会包含这个Cookie。</p>
<ul>
<li><p>A请求的URL包含了”/cookietest”，所以会在请求中包含路径为”/cookietest”的Cookie；</p>
</li>
<li><p>B请求的URL包含了”/cookietest”，以及”/cookietest/servlet”，所以请求中包含路径为”/cookietest”和”/cookietest/servlet”两个Cookie；</p>
</li>
<li><p>B请求的URL包含了”/cookietest”，以及”/cookietest/jsp”，所以请求中包含路径为”/cookietest”和”/cookietest/jsp”两个Cookie；</p>
</li>
</ul>
<h5 id="设置Cookie的路径"><a href="#设置Cookie的路径" class="headerlink" title="设置Cookie的路径"></a>设置Cookie的路径</h5><p>设置Cookie的路径需要使用setPath()方法，例如：</p>
<p>cookie.setPath(“/cookietest/servlet”);</p>
<p>如果没有设置Cookie的路径，那么Cookie路径的默认值当前访问资源所在路径，例如：</p>
<ul>
<li><p>访问<code>http://localhost:8080/cookietest/AServlet</code>时添加的Cookie默认路径为/cookietest；</p>
</li>
<li><p>访问<code>http://localhost:8080/cookietest/servlet/BServlet</code>时添加的Cookie默认路径为/cookietest/servlet；</p>
</li>
<li><p>访问<code>http://localhost:8080/cookietest/jsp/BServlet</code>时添加的Cookie默认路径为/cookietest/jsp；</p>
</li>
</ul>
<h4 id="Cookie的domain"><a href="#Cookie的domain" class="headerlink" title="Cookie的domain"></a>Cookie的domain</h4><p>Cookie的domain属性可以让网站中二级域共享Cookie，次要！</p>
<p>百度你是了解的对吧！</p>
<p><code>http://www.baidu.com</code></p>
<p><code>http://zhidao.baidu.com</code></p>
<p><code>http://news.baidu.com</code></p>
<p><code>http://tieba.baidu.com</code></p>
<p>现在我希望在这些主机之间共享Cookie（例如在<code>www.baidu.com</code>中响应的cookie，可以在<code>news.baidu.com</code>请求中包含）。很明显，现在不是路径的问题了，而是主机的问题，即域名的问题。处理这一问题其实很简单，只需要下面两步：</p>
<ul>
<li><p>设置Cookie的path为”/“：c.setPath(“/“)；</p>
</li>
<li><p>设置Cookie的domain为”.baidu.com”：c.setDomain(“.baidu.com”)。</p>
</li>
</ul>
<p>当domain为”.baidu.com”时，无论前缀是什么，都会共享Cookie的。但是现在我们需要设置两个虚拟主机：<code>www.baidu.com</code>和<code>news.baidu.com</code>。</p>
<p>第一步：设置windows的DNS路径解析</p>
<p>找到C:\WINDOWS\system32\drivers\etc\hosts文件，添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost</span><br><span class="line">127.0.0.1       www.baidu.com</span><br><span class="line">127.0.0.1       news.baidu.com</span><br></pre></td></tr></table></figure>

<p>第二步：设置Tomcat虚拟主机</p>
<p>找到server.xml文件，添加<code>&lt;Host&gt;</code>元素，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"www.baidu.com"</span>  <span class="attr">appBase</span>=<span class="string">"F:\webapps\www"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlValidation</span>=<span class="string">"false"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"news.baidu.com"</span>  <span class="attr">appBase</span>=<span class="string">"F:\webapps\news"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlValidation</span>=<span class="string">"false"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建A项目，创建AServlet，设置Cookie。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cs = request.getCookies();</span><br><span class="line"><span class="keyword">if</span>(cs != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(Cookie c : cs) &#123;</span><br><span class="line">        String s = c.getName() + <span class="string">": "</span> + c.getValue() + <span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">        response.getWriter().print(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把B项目的WebRoot目录复制到F:\webapps\news目录下，并把WebRoot目录的名字修改为ROOT。</p>
<p>第五步：访问<code>www.baidu.com\AServlet</code>，然后再访问<code>news.baidu.com\BServlet</code>。</p>
<h4 id="Cookie保存中文"><a href="#Cookie保存中文" class="headerlink" title="Cookie保存中文"></a>Cookie保存中文</h4><p>Cookie的name和value都不能使用中文，如果希望在Cookie中使用中文，那么需要先对中文进行URL编码，然后把编码后的字符串放到Cookie中。</p>
<p>向客户端响应中添加Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String name = URLEncoder.encode(<span class="string">"姓名"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">String value = URLEncoder.encode(<span class="string">"张三"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">Cookie c = <span class="keyword">new</span> Cookie(name, value);</span><br><span class="line">c.setMaxAge(<span class="number">3600</span>);</span><br><span class="line">response.addCookie(c);</span><br></pre></td></tr></table></figure>

<p>从客户端请求中获取Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">Cookie[] cs = request.getCookies();</span><br><span class="line"><span class="keyword">if</span>(cs != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(Cookie c : cs) &#123;</span><br><span class="line">        String name = URLDecoder.decode(c.getName(), <span class="string">"UTF-8"</span>);</span><br><span class="line">        String value = URLDecoder.decode(c.getValue(), <span class="string">"UTF-8"</span>);</span><br><span class="line">        String s = name + <span class="string">": "</span> + value + <span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">        response.getWriter().print(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="显示曾经浏览过的商品"><a href="#显示曾经浏览过的商品" class="headerlink" title="显示曾经浏览过的商品"></a>显示曾经浏览过的商品</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index.jsp--%&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;商品列表&lt;/h1&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=ThinkPad"&gt;ThinkPad&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=Lenovo"&gt;Lenovo&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=Apple"&gt;Apple&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=HP"&gt;HP&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=SONY"&gt;SONY&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=ACER"&gt;ACER&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href="/day06_3/GoodServlet?name=DELL"&gt;DELL&lt;/a&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    您浏览过的商品：</span><br><span class="line">    &lt;%</span><br><span class="line">    Cookie[] cs = request.getCookies();</span><br><span class="line">    <span class="keyword">if</span>(cs != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Cookie c : cs) &#123;</span><br><span class="line">            <span class="keyword">if</span>(c.getName().equals(<span class="string">"goods"</span>)) &#123;</span><br><span class="line">                out.print(c.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GoodServlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String goodName = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line">		String goods = CookieUtils.getCookValue(request, <span class="string">"goods"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(goods != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] arr = goods.split(<span class="string">", "</span>);</span><br><span class="line">			Set&lt;String&gt; goodSet = <span class="keyword">new</span> LinkedHashSet(Arrays.asList(arr));</span><br><span class="line">			goodSet.add(goodName);</span><br><span class="line">			goods = goodSet.toString();</span><br><span class="line">			goods = goods.substring(<span class="number">1</span>, goods.length() - <span class="number">1</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			goods = goodName;</span><br><span class="line">		&#125;</span><br><span class="line">		Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"goods"</span>, goods);</span><br><span class="line">		cookie.setMaxAge(<span class="number">1</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">		response.addCookie(cookie);</span><br><span class="line">		</span><br><span class="line">		response.sendRedirect(<span class="string">"/day06_3/index.jsp"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CookieUtils</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieUtils</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCookValue</span><span class="params">(HttpServletRequest request, String name)</span> </span>&#123;</span><br><span class="line">		Cookie[] cs = request.getCookies();</span><br><span class="line">		<span class="keyword">if</span>(cs == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(Cookie c : cs) &#123;</span><br><span class="line">			<span class="keyword">if</span>(c.getName().equals(name)) &#123;</span><br><span class="line">				<span class="keyword">return</span> c.getValue();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpSession"><a href="#HttpSession" class="headerlink" title="HttpSession"></a>HttpSession</h3><h4 id="HttpSession概述"><a href="#HttpSession概述" class="headerlink" title="HttpSession概述"></a>HttpSession概述</h4><p>javax.servlet.http.HttpSession接口表示一个会话，我们可以把一个会话内需要共享的数据保存到HttpSession对象中！</p>
<h5 id="获取HttpSession对象"><a href="#获取HttpSession对象" class="headerlink" title="获取HttpSession对象"></a>获取HttpSession对象</h5><ul>
<li><p>HttpSession request.getSesssion()：如果当前会话已经有了session对象那么直接返回，如果当前会话还不存在会话，那么创建session并返回；</p>
</li>
<li><p>HttpSession request.getSession(boolean)：当参数为true时，与requeset.getSession()相同。如果参数为false，那么如果当前会话中存在session则返回，不存在返回null；</p>
</li>
</ul>
<h5 id="HttpSession是域对象"><a href="#HttpSession是域对象" class="headerlink" title="HttpSession是域对象"></a>HttpSession是域对象</h5><p>我们已经学习过HttpServletRequest、ServletContext，它们都是域对象，现在我们又学习了一个HttpSession，它也是域对象。它们三个是Servlet中可以使用的域对象，而JSP中可以多使用一个域对象，明天我们再讲解JSP的第四个域对象。</p>
<ul>
<li><p>HttpServletRequest：一个请求创建一个request对象，所以在同一个请求中可以共享request，例如一个请求从AServlet转发到BServlet，那么AServlet和BServlet可以共享request域中的数据；</p>
</li>
<li><p>ServletContext：一个应用只创建一个ServletContext对象，所以在ServletContext中的数据可以在整个应用中共享，只要不启动服务器，那么ServletContext中的数据就可以共享；</p>
</li>
<li><p>HttpSession：一个会话创建一个HttpSession对象，同一会话中的多个请求中可以共享session中的数据；</p>
</li>
</ul>
<p>下面是session的域方法：</p>
<ul>
<li><p>void setAttribute(String name, Object value)：用来存储一个对象，也可以称之为存储一个域属性，例如：session.setAttribute(“xxx”, “XXX”)，在session中保存了一个域属性，域属性名称为xxx，域属性的值为XXX。请注意，如果多次调用该方法，并且使用相同的name，那么会覆盖上一次的值，这一特性与Map相同；</p>
</li>
<li><p>Object getAttribute(String name)：用来获取session中的数据，当前在获取之前需要先去存储才行，例如：String value = (String) session.getAttribute(“xxx”);，获取名为xxx的域属性；</p>
</li>
<li><p>void removeAttribute(String name)：用来移除HttpSession中的域属性，如果参数name指定的域属性不存在，那么本方法什么都不做；</p>
</li>
<li><p>Enumeration getAttributeNames()：获取所有域属性的名称；</p>
</li>
</ul>
<h4 id="登录案例"><a href="#登录案例" class="headerlink" title="登录案例"></a>登录案例</h4><p>需要的页面：</p>
<ul>
<li><p>login.jsp：登录页面，提供登录表单；</p>
</li>
<li><p>index1.jsp：主页，显示当前用户名称，如果没有登录，显示您还没登录；</p>
</li>
<li><p>index2.jsp：主页，显示当前用户名称，如果没有登录，显示您还没登录；</p>
</li>
</ul>
<p>Servlet：</p>
<ul>
<li>LoginServlet：在login.jsp页面提交表单时，请求本Servlet。在本Servlet中获取用户名、密码进行校验，如果用户名、密码错误，显示”用户名或密码错误”，如果正确保存用户名session中，然后重定向到index1.jsp；</li>
</ul>
<p>当用户没有登录时访问index1.jsp或index2.jsp，显示”您还没有登录”。如果用户在login.jsp登录成功后到达index1.jsp页面会显示当前用户名，而且不用再次登录去访问index2.jsp也会显示用户名。因为多次请求在一个会话范围，index1.jsp和index2.jsp都会到session中获取用户名，session对象在一个会话中是相同的，所以都可以获取到用户名！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--login.jsp--%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;login.jsp&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;login.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;form action=<span class="string">"/day06_4/LoginServlet"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    	用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index1.jsp--%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;index1.jsp&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">&lt;h1&gt;index1.jsp&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	String username = (String)session.getAttribute(<span class="string">"username"</span>);</span><br><span class="line">	<span class="keyword">if</span>(username == <span class="keyword">null</span>) &#123;</span><br><span class="line">		out.print(<span class="string">"您还没有登录！"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		out.print(<span class="string">"用户名："</span> + username);</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;a href="/day06_4/index2.jsp"&gt;index2&lt;/a&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index2.jsp--%&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;index2.jsp&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">&lt;h1&gt;index2.jsp&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	String username = (String)session.getAttribute(<span class="string">"username"</span>);</span><br><span class="line">	<span class="keyword">if</span>(username == <span class="keyword">null</span>) &#123;</span><br><span class="line">		out.print(<span class="string">"您还没有登录！"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		out.print(<span class="string">"用户名："</span> + username);</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;a href="/day06_4/index1.jsp"&gt;index1&lt;/a&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LoginServlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(username.equalsIgnoreCase(<span class="string">"itcast"</span>)) &#123;</span><br><span class="line">			response.getWriter().print(<span class="string">"用户名或密码错误！"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			HttpSession session = request.getSession();</span><br><span class="line">			session.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			response.sendRedirect(<span class="string">"/day06_4/index1.jsp"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="session的实现原理"><a href="#session的实现原理" class="headerlink" title="session的实现原理"></a>session的实现原理</h4><p>session底层是依赖Cookie的！我们来理解一下session的原理吧！</p>
<p>当我首次去银行时，因为还没有账号，所以需要开一个账号，我获得的是银行卡，而银行这边的数据库中留下了我的账号，我的钱是保存在银行的账号中，而我带走的是我的卡号。</p>
<p>当我再次去银行时，只需要带上我的卡，而无需再次开一个账号了。只要带上我的卡，那么我在银行操作的一定是我的账号！</p>
<p>当首次使用session时，服务器端要创建session，session是保存在服务器端，而给客户端的session的id（一个cookie中保存了sessionId）。客户端带走的是sessionId，而数据是保存在session中。</p>
<p>当客户端再次访问服务器时，在请求中会带上sessionId，而服务器会通过sessionId找到对应的session，而无需再创建新的session。</p>
<p><img src="https://i.loli.net/2020/06/30/TN62RhXb5WA8auw.png" alt="2.png"></p>
<h4 id="session与浏览器"><a href="#session与浏览器" class="headerlink" title="session与浏览器"></a>session与浏览器</h4><p>session保存在服务器，而sessionId通过Cookie发送给客户端，但这个Cookie的生命为-1，即只在浏览器内存中存在，也就是说如果用户关闭了浏览器，那么这个Cookie就丢失了。</p>
<p>当用户再次打开浏览器访问服务器时，就不会有sessionId发送给服务器，那么服务器会认为你没有session，所以服务器会创建一个session，并在响应中把sessionId中到Cookie中发送给客户端。　　　　　</p>
<p>你可能会说，那原来的session对象会怎样？当一个session长时间没人使用的话，服务器会把session删除了！这个时长在Tomcat中配置是30分钟，可以在${CATALANA}/conf/web.xml找到这个配置，当然你也可以在自己的web.xml中覆盖这个配置！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>session失效时间也说明一个问题！如果你打开网站的一个页面开始长时间不动，超出了30分钟后，再去点击链接或提交表单时你会发现，你的session已经丢失了！</p>
<h4 id="session其他常用API"><a href="#session其他常用API" class="headerlink" title="session其他常用API"></a>session其他常用API</h4><ul>
<li><p>String getId()：获取sessionId；</p>
</li>
<li><p>int getMaxInactiveInterval()：获取session可以的最大不活动时间（秒），默认为30分钟。当session在30分钟内没有使用，那么Tomcat会在session池中移除这个session；</p>
</li>
<li><p>void setMaxInactiveInterval(int interval)：设置session允许的最大不活动时间（秒），如果设置为1秒，那么只要session在1秒内不被使用，那么session就会被移除；</p>
</li>
<li><p>long getCreationTime()：返回session的创建时间，返回值为当前时间的毫秒值；</p>
</li>
<li><p>long getLastAccessedTime()：返回session的最后活动时间，返回值为当前时间的毫秒值；</p>
</li>
<li><p>void invalidate()：让session失效！调用这个方法会被session失效，当session失效后，客户端再次请求，服务器会给客户端创建一个新的session，并在响应中给客户端新session的sessionId；</p>
</li>
<li><p>boolean isNew()：查看session是否为新。当客户端第一次请求时，服务器为客户端创建session，但这时服务器还没有响应客户端，也就是还没有把sessionId响应给客户端时，这时session的状态为新。</p>
</li>
</ul>
<h4 id="URL重写"><a href="#URL重写" class="headerlink" title="URL重写"></a>URL重写</h4><p>我们知道session依赖Cookie，那么session为什么依赖Cookie呢？因为服务器需要在每次请求中获取sessionId，然后找到客户端的session对象。那么如果客户端浏览器关闭了Cookie呢？那么session是不是就会不存在了呢？</p>
<p>其实还有一种方法让服务器收到的每个请求中都带有sessioinId，那就是URL重写！在每个页面中的每个链接和表单中都添加名为jSessionId的参数，值为当前sessionid。当用户点击链接或提交表单时也服务器可以通过获取jSessionId这个参数来得到客户端的sessionId，找到sessoin对象。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index.jsp--%&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;URL重写&lt;/h1&gt;</span><br><span class="line">    &lt;a href='/day06_5/index.jsp;jsessionid=&lt;%=session.getId() %&gt;' &gt;主页&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=<span class="string">'/day06_5/index.jsp;jsessionid=&lt;%=session.getId() %&gt;'</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>也可以使用response.encodeURL()对每个请求的URL处理，这个方法会自动追加jsessionid参数，与上面我们手动添加是一样的效果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href='&lt;%=response.encodeURL("/day06_5/index.jsp") %&gt;' &gt;主页&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">'&lt;%=response.encodeURL("/day06_5/index.jsp") %&gt;'</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>　使用response.encodeURL()更加”智能”，它会判断客户端浏览器是否禁用了Cookie，如果禁用了，那么这个方法在URL后面追加jsessionid，否则不会追加。</p>
<h3 id="案例：一次性图片验证码"><a href="#案例：一次性图片验证码" class="headerlink" title="案例：一次性图片验证码"></a>案例：一次性图片验证码</h3><h4 id="验证码有啥用"><a href="#验证码有啥用" class="headerlink" title="验证码有啥用"></a>验证码有啥用</h4><p>在我们注册时，如果没有验证码的话，我们可以使用URLConnection来写一段代码发出注册请求。甚至可以使用while(true)来注册！那么服务器就废了！</p>
<p>验证码可以去识别发出请求的是人还是程序！当然，如果聪明的程序可以去分析验证码图片！但分析图片也不是一件容易的事，因为一般验证码图片都会带有干扰线，人都看不清，那么程序一定分析不出来。</p>
<h4 id="VerifyCode类"><a href="#VerifyCode类" class="headerlink" title="VerifyCode类"></a>VerifyCode类</h4><p>现在我们已经有了cn.itcast.utils.VerifyCode类，这个类可以生成验证码图片！下面来看一个小例子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建验证码类</span></span><br><span class="line">    VerifyCode vc = <span class="keyword">new</span> VerifyCode();</span><br><span class="line">    <span class="comment">// 获取随机图片</span></span><br><span class="line">    BufferedImage image = vc.getImage();</span><br><span class="line">    <span class="comment">// 获取刚刚生成的随机图片上的文本</span></span><br><span class="line">    String text = vc.getText();</span><br><span class="line">    System.out.println(text);</span><br><span class="line">    <span class="comment">// 保存图片</span></span><br><span class="line">    FileOutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">"F:/xxx.jpg"</span>);</span><br><span class="line">    VerifyCode.output(image, out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在页面中显示动态图片"><a href="#在页面中显示动态图片" class="headerlink" title="在页面中显示动态图片"></a>在页面中显示动态图片</h4><p>我们需要写一个VerifyCodeServlet，在这个Servlet中我们生成动态图片，然后它图片写入到response.getOutputStream()流中！然后让页面的<img>元素指定这个VerifyCodServlet即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VerifyCodeServlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		VerifyCode vc = <span class="keyword">new</span> VerifyCode();</span><br><span class="line">		BufferedImage image = vc.getImage();</span><br><span class="line">		String text = vc.getText();</span><br><span class="line">		System.out.println(<span class="string">"text:"</span> + text);</span><br><span class="line">		VerifyCode.output(image, response.getOutputStream());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index.jsp--%&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="function">function <span class="title">_change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> imgEle = document.getElementById(<span class="string">"vCode"</span>);</span><br><span class="line">        imgEle.src = <span class="string">"/day06_6/VerifyCodeServlet?"</span> + <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">...  </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;验证码&lt;/h1&gt;</span><br><span class="line">    &lt;img id=<span class="string">"vCode"</span> src=<span class="string">"/day06_6/VerifyCodeServlet"</span>/&gt;</span><br><span class="line">    &lt;a href="javascript:_change()"&gt;看不清，换一张&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h4 id="在注册页面中使用验证码"><a href="#在注册页面中使用验证码" class="headerlink" title="在注册页面中使用验证码"></a>在注册页面中使用验证码</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"/day06_6/RegistServlet"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br/&gt;</span><br><span class="line">    验证码：&lt;input type=<span class="string">"text"</span> name=<span class="string">"code"</span> size=<span class="string">"3"</span>/&gt;</span><br><span class="line">    &lt;img id=<span class="string">"vCode"</span> src=<span class="string">"/day06_6/VerifyCodeServlet"</span>/&gt;</span><br><span class="line">    &lt;a href="javascript:_change()"&gt;看不清，换一张&lt;/a&gt;</span><br><span class="line">    &lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h4 id="RegistServlet"><a href="#RegistServlet" class="headerlink" title="RegistServlet"></a>RegistServlet</h4><p>修改VerifyCodeServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		VerifyCode vc = <span class="keyword">new</span> VerifyCode();</span><br><span class="line">		BufferedImage image = vc.getImage();</span><br><span class="line">		request.getSession().setAttribute(<span class="string">"vCode"</span>, vc.getText());</span><br><span class="line">		VerifyCode.output(image, response.getOutputStream());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">// RegisterServlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		String vCode = request.getParameter(<span class="string">"code"</span>); </span><br><span class="line">		</span><br><span class="line">		String sessionVerifyCode = (String)request.getSession().getAttribute(<span class="string">"vCode"</span>); </span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(vCode.equalsIgnoreCase(sessionVerifyCode) ) &#123;</span><br><span class="line">			response.getWriter().print(username + <span class="string">", 恭喜！注册成功！"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			response.getWriter().print(<span class="string">"验证码错误！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结验证码案例"><a href="#总结验证码案例" class="headerlink" title="总结验证码案例"></a>总结验证码案例</h4><ul>
<li><p>VerifyCodeServlet：</p>
<ul>
<li><p>生成验证码：VerifyCode vc = new VerifyCode(); BufferedImage image = vc.getImage()；</p>
</li>
<li><p>在session中保存验证码文本：request.getSession.getAttribute(“vCode”, vc.getText())；</p>
</li>
<li><p>把验证码输出到页面：VerifyCode.output(image, response.getOutputStream)；</p>
</li>
</ul>
</li>
<li><p>regist.jsp：</p>
<ul>
<li><p>表单中包含username和code字段；</p>
</li>
<li><p>在表单中给出<img>指向VerifyCodeServlet，用来在页面中显示验证码图片；</p>
</li>
<li><p>提供”看不清，换一张”链接，指向_change()函数；</p>
</li>
<li><p>提交到RegistServlet；</p>
</li>
</ul>
</li>
<li><p>RegistServlet：</p>
<ul>
<li>获取表单中的username和code；</li>
</ul>
</li>
<li><p>获取session中的vCode；</p>
<ul>
<li>比较code和vCode是否相同；</li>
</ul>
</li>
<li><p>相同说明用户输入的验证码正确，否则输入验证码错误。</p>
</li>
</ul>
<hr>
<h2 id="Day-07"><a href="#Day-07" class="headerlink" title="Day 07"></a>Day 07</h2><p><em>01/07/2020</em></p>
<h3 id="JSP-指令"><a href="#JSP-指令" class="headerlink" title="JSP 指令"></a>JSP 指令</h3><p>JSP指令的格式：<code>&lt;%@指令名 attr1=&quot;&quot; attr2=&quot;&quot; %&gt;</code>，一般都会把JSP指令放到JSP文件的最上方，但这不是必须的。</p>
<p>JSP中有三大指令：page、include、taglib，最为常用，也最为复杂的就是page指令了。</p>
<h4 id="page-指令"><a href="#page-指令" class="headerlink" title="page 指令"></a>page 指令</h4><p>page指令是最为常用的指定，也是属性最多的属性！</p>
<p>page指令没有必须属性，都是可选属性。例如&lt;%@page %&gt;，没有给出任何属性也是可以的！</p>
<p>在JSP页面中，任何指令都可以重复出现！</p>
<p><code>&lt;%@ page language=&quot;java&quot;%&gt;</code></p>
<p><code>&lt;%@ page import=&quot;java.util.*&quot;%&gt;</code></p>
<p><code>&lt;%@ page pageEncoding=&quot;utf-8&quot;%&gt;</code></p>
<p>这也是可以的！</p>
<h5 id="page指令的pageEncoding和contentType（重点）"><a href="#page指令的pageEncoding和contentType（重点）" class="headerlink" title="page指令的pageEncoding和contentType（重点）"></a>page指令的pageEncoding和contentType（重点）</h5><p>pageEncoding指定当前JSP页面的编码！这个编码是给服务器看的，服务器需要知道当前JSP使用的编码，不然服务器无法正确把JSP编译成java文件。所以这个编码只需要与真实的页面编码一致即可！在MyEclipse中，在JSP文件上点击右键，选择属性就可以看到当前JSP页面的编码了。</p>
<p>contentType属性与response.setContentType()方法的作用相同！它会完成两项工作，一是设置响应字符流的编码，二是设置content-type响应头。例如：<code>&lt;%@ contentType=&quot;text/html;charset=utf-8&quot;%&gt;</code>，它会使”真身”中出现response.setContentType(“text/html;charset=utf-8”)。</p>
<p>无论是page指令的pageEncoding还是contentType，它们的默认值都是ISO-8859-1，我们知道ISO-8859-1是无法显示中文的，所以JSP页面中存在中文的话，一定要设置这两个属性。</p>
<p>其实pageEncoding和contentType这两个属性的关系很”暧昧”：</p>
<ul>
<li><p>当设置了pageEncoding，而没设置contentType时： contentType的默认值为pageEncoding；</p>
</li>
<li><p>当设置了contentType，而没设置pageEncoding时： pageEncoding的默认值与contentType；</p>
</li>
</ul>
<p><strong>也就是说，当pageEncoding和contentType只出现一个时，那么另一个的值与出现的值相同。如果两个都不出现，那么两个属性的值都是ISO-8859-1。所以通过我们至少设置它们两个其中一个！</strong></p>
<h5 id="page指令的import属性"><a href="#page指令的import属性" class="headerlink" title="page指令的import属性"></a>page指令的import属性</h5><p>import是page指令中一个很特别的属性！</p>
<p>import属性值对应”真身”中的import语句。</p>
<p>import属性值可以使逗号：<code>&lt;%@page import=&quot;java.net.*,java.util.*,java.sql.*&quot;%&gt;</code></p>
<p>import属性是唯一可以重复出现的属性：</p>
<p><code>&lt;%@page import=&quot;java.util.*&quot; import=&quot;java.net.*&quot; import=&quot;java.sql.*&quot;%&gt;</code></p>
<p>但是，我们一般会使用多个page指令来导入多个包：</p>
<p><code>&lt;%@ page import=&quot;java.util.*&quot;%&gt;</code></p>
<p><code>&lt;%@ page import=&quot;java.net.*&quot;%&gt;</code></p>
<p><code>&lt;%@ page import=&quot;java.text.*&quot;%&gt;</code></p>
<h5 id="page指令的errorPage和isErrorPage"><a href="#page指令的errorPage和isErrorPage" class="headerlink" title="page指令的errorPage和isErrorPage"></a>page指令的errorPage和isErrorPage</h5><p>我们知道，在一个JSP页面出错后，Tomcat会响应给用户错误信息（500页面）！如果你不希望Tomcat给用户输出错误信息，那么可以使用page指令的errorPage来指定错误页！也就是自定义错误页面，例如：<code>&lt;%@page errorPage=&quot;xxx.jsp&quot;%&gt;</code>。这时，在当前JSP页面出现错误时，会请求转发到xxx.jsp页面。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--a.jsp--%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ page  errorPage=<span class="string">"b.jsp"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"哈哈~"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--b.jsp--%&gt;</span><br><span class="line">&lt;%@ page pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">   &lt;h1&gt;出错啦！&lt;/h1&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>在上面代码中，a.jsp抛出异常后，会请求转发到b.jsp。在浏览器的地址栏中还是a.jsp，因为是请求转发！</p>
<p>而且客户端浏览器收到的响应码为200，表示请求成功！如果希望客户端得到500，那么需要指定b.jsp为错误页面。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ page  isErrorPage=<span class="string">"true"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">   &lt;h1&gt;出错啦！&lt;/h1&gt;</span><br><span class="line">	&lt;%=exception.getMessage() %&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>注意，当isErrorPage为true时，说明当前JSP为错误页面，即专门处理错误的页面。那么这个页面中就可以使用一个内置对象exception了。其他页面是不能使用这个内置对象的！</p>
<p>温馨提示：<em>IE会在状态码为500时，并且响应正文的长度小于等于512B时不给予显示！而是显示”网站无法显示该页面”字样。这时你只需要添加一些响应内容即可，例如上例中的b.jsp中我给出一些内容，IE就可以正常显示了！</em></p>
<h6 id="web-xml中配置错误页面"><a href="#web-xml中配置错误页面" class="headerlink" title="web.xml中配置错误页面"></a>web.xml中配置错误页面</h6><p>不只可以通过JSP的page指令来配置错误页面，还可以在web.xml文件中指定错误页面。这种方式其实与page指令无关，但想来想去还是在这个位置来说明比较合适！</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error500.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.lang.RuntimeException<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;error-page&gt;</code>有两种使用方式：</p>
<ul>
<li><p><code>&lt;error-code&gt;</code>和<code>&lt;location&gt;</code>子元素；</p>
</li>
<li><p><code>&lt;exception-type&gt;</code>和<code>&lt;location&gt;</code>子元素；</p>
<p>其中<code>&lt;error-code&gt;</code>是指定响应码；<code>&lt;location&gt;</code>指定转发的页面；<code>&lt;exception-type&gt;</code>是指定抛出的异常类型。</p>
</li>
<li><p>当出现404时，会跳转到error404.jsp页面；</p>
</li>
<li><p>当出现RuntimeException异常时，会跳转到error.jsp页面；</p>
</li>
<li><p>当出现非RuntimeException的异常时，会跳转到error500.jsp页面。</p>
</li>
</ul>
<p>这种方式会在控制台看到异常信息！而使用page指令时不会在控制台打印异常信息。</p>
<h5 id="page指令的authFlush和buffer"><a href="#page指令的authFlush和buffer" class="headerlink" title="page指令的authFlush和buffer"></a>page指令的authFlush和buffer</h5><p>buffer表示当前JSP的输出流（out隐藏对象）的缓冲区大小，默认为8kb。</p>
<p>authFlush表示在out对象的缓冲区满时如何处理！当authFlush为true时，表示缓冲区满时把缓冲区数据输出到客户端；当authFlush为false时，表示缓冲区满时，抛出异常。authFlush的默认值为true。</p>
<p>这两个属性一般我们也不会去特意设置，都是保留默认值！</p>
<h5 id="page指令的isELIgnored"><a href="#page指令的isELIgnored" class="headerlink" title="page指令的isELIgnored"></a>page指令的isELIgnored</h5><p>后面我们会讲解EL表达式语言，page指令的isELIgnored属性表示当前JSP页面是否忽略EL表达式，默认值为false，表示不忽略（即支持）。</p>
<h5 id="page指令的其他属性"><a href="#page指令的其他属性" class="headerlink" title="page指令的其他属性"></a>page指令的其他属性</h5><ul>
<li><p>language：只能是Java，这个属性可以看出JSP最初设计时的野心！希望JSP可以转换成其他语言！但是，到现在JSP也只能转换成Java代码；</p>
</li>
<li><p>info：JSP说明性信息；</p>
</li>
<li><p>isThreadSafe：默认为false，为true时，JSP生成的Servlet会去实现一个过时的标记接口SingleThreadModel，这时JSP就只能处理单线程的访问；</p>
</li>
<li><p>session：默认为true，表示当前JSP页面可以使用session对象，如果为false表示当前JSP页面不能使用session对象；</p>
</li>
<li><p>extends：指定当前JSP页面生成的Servlet的父类；</p>
</li>
</ul>
<h5 id="lt-jsp-config-gt-（了解）"><a href="#lt-jsp-config-gt-（了解）" class="headerlink" title="&lt;jsp-config&gt;（了解）"></a><code>&lt;jsp-config&gt;</code>（了解）</h5><p>在web.xml页面中配置<code>&lt;jsp-config&gt;</code>也可以完成很多page指定的功能！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-property-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>	<span class="comment">&lt;!--对所有jsp进行配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-ignored</span>&gt;</span>true<span class="tag">&lt;/<span class="name">el-ignored</span>&gt;</span>	<span class="comment">&lt;!--忽略EL表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">page-encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">page-encoding</span>&gt;</span>	<span class="comment">&lt;!--指定页面编码为utf-8--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scripting-invalid</span>&gt;</span>true<span class="tag">&lt;/<span class="name">scripting-invalid</span>&gt;</span>	<span class="comment">&lt;!--禁用Java脚本！如果在JSP页面中使用了Java脚本就会抛出异常。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jsp-property-group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="include指令"><a href="#include指令" class="headerlink" title="include指令"></a>include指令</h4><p>include指令表示静态包含！即目的是把多个JSP合并成一个JSP文件！</p>
<p>include指令只有一个属性：file，指定要包含的页面，例如：<code>&lt;%@include file=&quot;b.jsp&quot;%&gt;</code>。</p>
<p>静态包含：当hel.jsp页面包含了lo.jsp页面后，在编译hel.jsp页面时，需要把hel.jsp和lo.jsp页面合并成一个文件，然后再编译成Servlet（Java文件）。</p>
<p><img src="https://i.loli.net/2020/07/01/pOWiNGAd3E9mQVS.png" alt="2.png"></p>
<p>很明显，在ol.jsp中在使用username变量，而这个变量在hel.jsp中定义的，所以只有这两个JSP文件合并后才能使用。通过include指定完成对它们的合并！</p>
<h4 id="taglib指令"><a href="#taglib指令" class="headerlink" title="taglib指令"></a>taglib指令</h4><p>这个指令需要在学习了自定义标签后才会使用，现在只能做了了解而已！</p>
<p>在JSP页面中使用第三方的标签库时，需要使用taglib指令来”导包”。例如：</p>
<p><code>&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</code></p>
<p>其中prefix表示标签的前缀，这个名称可以随便起。uri是由第三方标签库定义的，所以你需要知道第三方定义的uri。</p>
<h3 id="JSP-九大内置对象"><a href="#JSP-九大内置对象" class="headerlink" title="JSP 九大内置对象"></a>JSP 九大内置对象</h3><h4 id="什么是JSP九大内置对象"><a href="#什么是JSP九大内置对象" class="headerlink" title="什么是JSP九大内置对象"></a>什么是JSP九大内置对象</h4><p>在JSP中无需创建就可以使用的9个对象，它们是：</p>
<ul>
<li><p>out（JspWriter）：等同与response.getWriter()，用来向客户端发送文本数据；</p>
</li>
<li><p>config（ServletConfig）：对应”真身”中的ServletConfig；</p>
</li>
<li><p>page（当前JSP的真身类型）：当前JSP页面的”this”，即当前对象；</p>
</li>
<li><p>pageContext（PageContext）：页面上下文对象，它是最后一个没讲的域对象；</p>
</li>
<li><p>exception（Throwable）：只有在错误页面中可以使用这个对象；</p>
</li>
<li><p>request（HttpServletRequest）：即HttpServletRequest类的对象；</p>
</li>
<li><p>response（HttpServletResponse）：即HttpServletResponse类的对象；</p>
</li>
<li><p>application（ServletContext）：即ServletContext类的对象；</p>
</li>
<li><p>session（HttpSession）：即HttpSession类的对象，不是每个JSP页面中都可以使用，如果在某个JSP页面中设置<code>&lt;%@page session=&quot;false&quot;%&gt;</code>，说明这个页面不能使用session。</p>
</li>
</ul>
<p>在这9个对象中有很多是极少会被使用的，例如：config、page、exception基本不会使用。</p>
<p>在这9个对象中有两个对象不是每个JSP页面都可以使用的：exception、session。</p>
<p>在这9个对象中有很多前面已经学过的对象：out、request、response、application、session、config。</p>
<h4 id="通过”真身”来对照JSP"><a href="#通过”真身”来对照JSP" class="headerlink" title="通过”真身”来对照JSP"></a>通过”真身”来对照JSP</h4><p>我们知道JSP页面的内容出现在”真身”的<code>_jspService()方法</code>中，而在<code>_jspService()</code>方法开头部分已经创建了9大内置对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    PageContext pageContext = <span class="keyword">null</span>;</span><br><span class="line">    HttpSession session = <span class="keyword">null</span>;</span><br><span class="line">    ServletContext application = <span class="keyword">null</span>;</span><br><span class="line">    ServletConfig config = <span class="keyword">null</span>;</span><br><span class="line">    JspWriter out = <span class="keyword">null</span>;</span><br><span class="line">    Object page = <span class="keyword">this</span>;</span><br><span class="line">    JspWriter _jspx_out = <span class="keyword">null</span>;</span><br><span class="line">    PageContext _jspx_page_context = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">      			<span class="keyword">null</span>, <span class="keyword">true</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      session = pageContext.getSession();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">// 从这里开始，才是JSP页面的内容</span></span><br><span class="line">   &#125;…</span><br></pre></td></tr></table></figure>

<h4 id="pageContext对象"><a href="#pageContext对象" class="headerlink" title="pageContext对象"></a>pageContext对象</h4><p>在JavaWeb中一共四个域对象，其中Servlet中可以使用的是request、session、application三个对象，而在JSP中可以使用pageContext、request、session、application四个域对象。</p>
<p>pageContext 对象是PageContext类型，它的主要功能有：</p>
<ul>
<li><p>域对象功能；</p>
</li>
<li><p>代理其它域对象功能；</p>
</li>
<li><p>获取其他内置对象；</p>
</li>
</ul>
<h5 id="域对象功能"><a href="#域对象功能" class="headerlink" title="域对象功能"></a>域对象功能</h5><p>pageContext也是域对象，它的范围是当前页面。它的范围也是四个域对象中最小的！</p>
<ul>
<li><p>void setAttribute(String name, Object value)；</p>
</li>
<li><p>Object getAttrbiute(String name, Object value)；</p>
</li>
<li><p>void removeAttribute(String name, Object value)；</p>
</li>
</ul>
<h5 id="代理其它域对象功能"><a href="#代理其它域对象功能" class="headerlink" title="代理其它域对象功能"></a>代理其它域对象功能</h5><p>还可以使用pageContext来代理其它3个域对象的功能，也就是说可以使用pageContext向request、session、application对象中存取数据，例如：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pageContext.setAttribute(<span class="string">"x"</span>, <span class="string">"X"</span>); 	<span class="comment">// 向pageContext中存储数据</span></span><br><span class="line">pageContext.setAttribute(<span class="string">"x"</span>, <span class="string">"XX"</span>, PageContext.REQUEST_SCOPE); 	<span class="comment">// 向request中存储数据</span></span><br><span class="line">pageContext.setAttribute(<span class="string">"x"</span>, <span class="string">"XXX"</span>, PageContext.SESSION_SCOPE); 	<span class="comment">// 向session中存储数据</span></span><br><span class="line">pageContext.setAttribute(<span class="string">"x"</span>, <span class="string">"XXXX"</span>, PageContext.APPLICATION_SCOPE); 	<span class="comment">// 向application中存储数据</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>void setAttribute(String name, Object value, int scope)：在指定范围中添加数据；</p>
</li>
<li><p>Object getAttribute(String name, int scope)：获取指定范围的数据；</p>
</li>
<li><p>void removeAttribute(String name, int scope)：移除指定范围的数据；</p>
</li>
<li><p>Object findAttribute(String name)：依次在page、request、session、application范围查找名称为name的数据，如果找到就停止查找。这说明在这个范围内有相同名称的数据，那么page范围的优先级最高！</p>
</li>
</ul>
<h5 id="获取其他内置对象"><a href="#获取其他内置对象" class="headerlink" title="获取其他内置对象"></a>获取其他内置对象</h5><p>一个pageContext对象等于所有内置对象，即1个当9个。这是因为可以使用pageContext对象获取其它8个内置对象：</p>
<ul>
<li><p>JspWriter getOut()：获取out内置对象；</p>
</li>
<li><p>ServletConfig getServletConfig()：获取config内置对象；</p>
</li>
<li><p>Object getPage()：获取page内置对象；</p>
</li>
<li><p>ServletRequest getRequest()：获取request内置对象；</p>
</li>
<li><p>ServletResponse getResponse()：获取response内置对象；</p>
</li>
<li><p>HttpSession getSession()：获取session内置对象；</p>
</li>
<li><p>ServletContext getServletContext()：获取application内置对象；</p>
</li>
<li><p>Exception getException()：获取exception内置对象；</p>
</li>
</ul>
<h3 id="JSP-动作标签"><a href="#JSP-动作标签" class="headerlink" title="JSP 动作标签"></a>JSP 动作标签</h3><h4 id="JSP动作标签概述"><a href="#JSP动作标签概述" class="headerlink" title="JSP动作标签概述"></a>JSP动作标签概述</h4><p>动作标签的作用是用来简化Java脚本的！</p>
<p>JSP动作标签是JavaWeb内置的动作标签，它们是已经定义好的动作标签，我们可以拿来直接使用。</p>
<p>如果JSP动作标签不够用时，还可以使用自定义标签（今天不讲）。JavaWeb一共提供了20个JSP动作标签，但有很多基本没有用，这里只介绍一些有坐标的动作标签。</p>
<p>JSP动作标签的格式：<code>&lt;jsp:标签名 …&gt;</code></p>
<h4 id="lt-jsp-include-gt"><a href="#lt-jsp-include-gt" class="headerlink" title="&lt;jsp:include&gt;"></a><code>&lt;jsp:include&gt;</code></h4><p><code>&lt;jsp:include&gt;</code>标签的作用是用来包含其它JSP页面的！你可能会说，前面已经学习了include指令了，它们是否相同呢？虽然它们都是用来包含其它JSP页面的，但它们的实现的级别是不同的！</p>
<p>include指令是在编译级别完成的包含，即把当前JSP和被包含的JSP合并成一个JSP，然后再编译成一个Servlet。</p>
<p>include动作标签是在运行级别完成的包含，即当前JSP和被包含的JSP都会各自生成Servlet，然后在执行当前JSP的Servlet时完成包含另一个JSP的Servlet。它与RequestDispatcher的include()方法是相同的！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--hel.jsp--%&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;hel.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;jsp:include page=<span class="string">"lo.jsp"</span> /&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--lo.jsp--%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	out.println(<span class="string">"&lt;h1&gt;lo.jsp&lt;/h1&gt;"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/07/01/Oi2EqIUWygDaHVT.png" alt="2.png"></p>
<p>其实<code>&lt;jsp:include&gt;</code>在”真身”中不过是一句方法调用，即调用另一个Servlet而已。</p>
<h4 id="lt-jsp-forward-gt"><a href="#lt-jsp-forward-gt" class="headerlink" title="&lt;jsp:forward&gt;"></a><code>&lt;jsp:forward&gt;</code></h4><p>forward标签的作用是请求转发！forward标签的作用与RequestDispatcher#forward()方法相同。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--hel.jsp--%&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">        hel.jsp</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">    &lt;jsp:forward page=<span class="string">"lo.jsp"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--lo.jsp--%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	out.println(<span class="string">"&lt;h1&gt;lo.jsp&lt;/h1&gt;"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>注意，最后客户端只能看到lo.jsp的输出，而看不到hel.jsp的内容。也就是说在hel.jsp中的<code>&lt;h1&gt;hel.jsp&lt;/h1&gt;</code>是不会发送到客户端的。<code>&lt;jsp:forward&gt;</code>的作用是”别再显示我，去显示它吧！”。</p>
<h4 id="lt-jsp-param-gt"><a href="#lt-jsp-param-gt" class="headerlink" title="&lt;jsp:param&gt;"></a><code>&lt;jsp:param&gt;</code></h4><p>还可以在<code>&lt;jsp:include&gt;</code>和<code>&lt;jsp:forward&gt;</code>标签中使用<code>&lt;jsp:param&gt;</code>子标签，它是用来传递参数的。下面用<code>&lt;jsp:include&gt;</code>来举例说明<code>&lt;jsp:param&gt;</code>的使用。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;a.jsp&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;a.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">	&lt;jsp:include page=<span class="string">"/b.jsp"</span>&gt;</span><br><span class="line">		&lt;jsp:param value=<span class="string">"zhangSan"</span> name=<span class="string">"username"</span>/&gt; &lt;%--传参--%&gt;</span><br><span class="line">	&lt;/jsp:include&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;b.jsp&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;b.jsp&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		String username = request.getParameter(<span class="string">"username"</span>); </span><br><span class="line">		out.print(<span class="string">"你好："</span> + username);</span><br><span class="line">	%&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h3><h4 id="JavaBean概述"><a href="#JavaBean概述" class="headerlink" title="JavaBean概述"></a>JavaBean概述</h4><h5 id="什么是JavaBean"><a href="#什么是JavaBean" class="headerlink" title="什么是JavaBean"></a>什么是JavaBean</h5><p>JavaBean是一种规范，也就是对类的要求。它要求Java类的成员变量提供getter/setter方法，这样的成员变量被称之为JavaBean属性。</p>
<p>JavaBean还要求类必须提供仅有的无参构造器，例如：public User() {…}</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="JavaBean属性"><a href="#JavaBean属性" class="headerlink" title="JavaBean属性"></a>JavaBean属性</h5><p>JavaBean属性是具有getter/setter方法的成员变量。</p>
<ul>
<li><p>也可以只提供getter方法，这样的属性叫只读属性；</p>
</li>
<li><p>也可以只提供setter方法，这样的属性叫只写属性；</p>
</li>
<li><p>如果属性类型为boolean类型，那么读方法的格式可以是get或is。例如名为abc的boolean类型的属性，它的读方法可以是getAbc()，也可以是isAbc()；</p>
</li>
</ul>
<p>JavaBean属性名要求：前两个字母要么都大写，要么都小写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String iD;	<span class="comment">// wrong</span></span><br><span class="line">	<span class="keyword">private</span> String ID;</span><br><span class="line">	<span class="keyword">private</span> String qQ;	<span class="comment">// wrong</span></span><br><span class="line">	<span class="keyword">private</span> String QQ;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JavaBean可能存在属性，但不存在这个成员变量，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"zhangSan"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中User类有一个名为username的只读属性！但User类并没有username这个成员变量！</p>
<p>还可以更变态一点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String hello;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hello;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hello = username;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中User类中有一个名为username的属性，它是可读可写的属性！而Use类的成员变量名为hello！也就是说JavaBean的属性名取决于方法名称，而不是成员变量的名称。但通常没有人做这么变态的事情。</p>
<h4 id="内省（了解）"><a href="#内省（了解）" class="headerlink" title="内省（了解）"></a>内省（了解）</h4><p>内省的目标是得到JavaBean属性的读、写方法的反射对象，通过反射对JavaBean属性进行操作的一组API。例如User类有名为username的JavaBean属性，通过两个Method对象（一个是getUsenrmae()，一个是setUsername()）来操作User对象。</p>
<p>如果你还不能理解内省是什么，那么我们通过一个问题来了解内省的作用。现在我们有一个Map，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">map.put(<span class="string">"password"</span>, <span class="string">"admin123"</span>);</span><br><span class="line"><span class="comment">// ----------------------------------------------------</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在需要把map的数据封装到一个User对象中！User类有两个JavaBean属性，一个叫username，另一个叫password。</p>
<p>你可能想到的是反射，通过map的key来查找User类的Field！这么做是没有问题的，但我们要知道类的成员变量是私有的，虽然也可以通过反射去访问类的私有的成员变量，但我们也要清楚反射访问私有的东西是有”危险”的，所以还是建议通过getUsername和setUsername来访问JavaBean属性。</p>
<h5 id="内省之获取BeanInfo"><a href="#内省之获取BeanInfo" class="headerlink" title="内省之获取BeanInfo"></a>内省之获取BeanInfo</h5><p>我们这里不想去对JavaBean规范做过多的介绍，所以也就不在多介绍BeanInfo的”出身”了。你只需要知道如何得到它，以及BeanInfo有什么。</p>
<p>通过java.beans.Introspector的getBeanInfo()方法来获取java.beans.BeanInfo实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanInfo beanInfo = Introspector.getBeanInfo(User<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="得到所有属性描述符（PropertyDescriptor）"><a href="#得到所有属性描述符（PropertyDescriptor）" class="headerlink" title="得到所有属性描述符（PropertyDescriptor）"></a>得到所有属性描述符（PropertyDescriptor）</h5><p>通过BeanInfo可以得到这个类的所有JavaBean属性的PropertyDescriptor对象。然后就可以通过PropertyDescriptor对象得到这个属性的getter/setter方法的Method对象了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PropertyDescriptor[] pds = beanInfo.getPropertyDescriptors();</span><br></pre></td></tr></table></figure>

<p>每个PropertyDescriptor对象对应一个JavaBean属性：</p>
<ul>
<li><p>String getName()：获取JavaBean属性名称；</p>
</li>
<li><p>Method getReadMethod：获取属性的读方法；</p>
</li>
<li><p>Method getWriteMethod：获取属性的写方法。</p>
</li>
</ul>
<h5 id="完成Map数据封装到User对象中"><a href="#完成Map数据封装到User对象中" class="headerlink" title="完成Map数据封装到User对象中"></a>完成Map数据封装到User对象中</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">    map.put(<span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">    map.put(<span class="string">"password"</span>, <span class="string">"admin123"</span>);</span><br><span class="line"></span><br><span class="line">    BeanInfo beanInfo = Introspector.getBeanInfo(User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    PropertyDescriptor[] pds = beanInfo.getPropertyDescriptors();</span><br><span class="line"></span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="keyword">for</span>(PropertyDescriptor pd : pds) &#123;</span><br><span class="line">        String name = pd.getName();</span><br><span class="line">        String value = map.get(name);</span><br><span class="line">        <span class="keyword">if</span>(value != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Method writeMethod = pd.getWriteMethod();</span><br><span class="line">            writeMethod.invoke(user, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="commons-beanutils"><a href="#commons-beanutils" class="headerlink" title="commons-beanutils"></a>commons-beanutils</h4><p>提到内省，不能不提commons-beanutils这个工具。它底层使用了内省，对内省进行了大量的简化！</p>
<p>使用beanutils需要的jar包：</p>
<ul>
<li><p>commons-beanutils.jar；</p>
</li>
<li><p>commons-logging.jar；</p>
</li>
</ul>
<h5 id="设置JavaBean属性"><a href="#设置JavaBean属性" class="headerlink" title="设置JavaBean属性"></a>设置JavaBean属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line"></span><br><span class="line">BeanUtils.setProperty(user, <span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">BeanUtils.setProperty(user, <span class="string">"password"</span>, <span class="string">"admin123"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure>

<h5 id="获取JavaBean属性"><a href="#获取JavaBean属性" class="headerlink" title="获取JavaBean属性"></a>获取JavaBean属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User(<span class="string">"admin"</span>, <span class="string">"admin123"</span>);</span><br><span class="line"></span><br><span class="line">String username = BeanUtils.getProperty(user, <span class="string">"username"</span>);</span><br><span class="line">String password = BeanUtils.getProperty(user, <span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"username="</span> + username + <span class="string">", password="</span> + password);</span><br></pre></td></tr></table></figure>

<h5 id="封装Map数据到JavaBean对象中"><a href="#封装Map数据到JavaBean对象中" class="headerlink" title="封装Map数据到JavaBean对象中"></a>封装Map数据到JavaBean对象中</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">map.put(<span class="string">"password"</span>, <span class="string">"admin123"</span>);</span><br><span class="line"></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line"></span><br><span class="line">BeanUtils.populate(user, map);</span><br><span class="line"></span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure>



<h4 id="JSP与JavaBean相关的动作标签"><a href="#JSP与JavaBean相关的动作标签" class="headerlink" title="JSP与JavaBean相关的动作标签"></a>JSP与JavaBean相关的动作标签</h4><p>在JSP中与JavaBean相关的标签有：</p>
<ul>
<li><p><code>&lt;jsp:useBean&gt;</code>：创建JavaBean对象；</p>
</li>
<li><p><code>&lt;jsp:setProperty&gt;</code>：设置JavaBean属性；</p>
</li>
<li><p><code>&lt;jsp:getProperty&gt;</code>：获取JavaBean属性；</p>
</li>
</ul>
<p>我们需要先创建一个JavaBean类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User.java</span></span><br><span class="line"><span class="keyword">package</span> tt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="lt-jsp-useBean-gt"><a href="#lt-jsp-useBean-gt" class="headerlink" title="&lt;jsp:useBean&gt;"></a><code>&lt;jsp:useBean&gt;</code></h5><p><code>&lt;jsp:useBean&gt;</code>标签的作用是创建JavaBean对象：</p>
<ul>
<li><p>在当前JSP页面创建JavaBean对象；</p>
</li>
<li><p>把创建的JavaBean对象保存到域对象中；</p>
</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"user1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>上面代码表示在当前JSP页面中创建User类型的对象，并且把它保存到page域中了。下面我们把<code>&lt;jsp:useBean&gt;</code>标签翻译成Java代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">tt.User user1 = <span class="keyword">new</span> tt.User();</span><br><span class="line">pageContext.setAttribute(<span class="string">"user1"</span>, user1);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>这说明我们可以在JSP页面中完成下面的操作：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"user1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> /&gt;</span><br><span class="line">&lt;%=user1 %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">out.println(pageContext.getAttribute(<span class="string">"user1"</span>));</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;jsp:useBean&gt;</code>标签默认是把JavaBean对象保存到page域，还可以通过scope标签属性来指定保存的范围：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"user1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> scope=<span class="string">"page"</span>/&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"user2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> scope=<span class="string">"request"</span>/&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"user3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"user4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> scope=<span class="string">"applicatioin"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;jsp:useBean&gt;</code>标签其实不一定会创建对象！！！其实它会先在指定范围中查找这个对象，如果对象不存在才会创建，我们需要重新对它进行翻译：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"user4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> scope=<span class="string">"applicatioin"</span>/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	tt.User user4 = (tt.User)application.getAttribute(<span class="string">"user4"</span>);</span><br><span class="line">	<span class="keyword">if</span>(user4 == <span class="keyword">null</span>) &#123;</span><br><span class="line">		user4 = <span class="keyword">new</span> tt.User();</span><br><span class="line">		application.setAttribute(<span class="string">"user4"</span>, user4);</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<h5 id="lt-jsp-setProperty-gt-和-lt-jsp-getProperty-gt"><a href="#lt-jsp-setProperty-gt-和-lt-jsp-getProperty-gt" class="headerlink" title="&lt;jsp:setProperty&gt;和&lt;jsp:getProperty&gt;"></a><code>&lt;jsp:setProperty&gt;</code>和<code>&lt;jsp:getProperty&gt;</code></h5><p><code>&lt;jsp:setProperty&gt;</code>标签的作用是给JavaBean设置属性值，而<code>&lt;jsp:getProperty&gt;</code>是用来获取属性值。在使用它们之前需要先创建JavaBean：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"user1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"tt.User"</span> /&gt;</span><br><span class="line">&lt;jsp:setProperty property=<span class="string">"username"</span> name=<span class="string">"user1"</span> value=<span class="string">"admin"</span>/&gt;</span><br><span class="line">&lt;jsp:setProperty property=<span class="string">"password"</span> name=<span class="string">"user1"</span> value=<span class="string">"admin123"</span>/&gt;</span><br><span class="line"></span><br><span class="line">用户名：&lt;jsp:getProperty property=<span class="string">"username"</span> name=<span class="string">"user1"</span>/&gt;&lt;br/&gt;</span><br><span class="line">密　码：&lt;jsp:getProperty property=<span class="string">"password"</span> name=<span class="string">"user1"</span>/&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="EL（表达式语言）"><a href="#EL（表达式语言）" class="headerlink" title="EL（表达式语言）"></a>EL（表达式语言）</h3><h4 id="EL概述"><a href="#EL概述" class="headerlink" title="EL概述"></a>EL概述</h4><h5 id="EL的作用"><a href="#EL的作用" class="headerlink" title="EL的作用"></a>EL的作用</h5><p>JSP2.0要把html和css分离、要把html和javascript分离、要把Java脚本替换成标签。标签的好处是非Java人员都可以使用。</p>
<p>JSP2.0 – 纯标签页面，即：不包含&lt;% … %&gt;、&lt;%! … %&gt;，以及&lt;%= … %&gt;</p>
<p>EL（Expression Language）是一门表达式语言，它对应&lt;%=…%&gt;。我们知道在JSP中，表达式会被输出，所以EL表达式也会被输出。</p>
<h5 id="EL的格式"><a href="#EL的格式" class="headerlink" title="EL的格式"></a>EL的格式</h5><p>格式：${…}</p>
<p>例如：${1 + 2}</p>
<h5 id="关闭EL"><a href="#关闭EL" class="headerlink" title="关闭EL"></a>关闭EL</h5><p>如果希望整个JSP忽略EL表达式，需要在page指令中指定isELIgnored=”true”。</p>
<p>如果希望忽略某个EL表达式，可以在EL表达式之前添加”&quot;，例如：<code>\${1 + 2}</code>。</p>
<h5 id="EL运算符"><a href="#EL运算符" class="headerlink" title="EL运算符"></a>EL运算符</h5><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">说明</th>
<th align="center">范例</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>+</code></td>
<td align="center">加</td>
<td align="center"><code>${17+5}</code></td>
<td align="center">22</td>
</tr>
<tr>
<td align="center"><code>-</code></td>
<td align="center">减</td>
<td align="center"><code>${17-5}</code></td>
<td align="center">12</td>
</tr>
<tr>
<td align="center"><code>*</code></td>
<td align="center">乘</td>
<td align="center"><code>${17*5}</code></td>
<td align="center">85</td>
</tr>
<tr>
<td align="center"><code>/</code>或div</td>
<td align="center">除</td>
<td align="center"><code>${17/5}或${17 div 5}</code></td>
<td align="center">3</td>
</tr>
<tr>
<td align="center"><code>%</code>或mod</td>
<td align="center">取余</td>
<td align="center"><code>${17%5}或${17 mod 5}</code></td>
<td align="center">2</td>
</tr>
<tr>
<td align="center"><code>==</code>或eq</td>
<td align="center">等于</td>
<td align="center"><code>${5==5}或${5 eq 5}</code></td>
<td align="center">true</td>
</tr>
<tr>
<td align="center"><code>!=</code>或ne</td>
<td align="center">不等于</td>
<td align="center"><code>${5!=5}或${5 ne 5}</code></td>
<td align="center">false</td>
</tr>
<tr>
<td align="center"><code>&lt;</code>或lt</td>
<td align="center">小于</td>
<td align="center"><code>${3&lt;5}或${3 lt 5}</code></td>
<td align="center">true</td>
</tr>
<tr>
<td align="center"><code>&gt;</code>或gt</td>
<td align="center">大于</td>
<td align="center"><code>${3&gt;5}或${3 gt 5}</code></td>
<td align="center">false</td>
</tr>
<tr>
<td align="center"><code>&lt;=</code>或le</td>
<td align="center">小于等于</td>
<td align="center"><code>${3&lt;=5}或${3 le 5}</code></td>
<td align="center">true</td>
</tr>
<tr>
<td align="center"><code>&gt;=</code>或ge</td>
<td align="center">大于等于</td>
<td align="center"><code>${3&gt;=5}或${3 ge 5}</code></td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">&amp;&amp;或and</td>
<td align="center">并且</td>
<td align="center"><code>${true&amp;&amp;false}或${true and false}</code></td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">!或not</td>
<td align="center">非</td>
<td align="center"><code>${!true}或${not true}</code></td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">||或or</td>
<td align="center">或者</td>
<td align="center">`  ${true</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">empty</td>
<td align="center">是否为空</td>
<td align="center"><code>${empty &quot;&quot;}</code>，可以判断字符串、数据、集合的长度是否为0，为0返回true。empty还可以与not或!一起使用。<code>${not empty &quot;&quot;}</code></td>
<td align="center">true</td>
</tr>
</tbody></table>
<h5 id="EL不显示null"><a href="#EL不显示null" class="headerlink" title="EL不显示null"></a>EL不显示null</h5><p>当EL表达式的值为null时，会在页面上显示空白，即什么都不显示。</p>
<h4 id="EL表达式格式"><a href="#EL表达式格式" class="headerlink" title="EL表达式格式"></a>EL表达式格式</h4><p>先来了解一下EL表达式的格式！现在还不能演示它，因为需要学习了EL11个内置对象后才方便显示它。</p>
<ul>
<li><p>操作List和数组：<code>${list[0]}</code>、<code>${arr[0]}</code>；</p>
</li>
<li><p>操作bean的属性：<code>${person.name}</code>、<code>${person[&#39;name&#39;]}</code>，对应<code>person.getName()</code>方法；</p>
</li>
<li><p>操作Map的值：<code>${map.key}</code>、<code>${map[&#39;key&#39;]}</code>，对应<code>map.get(key)</code>。</p>
</li>
</ul>
<h4 id="EL内置对象"><a href="#EL内置对象" class="headerlink" title="EL内置对象"></a>EL内置对象</h4><p>EL一共11个内置对象，无需创建即可以使用。这11个内置对象中有10个是Map类型的，最后一个是pageContext对象。</p>
<ul>
<li><p>pageScope</p>
</li>
<li><p>requestScope</p>
</li>
<li><p>sessionScope</p>
</li>
<li><p>applicationScope</p>
</li>
<li><p>param；</p>
</li>
<li><p>paramValues；</p>
</li>
<li><p>header；</p>
</li>
<li><p>headerValues；</p>
</li>
<li><p>initParam；</p>
</li>
<li><p>cookie；</p>
</li>
<li><p>pageContext；</p>
</li>
</ul>
<h5 id="域相关内置对象（重点）"><a href="#域相关内置对象（重点）" class="headerlink" title="域相关内置对象（重点）"></a>域相关内置对象（重点）</h5><p>域内置对象一共有四个：</p>
<ul>
<li><p>pageScope：<code>${pageScope.name}</code>等同与<code>pageContext.getAttribute(&quot;name&quot;);</code></p>
</li>
<li><p>requestScope：<code>${requestScope.name}</code>等同与<code>request.getAttribute(&quot;name&quot;);</code></p>
</li>
<li><p>sessionScoep：<code>${sessionScope.name}</code>等同与<code>session.getAttribute(&quot;name&quot;);</code></p>
</li>
<li><p>applicationScope：<code>${applicationScope.name}</code>等同与<code>application.getAttribute(&quot;name&quot;);</code></p>
</li>
</ul>
<p>如果在域中保存的是JavaBean对象，那么可以使用EL来访问JavaBean属性。因为EL只做读取操作，所以JavaBean一定要提供get方法，而set方法没有要求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%pageContext.setAttribute(<span class="string">"p1"</span>, <span class="keyword">new</span> Person(<span class="string">"zhk"</span>, <span class="number">19</span>, <span class="string">"male"</span>));%&gt;</span><br><span class="line">$&#123;pageScope.p1.name&#125;&lt;br/&gt;</span><br><span class="line">$&#123;pageScope.p1.age&#125;&lt;br/&gt;</span><br><span class="line">$&#123;pageScope.p1.sex&#125;&lt;br/&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/07/01/jDHpKeVcbIhOwRy.png" alt="2.png"></p>
<p>全域查找：${person}表示依次在pageScope、requesScopet、sessionScope、appliationScope四个域中查找名字为person的属性。</p>
<h5 id="请求参数相关内置对象"><a href="#请求参数相关内置对象" class="headerlink" title="请求参数相关内置对象"></a>请求参数相关内置对象</h5><p>param和paramValues这两个内置对象是用来获取请求参数的。</p>
<ul>
<li>param：Map&lt;String,String&gt;类型，param对象可以用来获取参数，与request.getParameter()方法相同。</li>
</ul>
<p><img src="https://i.loli.net/2020/07/01/DP9KeVXEvQUcJ7M.png" alt="2.png"></p>
<p>注意，在使用EL获取参数时，如果参数不存在，返回的是空字符串，而不是null。这一点与使用request.getParameter()方法是不同的。</p>
<ul>
<li>paramValues：paramValues是Map&lt;String, String[]&gt;类型，当一个参数名，对应多个参数值时可以使用它。</li>
</ul>
<h5 id="请求头相关内置对象"><a href="#请求头相关内置对象" class="headerlink" title="请求头相关内置对象"></a>请求头相关内置对象</h5><p>header和headerValues是与请求头相关的内置对象：</p>
<ul>
<li><p>header： Map&lt;String,String&gt;类型，用来获取请求头。</p>
</li>
<li><p>headerValues：headerValues是Map&lt;String,String[]&gt;类型。当一个请求头名称，对应多个值时，使用该对象，这里就不在赘述。</p>
</li>
</ul>
<h5 id="应用初始化参数相关内置对象"><a href="#应用初始化参数相关内置对象" class="headerlink" title="应用初始化参数相关内置对象"></a>应用初始化参数相关内置对象</h5><ul>
<li>initParam：initParam是Map&lt;String,String&gt;类型。它对应web.xml文件中的<code>&lt;context-param&gt;</code>参数。</li>
</ul>
<p><img src="https://i.loli.net/2020/07/01/HLTiF51eXWyPnrl.png" alt="2.png"></p>
<h5 id="Cookie相关内置对象"><a href="#Cookie相关内置对象" class="headerlink" title="Cookie相关内置对象"></a>Cookie相关内置对象</h5><ul>
<li>cookie：cookie是Map&lt;String,Cookie&gt;类型，其中key是Cookie的名字，而值是Cookie对象本身。</li>
</ul>
<p><img src="https://i.loli.net/2020/07/01/jNO1Iy69mvubBMT.png" alt="2.png"></p>
<h5 id="pageContext对象-1"><a href="#pageContext对象-1" class="headerlink" title="pageContext对象"></a>pageContext对象</h5><p>pageContext：pageContext是PageContext类型！可以使用pageContext对象调用getXXX()方法，例如pageContext.getRequest()，可以${pageContext.request}。也就是读取JavaBean属性！！！</p>
<table>
<thead>
<tr>
<th align="left">EL表达式</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">${pageContext.request.queryString}</td>
<td align="left">pageContext.getRequest().getQueryString();</td>
</tr>
<tr>
<td align="left">${pageContext.request.requestURL}</td>
<td align="left">pageContext.getRequest().getRequestURL();</td>
</tr>
<tr>
<td align="left">${pageContext.request.contextPath}</td>
<td align="left">pageContext.getRequest().getContextPath();</td>
</tr>
<tr>
<td align="left">${pageContext.request.method}</td>
<td align="left">pageContext.getRequest().getMethod();</td>
</tr>
<tr>
<td align="left">${pageContext.request.protocol}</td>
<td align="left">pageContext.getRequest().getProtocol();</td>
</tr>
<tr>
<td align="left">${pageContext.request.remoteUser}</td>
<td align="left">pageContext.getRequest().getRemoteUser();</td>
</tr>
<tr>
<td align="left">${pageContext.request.remoteAddr}</td>
<td align="left">pageContext.getRequest().getRemoteAddr();</td>
</tr>
<tr>
<td align="left">${pageContext.session.new}</td>
<td align="left">pageContext.getSession().isNew();</td>
</tr>
<tr>
<td align="left">${pageContext.session.id}</td>
<td align="left">pageContext.getSession().getId();</td>
</tr>
<tr>
<td align="left">${pageContext.servletContext.serverInfo}</td>
<td align="left">pageContext.getServletContext().getServerInfo();</td>
</tr>
</tbody></table>
<h3 id="EL函数库"><a href="#EL函数库" class="headerlink" title="EL函数库"></a>EL函数库</h3><h4 id="什么EL函数库"><a href="#什么EL函数库" class="headerlink" title="什么EL函数库"></a>什么EL函数库</h4><p>EL函数库是由第三方对EL的扩展，我们现在学习的EL函数库是由JSTL添加的。JSTL明天再学！</p>
<p>EL函数库就是定义一些有返回值的静态方法。然后通过EL语言来调用它们！当然，不只是JSTL可以定义EL函数库，我们也可以自定义EL函数库。</p>
<p>EL函数库中包含了很多对字符串的操作方法，以及对集合对象的操作。例如：<code>${fn:length(“abc”)}</code>会输出3，即字符串的长度。</p>
<h4 id="导入函数库"><a href="#导入函数库" class="headerlink" title="导入函数库"></a>导入函数库</h4><p>因为是第三方的东西，所以需要导入。导入需要使用taglib指令！</p>
<p><code>&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt;</code></p>
<h4 id="EL函数库介绍"><a href="#EL函数库介绍" class="headerlink" title="EL函数库介绍"></a>EL函数库介绍</h4><ul>
<li>String toUpperCase(String input)：</li>
<li>String toLowerCase(String input)：</li>
<li>int indexOf(String input, String substring)：</li>
<li>boolean contains(String input, String substring)：</li>
<li>boolean containsIgnoreCase(String input, String substring)：</li>
<li>boolean startsWith(String input, String substring)：</li>
<li>boolean endsWith(String input, String substring)：</li>
<li>String substring(String input, int beginIndex, int endIndex)：</li>
<li>String substringAfter(String input, String substring)：</li>
<li>substringBefore(String input, String substring)：</li>
<li>String escapeXml(String input)：</li>
<li>String trim(String input)：</li>
<li>String replace(String input, String substringBefore, String substringAfter)：</li>
<li>String[] split(String input, String delimiters)：</li>
<li>int length(Object obj)：</li>
<li>String join(String array[], String separator)：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</span><br><span class="line">…</span><br><span class="line">String[] strs = &#123;<span class="string">"a"</span>, <span class="string">"b"</span>,<span class="string">"c"</span>&#125;;</span><br><span class="line">List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">list.add(<span class="string">"a"</span>);</span><br><span class="line">pageContext.setAttribute(<span class="string">"arr"</span>, strs);</span><br><span class="line">pageContext.setAttribute(<span class="string">"list"</span>, list);</span><br><span class="line">%&gt;</span><br><span class="line">$&#123;fn:length(arr) &#125;&lt;br/&gt;&lt;!--<span class="number">3</span>--&gt;</span><br><span class="line">$&#123;fn:length(list) &#125;&lt;br/&gt;&lt;!--<span class="number">1</span>--&gt;</span><br><span class="line">$&#123;fn:toLowerCase(<span class="string">"Hello"</span>) &#125;&lt;br/&gt; &lt;!-- hello --&gt;</span><br><span class="line">$&#123;fn:toUpperCase(<span class="string">"Hello"</span>) &#125;&lt;br/&gt; &lt;!-- HELLO --&gt;</span><br><span class="line">$&#123;fn:contains(<span class="string">"abc"</span>, <span class="string">"a"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:containsIgnoreCase(<span class="string">"abc"</span>, <span class="string">"Ab"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:contains(arr, <span class="string">"a"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:containsIgnoreCase(list, <span class="string">"A"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:endsWith(<span class="string">"Hello.java"</span>, <span class="string">".java"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:startsWith(<span class="string">"Hello.java"</span>, <span class="string">"Hell"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="keyword">true</span> --&gt;</span><br><span class="line">$&#123;fn:indexOf(<span class="string">"Hello-World"</span>, <span class="string">"-"</span>)&#125;&lt;br/&gt;&lt;!-- <span class="number">5</span> --&gt;</span><br><span class="line">$&#123;fn:join(arr, <span class="string">";"</span>)&#125;&lt;br/&gt;&lt;!-- a;b;c --&gt;</span><br><span class="line">$&#123;fn:replace(<span class="string">"Hello-World"</span>, <span class="string">"-"</span>, <span class="string">"+"</span>)&#125;&lt;br/&gt;&lt;!-- Hello+World --&gt;</span><br><span class="line">$&#123;fn:join(fn:split(<span class="string">"a;b;c;"</span>, <span class="string">";"</span>), <span class="string">"-"</span>)&#125;&lt;br/&gt;&lt;!-- a-b-c --&gt;</span><br><span class="line"></span><br><span class="line">$&#123;fn:substring(<span class="string">"0123456789"</span>, <span class="number">6</span>, <span class="number">9</span>)&#125;&lt;br/&gt;&lt;!-- <span class="number">678</span> --&gt;</span><br><span class="line">$&#123;fn:substring(<span class="string">"0123456789"</span>, <span class="number">5</span>, -<span class="number">1</span>)&#125;&lt;br/&gt;&lt;!-- <span class="number">56789</span> --&gt;</span><br><span class="line">$&#123;fn:substringAfter(<span class="string">"Hello-World"</span>, <span class="string">"-"</span>)&#125;&lt;br/&gt;&lt;!-- World --&gt;</span><br><span class="line">$&#123;fn:substringBefore(<span class="string">"Hello-World"</span>, <span class="string">"-"</span>)&#125;&lt;br/&gt;&lt;!-- Hello --&gt;</span><br><span class="line">$&#123;fn:trim(<span class="string">"     a b c     "</span>)&#125;&lt;br/&gt;&lt;!-- a b c --&gt;</span><br><span class="line">$&#123;fn:escapeXml("&lt;html&gt;&lt;/html&gt;")&#125;&lt;br/&gt; &lt;!-- &lt;html&gt;&lt;/html&gt; --&gt;</span><br></pre></td></tr></table></figure>

<h4 id="自定义EL函数库"><a href="#自定义EL函数库" class="headerlink" title="自定义EL函数库"></a>自定义EL函数库</h4><ul>
<li><p>写一个类，写一个有返回值的静态方法；</p>
</li>
<li><p>编写itcast.tld文件，可以参数fn.tld文件来写，把itcast.tld文件放到/WEB-INF目录下；</p>
</li>
<li><p>在页面中添加taglib指令，导入自定义标签库。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ItcastFuncations.java</span></span><br><span class="line"><span class="keyword">package</span> cn.itcast.el.funcations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItcastFuncations</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"自定义EL函数库测试"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>itcast.tld（放到classes下）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>itcast<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uri</span>&gt;</span>http://www.itcast.cn/jsp/functions<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-class</span>&gt;</span>cn.itcast.el.funcations.ItcastFuncations<span class="tag">&lt;/<span class="name">function-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-signature</span>&gt;</span>String test()<span class="tag">&lt;/<span class="name">function-signature</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"itcast"</span> uri=<span class="string">"/WEB-INF/itcast.tld"</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt; </span><br><span class="line">  	&lt;h1&gt;$&#123;itcast:test() &#125;&lt;/h1&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Day-08"><a href="#Day-08" class="headerlink" title="Day 08"></a>Day 08</h2><p><em>02/07/2020</em></p>
<h3 id="JSTL-标签库"><a href="#JSTL-标签库" class="headerlink" title="JSTL 标签库"></a>JSTL 标签库</h3><h4 id="什么是JSTL"><a href="#什么是JSTL" class="headerlink" title="什么是JSTL"></a>什么是JSTL</h4><p>JSTL是apache对EL表达式的扩展（也就是说JSTL依赖EL），JSTL是标签语言！JSTL标签使用以来非常方便，它与JSP动作标签一定，只不过它不是JSP内置的标签，需要我们自己导包，以及指定标签库而已！</p>
<p>如果你使用MyEclipse开发JavaWeb，那么在把项目发布到Tomcat时，你会发现，MyEclipse会在lib目录下存放jstl的Jar包！如果你没有使用MyEclipse开发那么需要自己来导入这个JSTL的Jar包：jstl-1.2.jar。</p>
<h4 id="JSTL标签库"><a href="#JSTL标签库" class="headerlink" title="JSTL标签库"></a>JSTL标签库</h4><p>JSTL一共包含四大标签库：</p>
<ul>
<li><p>core：核心标签库，我们学习的重点；</p>
</li>
<li><p>fmt：格式化标签库，只需要学习两个标签即可；</p>
</li>
<li><p>sql：数据库标签库，不需要学习了，它过时了；</p>
</li>
<li><p>xml：xml标签库，不需要学习了，它过时了。</p>
</li>
</ul>
<h4 id="使用taglib指令导入标签库"><a href="#使用taglib指令导入标签库" class="headerlink" title="使用taglib指令导入标签库"></a>使用taglib指令导入标签库</h4><p>除了JSP动作标签外，使用其他第三方的标签库都需要：</p>
<ul>
<li><p>导包；</p>
</li>
<li><p>在使用标签的JSP页面中使用taglib指令导入标签库；</p>
</li>
</ul>
<p>下面是导入JSTL的core标签库：</p>
<p><code>&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</code> <strong>这里的/jsp需要注意*</strong></p>
<ul>
<li><p><code>prefix=&quot;c&quot;</code>：指定标签库的前缀，这个前缀可以随便给值，但大家都会在使用core标签库时指定前缀为c；</p>
</li>
<li><p><code>uri=&quot;http://java.sun.com/jstl/core&quot;</code>：指定标签库的uri，它不一定是真实存在的网址，但它可以让JSP找到标签库的描述文件；</p>
</li>
</ul>
<h4 id="core标签库常用标签"><a href="#core标签库常用标签" class="headerlink" title="core标签库常用标签"></a>core标签库常用标签</h4><h5 id="out和set"><a href="#out和set" class="headerlink" title="out和set"></a>out和set</h5><p>out</p>
<table>
<thead>
<tr>
<th><code>&lt;c:out value=”aaa”/&gt;</code></th>
<th>输出aaa字符串常量</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;c:out value=”${aaa}”/&gt;</code></td>
<td>与${aaa}相同</td>
</tr>
<tr>
<td><code>&lt;c:out value=”${aaa}” default=”xxx”/&gt;</code></td>
<td>当${aaa}不存在时，输出xxx字符串</td>
</tr>
<tr>
<td><code>&lt;%</code><br><code>request.setAttribute(&quot;a&quot;,&quot;&lt;script&gt;alert(&#39;hello&#39;);&lt;/script&gt;&quot;);</code><br><code>%&gt;</code> <br><code>&lt;c:out value=&quot;${a }&quot;  default=&quot;xxx&quot; escapeXml=&quot;false&quot; /&gt;</code></td>
<td>当escapeXml为false，不会转换“&lt;”、“&gt;”。这可能会受到JavaScript攻击。</td>
</tr>
</tbody></table>
<p>set</p>
<table>
<thead>
<tr>
<th><code>&lt;c:set var=”a” value=”hello”/&gt;</code></th>
<th>在pageContext中添加name为a，value为hello的数据。</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;c:set var=”a” value=”hello” scope=”session”/&gt;</code></td>
<td>在session中添加name为a，value为hello的数据。</td>
</tr>
</tbody></table>
<h5 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h5><table>
<thead>
<tr>
<th><code>&lt;%</code><br><code>pageContext.setAttribute(&quot;a&quot;,  &quot;pageContext&quot;);</code><br><code>request.setAttribute(&quot;a&quot;,  &quot;session&quot;);</code><br><code>session.setAttribute(&quot;a&quot;,  &quot;session&quot;);</code><br><code>application.setAttribute(&quot;a&quot;,  &quot;application&quot;);</code><br><code>%&gt;</code><br><code>&lt;c:remove  var=&quot;a&quot;/&gt;</code><br><code>&lt;c:out  value=&quot;${a }&quot; default=&quot;none&quot;/&gt;</code></th>
<th>删除所有域中name为a的数据！</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;c:remove var=&quot;a&quot; scope=”page”/&gt;</code></td>
<td>删除pageContext中name为a的数据！</td>
</tr>
</tbody></table>
<h5 id="url"><a href="#url" class="headerlink" title="url"></a>url</h5><p>url标签会在需要URL重写时添加sessionId。</p>
<table>
<thead>
<tr>
<th><code>&lt;c:url value=&quot;/&quot;/&gt;</code></th>
<th>输出上下文路径：/day08_01/</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;c:url value=&quot;/&quot;  var=&quot;a&quot; scope=&quot;request&quot;/&gt;</code></td>
<td>把本该输出的结果赋给变量a。范围为request</td>
</tr>
<tr>
<td><code>&lt;c:url value=&quot;/AServlet&quot;/&gt;</code></td>
<td>输出：/day08_01/AServlet</td>
</tr>
<tr>
<td><code>&lt;c:url value=&quot;/AServlet&quot;&gt;</code><br>  <code>&lt;c:param name=&quot;username&quot;  value=&quot;abc&quot;/&gt;</code><br>  <code>&lt;c:param name=&quot;password&quot;  value=&quot;123&quot;/&gt;</code><br>  <code>&lt;/c:url&gt;</code></td>
<td>输出：/day08_01/AServlet?username=abc&amp;password=123  如果参数中包含中文，那么会自动使用URL编码！</td>
</tr>
</tbody></table>
<h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><p>if标签的test属性必须是一个boolean类型的值，如果test的值为true，那么执行if标签的内容，否则不执行。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"a"</span> value=<span class="string">"hello"</span>/&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;not empty a &#125;"</span>&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"$&#123;a &#125;"</span>/&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<h5 id="choose"><a href="#choose" class="headerlink" title="choose"></a>choose</h5><p>choose标签对应Java中的if/else if/else结构。when标签的test为true时，会执行这个when的内容。当所有when标签的test都为false时，才会执行otherwise标签的内容。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"score"</span> value=<span class="string">"$&#123;param.score &#125;"</span>/&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">	&lt;c:when test="$&#123;score &gt; 100 || score &lt; 0&#125;"&gt;错误的分数：$&#123;score &#125;&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test="$&#123;score &gt;= 90 &#125;"&gt;A级&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test="$&#123;score &gt;= 80 &#125;"&gt;B级&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test="$&#123;score &gt;= 70 &#125;"&gt;C级&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test="$&#123;score &gt;= 60 &#125;"&gt;D级&lt;/c:when&gt;</span><br><span class="line">	&lt;c:otherwise&gt;E级&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<h5 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h5><p>forEach当前就是循环标签了，forEach标签有多种两种使用方式：</p>
<ul>
<li><p>使用循环变量，指定开始和结束值，类似for(int i = 1; i &lt;= 10; i++) {}；</p>
</li>
<li><p>循环遍历集合，类似for(Object o : 集合)；</p>
</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"sum"</span> value=<span class="string">"0"</span> /&gt; </span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"i"</span> begin=<span class="string">"1"</span> end=<span class="string">"10"</span> step=<span class="string">"2"</span>&gt; &lt;%--这里默认步长为<span class="number">1</span> 可设置为<span class="number">2</span>--%&gt;</span><br><span class="line">	&lt;c:set <span class="keyword">var</span>=<span class="string">"sum"</span> value=<span class="string">"$&#123;sum + i&#125;"</span> /&gt; </span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;c:out value=<span class="string">"sum = $&#123;sum &#125;"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>遍历集合和数组</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">String[] names = &#123;<span class="string">"zhangSan"</span>, <span class="string">"liSi"</span>, <span class="string">"wangWu"</span>, <span class="string">"zhaoLiu"</span>&#125;;</span><br><span class="line">pageContext.setAttribute(<span class="string">"ns"</span>, names);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"item"</span> items=<span class="string">"$&#123;ns &#125;"</span>&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"name: $&#123;item &#125;"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>遍历list</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">	names.add(<span class="string">"zhangSan"</span>);</span><br><span class="line">	names.add(<span class="string">"liSi"</span>);</span><br><span class="line">	names.add(<span class="string">"wangWu"</span>);</span><br><span class="line">	names.add(<span class="string">"zhaoLiu"</span>);</span><br><span class="line">	pageContext.setAttribute(<span class="string">"ns"</span>, names);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"item"</span> items=<span class="string">"$&#123;ns &#125;"</span>&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"name: $&#123;item &#125;"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>遍历map</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	Map&lt;String,String&gt; stu = <span class="keyword">new</span> LinkedHashMap&lt;String,String&gt;();</span><br><span class="line">	stu.put(<span class="string">"number"</span>, <span class="string">"N_1001"</span>);</span><br><span class="line">	stu.put(<span class="string">"name"</span>, <span class="string">"zhangSan"</span>);</span><br><span class="line">	stu.put(<span class="string">"age"</span>, <span class="string">"23"</span>);</span><br><span class="line">	stu.put(<span class="string">"sex"</span>, <span class="string">"male"</span>);</span><br><span class="line">	pageContext.setAttribute(<span class="string">"stu"</span>, stu);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"item"</span> items=<span class="string">"$&#123;stu &#125;"</span>&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"$&#123;item.key &#125;: $&#123;item.value &#125;"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>forEach标签还有一个属性：varStatus，这个属性用来指定接收“循环状态”的变量名，例如：<code>&lt;forEach varStatus=”vs” …/&gt;</code>，这时就可以使用vs这个变量来获取循环的状态了。</p>
<ul>
<li><p>count：int类型，当前以遍历元素的个数；</p>
</li>
<li><p>index：int类型，当前元素的下标；</p>
</li>
<li><p>first：boolean类型，是否为第一个元素；</p>
</li>
<li><p>last：boolean类型，是否为最后一个元素；</p>
</li>
<li><p>current：Object类型，表示当前项目。</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"item"</span> items=<span class="string">"$&#123;ns &#125;"</span> varStatus=<span class="string">"vs"</span>&gt;</span><br><span class="line">	&lt;c:if test="$&#123;vs.first &#125;"&gt;第一行：&lt;/c:if&gt;</span><br><span class="line">	&lt;c:if test="$&#123;vs.last &#125;"&gt;最后一行：&lt;/c:if&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"第$&#123;vs.count &#125;行: "</span>/&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"[$&#123;vs.index &#125;]: "</span>/&gt;</span><br><span class="line">	&lt;c:out value=<span class="string">"name: $&#123;vs.current &#125;"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<h4 id="fmt标签库常用标签"><a href="#fmt标签库常用标签" class="headerlink" title="fmt标签库常用标签"></a>fmt标签库常用标签</h4><p>fmt标签库是用来格式化输出的，通常需要格式化的有时间和数字。</p>
<p>格式化时间：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"fmt"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;</span><br><span class="line">......</span><br><span class="line">&lt;%</span><br><span class="line">	Date date = <span class="keyword">new</span> Date();</span><br><span class="line">	pageContext.setAttribute(<span class="string">"d"</span>, date);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;fmt:formatDate value=<span class="string">"$&#123;d &#125;"</span> pattern=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>格式化数字：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	<span class="keyword">double</span> d1 = <span class="number">3.5</span>;</span><br><span class="line">	<span class="keyword">double</span> d2 = <span class="number">4.4</span>; </span><br><span class="line">	pageContext.setAttribute(<span class="string">"d1"</span>, d1);</span><br><span class="line">	pageContext.setAttribute(<span class="string">"d2"</span>, d2);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;fmt:formatNumber value=<span class="string">"$&#123;d1 &#125;"</span> pattern=<span class="string">"0.00"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;fmt:formatNumber value=<span class="string">"$&#123;d2 &#125;"</span> pattern=<span class="string">"#.##"</span>/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="自定义标签"><a href="#自定义标签" class="headerlink" title="自定义标签"></a>自定义标签</h3><h4 id="自定义标签概述"><a href="#自定义标签概述" class="headerlink" title="自定义标签概述"></a>自定义标签概述</h4><h5 id="自定义标签的步骤"><a href="#自定义标签的步骤" class="headerlink" title="自定义标签的步骤"></a>自定义标签的步骤</h5><p>其实我们在JSP页面中使用标签就等于调用某个对象的某个方法一样，例如：&lt;c:if test=””&gt;，这就是在调用对象的方法一样。自定义标签其实就是自定义类一样！</p>
<ul>
<li><p>定义标签处理类：必须是Tag或SimpleTag的实现类；</p>
</li>
<li><p>编写标签库描述符文件（TLD）；</p>
</li>
</ul>
<p>SimpleTag接口是JSP2.0中新给出的接口，用来简化自定义标签，所以现在我们基本上都是使用SimpleTag。</p>
<p>Tag是老的，传统的自定义标签时使用的接口，现在不建议使用它了。</p>
<h5 id="SimpleTag接口介绍"><a href="#SimpleTag接口介绍" class="headerlink" title="SimpleTag接口介绍"></a>SimpleTag接口介绍</h5><p>SimpleTag接口内容如下：</p>
<ul>
<li><p>void doTag()：标签执行方法；</p>
</li>
<li><p>JspTag getParent()：获取父标签；</p>
</li>
<li><p>void setParent(JspTag parent)：设置父标签</p>
</li>
<li><p>void setJspContext(JspContext context)：设置PageContext</p>
</li>
<li><p>void setJspBody(JspFragment jspBody)：设置标签体对象；</p>
</li>
</ul>
<p>请记住，万物皆对象！在JSP页面中的标签也是对象！你可以通过查看JSP的“真身”清楚的知道，所有标签都会变成对象的方法调用。标签对应的类我们称之为“标签处理类”！</p>
<p>标签的生命周期：</p>
<ol>
<li><p>当容器（Tomcat）第一次执行到某个标签时，会创建标签处理类的实例；</p>
</li>
<li><p>然后调用setJspContext(JspContext)方法，把当前JSP页面的pageContext对象传递给这个方法；</p>
</li>
<li><p>如果当前标签有父标签，那么使用父标签的标签处理类对象调用setParent(JspTag)方法；</p>
</li>
<li><p>如果标签有标签体，那么把标签体转换成JspFragment对象，然后调用setJspBody()方法；</p>
</li>
<li><p>每次执行标签时，都调用doTag()方法，它是标签处理方法。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloTag.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">implements</span> <span class="title">SimpleTag</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> JspTag parent;</span><br><span class="line">	<span class="keyword">private</span> PageContext pageContext;</span><br><span class="line">	<span class="keyword">private</span> JspFragment jspBody;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		pageContext.getOut().print(<span class="string">"Hello Tag!!!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(JspTag parent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.parent = parent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> JspTag <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.parent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJspContext</span><span class="params">(JspContext pc)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pageContext = (PageContext) pc;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJspBody</span><span class="params">(JspFragment jspBody)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.jspBody = jspBody;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="标签库描述文件（TLD）"><a href="#标签库描述文件（TLD）" class="headerlink" title="标签库描述文件（TLD）"></a>标签库描述文件（TLD）</h5><p>标签库描述文件是用来描述当前标签库中的标签的！标签库描述文件的扩展名为tld，你可以把它放到WEB-INF下，这样就不会被客户端直接访问到了。</p>
<p>hello.tld</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">version</span>=<span class="string">"2.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xml</span>=<span class="string">"http://www.w3.org/XML/1998/namespace"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee </span></span></span><br><span class="line"><span class="tag"><span class="string">						http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd "</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">short-name</span>&gt;</span>itcast<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span> <span class="comment">&lt;!--简称--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">uri</span>&gt;</span>http://www.itcast.cn/tags<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tag</span>&gt;</span>	<span class="comment">&lt;!--一个tag代表一个标签--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>cn.itcast.tag.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="使用标签"><a href="#使用标签" class="headerlink" title="使用标签"></a>使用标签</h5><p>在页面中使用标签分为两步：</p>
<ul>
<li><p>使用taglib导入标签库；</p>
</li>
<li><p>使用标签；</p>
</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"it"</span> uri=<span class="string">"/WEB-INF/hello.tld"</span> %&gt;</span><br><span class="line">......</span><br><span class="line">&lt;it:hello/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="自定义标签进阶"><a href="#自定义标签进阶" class="headerlink" title="自定义标签进阶"></a>自定义标签进阶</h4><h5 id="继承SimpleTagSupport"><a href="#继承SimpleTagSupport" class="headerlink" title="继承SimpleTagSupport"></a>继承SimpleTagSupport</h5><p>继承SimpleTagSuppport要比实现SimpleTag接口方便太多了，现在你只需要重写doTag()方法，其他方法都已经被SimpleTagSuppport完成了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.getJspContext().getOut().write(<span class="string">"&lt;p&gt;Hello SimpleTag!&lt;/p&gt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="有标签体的标签"><a href="#有标签体的标签" class="headerlink" title="有标签体的标签"></a>有标签体的标签</h5><p>我们先来看看标签体内容的可选值：</p>
<p><code>&lt;body-content&gt;</code>元素的可选值有：</p>
<ul>
<li><p>empty：无标签体。</p>
</li>
<li><p>JSP：传统标签支持它，SimpleTag已经不再支持使用<code>&lt;body-content&gt;JSP&lt;/body-content&gt;</code>。标签体内容可以是任何东西：EL、JSTL、&lt;%=%&gt;、&lt;%%&gt;，以及html； </p>
</li>
<li><p>scriptless：标签体内容不能是Java脚本，但可以是EL、JSTL等。在SimpleTag中，如果需要有标签体，那么就使用该选项；</p>
</li>
<li><p>tagdependent：标签体内容不做运算，由标签处理类自行处理，无论标签体内容是EL、JSP、JSTL，都不会做运算。<strong>这个选项几乎没有人会使用！</strong></p>
</li>
</ul>
<p>自定义有标签体的标签需要：</p>
<ul>
<li><p>获取标签体对象：JspFragment jspBody = getJspBody();；</p>
</li>
<li><p>把标签体内容输出到页面：jspBody.invoke(null)；</p>
</li>
<li><p>tld中指定标签内容类型：scriptless。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		PageContext pc = (PageContext) <span class="keyword">this</span>.getJspContext();</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest) pc.getRequest();</span><br><span class="line">		String s = req.getParameter(<span class="string">"exec"</span>);</span><br><span class="line">		<span class="keyword">if</span>(s != <span class="keyword">null</span> &amp;&amp; s.endsWith(<span class="string">"true"</span>)) &#123;</span><br><span class="line">			JspFragment body = <span class="keyword">this</span>.getJspBody(); <span class="comment">// 获取标签体对象</span></span><br><span class="line">			body.invoke(<span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>cn.itcast.tags.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;itcast:hello&gt;</span><br><span class="line">    &lt;h1&gt;哈哈哈~&lt;/h1&gt;</span><br><span class="line">&lt;/itcast:hello&gt;</span><br></pre></td></tr></table></figure>

<h5 id="不执行标签下面的页面内容"><a href="#不执行标签下面的页面内容" class="headerlink" title="不执行标签下面的页面内容"></a>不执行标签下面的页面内容</h5><p>如果希望在执行了自定义标签后，不再执行JSP页面下面的东西，那么就需要在doTag()方法中使用SkipPageException。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkipTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.getJspContext().getOut().print(<span class="string">"&lt;h1&gt;只能看到我！&lt;/h1&gt;"</span>);</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> SkipPageException();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>skip<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>cn.itcast.tags.SkipTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;itcast:skip/&gt;</span><br><span class="line">&lt;h1&gt;看不见我！&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<h5 id="带有属性的标签"><a href="#带有属性的标签" class="headerlink" title="带有属性的标签"></a>带有属性的标签</h5><p>一般标签都会带有属性，例如<code>&lt;c:if test=””&gt;</code>，其中test就是一个boolean类型的属性。完成带有属性的标签需要：</p>
<ul>
<li><p>在处理类中给出JavaBean属性（提供get/set方法）；</p>
</li>
<li><p>在TLD中部属相关属性。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IfTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> test;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> test;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTest</span><span class="params">(<span class="keyword">boolean</span> test)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.test = test;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(test) &#123;</span><br><span class="line">			<span class="keyword">this</span>.getJspBody().invoke(<span class="keyword">null</span>); <span class="comment">// 执行标签内容</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>if<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>cn.itcast.tag.IfTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span>	<span class="comment">&lt;!--属性必须--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span>	<span class="comment">&lt;!--可为EL或JSTL 否则只为常量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	pageContext.setAttribute(<span class="string">"one"</span>, <span class="keyword">true</span>);</span><br><span class="line">	pageContext.setAttribute(<span class="string">"two"</span>, <span class="keyword">false</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;it:if test="$&#123;one &#125;"&gt;xixi&lt;/it:if&gt;</span><br><span class="line">&lt;it:if test="$&#123;two &#125;"&gt;haha&lt;/it:if&gt;</span><br><span class="line">&lt;it:if test="true"&gt;hehe&lt;/it:if&gt;</span><br></pre></td></tr></table></figure>

<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><h4 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h4><p><img src="https://i.loli.net/2020/07/02/tCNjacl82GwU5v6.png" alt="2.png"></p>
<p>MVC模式（Model-View-Controller）是软件工程中的一种软件架构模式，把软件系统分为三个基本部分：模型（Model）、视图（View）和控制器（Controller）。</p>
<p>MVC模式最早为Trygve Reenskaug)提出，为施乐帕罗奥多研究中心（Xerox PARC）的Smalltalk语言发明的一种软件设计模式。</p>
<p>MVC可对程序的后期维护和扩展提供了方便，并且使程序某些部分的重用提供了方便。而且MVC也使程序简化，更加直观。</p>
<ul>
<li><p>控制器Controller：对请求进行处理，负责请求转发；</p>
</li>
<li><p>视图View：界面设计人员进行图形界面设计；</p>
</li>
<li><p>模型Model：程序编写程序应用的功能（实现算法等等）、数据库管理；</p>
</li>
</ul>
<p>注意，MVC不是Java的东西，几乎现在所有B/S结构的软件都采用了MVC设计模式。但是要注意，MVC在B/S结构软件并没有完全实现，例如在我们今后的B/S软件中并不会有事件驱动！</p>
<h4 id="JavaWeb与MVC"><a href="#JavaWeb与MVC" class="headerlink" title="JavaWeb与MVC"></a>JavaWeb与MVC</h4><p>JavaWeb的经历了JSP Model1、JSP Model1二代、JSP Model2三个时期。</p>
<h5 id="JSP-Model1第一代"><a href="#JSP-Model1第一代" class="headerlink" title="JSP Model1第一代"></a>JSP Model1第一代</h5><p>JSP Model1是JavaWeb早期的模型，它适合小型Web项目，开发成本低！Model1第一代时期，服务器端只有JSP页面，所有的操作都在JSP页面中，连访问数据库的API也在JSP页面中完成。也就是说，所有的东西都耦合在一起，对后期的维护和扩展极为不利。</p>
<h5 id="JSP-Model1第二代"><a href="#JSP-Model1第二代" class="headerlink" title="JSP Model1第二代"></a>JSP Model1第二代</h5><p>JSP Model1第二代有所改进，把业务逻辑的内容放到了JavaBean中，而JSP页面负责显示以及请求调度的工作。虽然第二代比第一代好了些，但还让JSP做了过多的工作，JSP中把视图工作和请求调度（控制器）的工作耦合在一起了。</p>
<h5 id="JSP-Model2"><a href="#JSP-Model2" class="headerlink" title="JSP Model2"></a>JSP Model2</h5><p>JSP Model2模式已经可以清晰的看到MVC完整的结构了。</p>
<ul>
<li><p>JSP：视图层，用来与用户打交道。负责接收用来的数据，以及显示数据给用户；</p>
</li>
<li><p>Servlet：控制层，负责找到合适的模型对象来处理业务逻辑，转发到合适的视图；</p>
</li>
<li><p>JavaBean：模型层，完成具体的业务工作，例如：开启、转账等。</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/07/02/rW3h8gzknvsJeU1.png" alt="2.png"></p>
<p>JSP Model2适合多人合作开发大型的Web项目，各司其职，互不干涉，有利于开发中的分工，有利于组件的重用。但是，Web项目的开发难度加大，同时对开发人员的技术要求也提高了。</p>
<h3 id="JavaWeb三层框架"><a href="#JavaWeb三层框架" class="headerlink" title="JavaWeb三层框架"></a>JavaWeb三层框架</h3><p>我们常说的三层框架是由JavaWeb提出的，也就是说这是JavaWeb独有的！</p>
<p>所谓三层是表述层（WEB层）、业务逻辑层（Business Logic），以及数据访问层（Data Access）。</p>
<ul>
<li><p>WEB（表述）层：包含JSP和Servlet等与WEB相关的内容；</p>
</li>
<li><p>业务逻辑层：业务层中不包含JavaWeb API，它只关心业务逻辑，它对应功能；</p>
</li>
<li><p>数据访问层：封装了对数据库的访问细节；</p>
</li>
</ul>
<p>注意，在业务层中不能出现JavaWeb API，例如request、response等。也就是说，业务层代码是可重用的，甚至可以应用到非Web环境中。业务层的每个方法可以理解成一个万能，例如转账业务方法。业务层依赖数据层，而Web层依赖业务层！</p>
<p><img src="https://i.loli.net/2020/07/02/47i2GSkRPLAW3YB.png" alt="2.png"></p>
<hr>
<h2 id="Day-09"><a href="#Day-09" class="headerlink" title="Day 09"></a>Day 09</h2><p><em>03/07/2020</em></p>
<h3 id="案例-用户注册登录"><a href="#案例-用户注册登录" class="headerlink" title="案例 用户注册登录"></a>案例 用户注册登录</h3><p>要求：3层框架，使用验证码</p>
<h4 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h4><ul>
<li><p>注册</p>
</li>
<li><p>登录</p>
</li>
</ul>
<h5 id="JSP页面"><a href="#JSP页面" class="headerlink" title="JSP页面"></a>JSP页面</h5><ul>
<li><p>regist.jsp</p>
<ul>
<li>注册表单：用户输入注册信息；</li>
<li>回显错误信息：当注册失败时，显示错误信息；</li>
</ul>
</li>
<li><p>login.jsp</p>
<ul>
<li>登录表单：用户输入登录信息；</li>
<li>回显错误信息：当登录失败时，显示错误信息；</li>
</ul>
</li>
<li><p>index.jsp</p>
<ul>
<li>用户已登录：显示当前用户名，以及“退出”链接；</li>
<li>用户未登录：显示“您还没有登录”；</li>
</ul>
</li>
</ul>
<h5 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h5><p>User：</p>
<ul>
<li><p>String username；</p>
</li>
<li><p>String password；</p>
</li>
</ul>
<h5 id="Servlet-1"><a href="#Servlet-1" class="headerlink" title="Servlet"></a>Servlet</h5><ul>
<li><p>VerifyCodeServlet</p>
<ul>
<li>生成验证码；</li>
<li>在session中保存验证码文本；</li>
<li>把图片输出到页面</li>
</ul>
</li>
<li><p>RegistServlet</p>
<ul>
<li><p>获取用户名、密码，封装到User对象中；</p>
</li>
<li><p>获取验证码、获取确认密码；</p>
</li>
<li><p>校验用户名、密码、验证码不能为空，校验失败，向request中保存错误信息，转发回regist.jsp显示错误信息；</p>
</li>
<li><p>比较两次输入的错误是否一致，如果不一致，向request中保存错误信息，转发回regist.jsp显示错误信息；</p>
</li>
<li><p>获取session中的验证码，与表单输入的验证码比较，如果不一致，向request中保存错误信息，转发回regist.jsp显示错误信息；</p>
</li>
<li><p>使用UserService的regist()方法完成注册，如果注册失败，向request中保存错误信息，转发回regist.jsp显示错误信息，如果注册成功，转发到login.jsp页面，表示注册成功；</p>
</li>
</ul>
</li>
<li><p>LoginServlet</p>
<ul>
<li><p>获取用户名、密码、验证码；</p>
</li>
<li><p>校验用户名、密码、验证码是否为空，校验失败，向request中保存错误信息，转发回login.jsp显示错误信息；</p>
</li>
<li><p>获取session中的验证码，与表单中的验证码比较，如果不同，向request中保存错误信息，转发回login.jsp显示错误信息；</p>
</li>
<li><p>删除session中的验证码；</p>
</li>
<li><p>通过UserService的login()方法完成登录，如果抛出异常，获取异常信息，保存到request中，转发到login.jsp显示错误信息；</p>
</li>
<li><p>向session中保存当前用户对象；</p>
</li>
<li><p>转发到index.jsp页面，表示登录成功！</p>
</li>
</ul>
</li>
<li><p>QuitServlet</p>
<ul>
<li><p>获取session，销毁之；</p>
</li>
<li><p>重定向到index.jsp；</p>
</li>
</ul>
</li>
</ul>
<h5 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h5><p>UserException：为UserService使用的异常类；</p>
<p>UserService：</p>
<ul>
<li><p>void regist(User user)：</p>
<ul>
<li><p>使用UserDao的findByUsername()方法查询名为user.getUsername()的用户，如果用户存在，说明用户名已经被注册，抛出异常；</p>
</li>
<li><p>使用UserDao的add(User)方法保存用户信息；</p>
</li>
</ul>
</li>
<li><p>User login(String username, String password)：</p>
<ul>
<li><p>使用UserDao的findByUsername()方法查询名为user.getUsername()的用户，如果用户不存在，说明用户名错误，抛出异常；</p>
</li>
<li><p>如果查询到了User，那么比较参数password与user.getPassword()是否相等，如果不等，说明密码错误，抛出异常；</p>
</li>
<li><p>如果一致，表示登录成功，返回User对象；</p>
</li>
</ul>
</li>
</ul>
<h5 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h5><p>UserDao：</p>
<ul>
<li><p>void add(User)：</p>
<ul>
<li><p>创建SAXReader对象，获取Document对象，再获取根元素；</p>
</li>
<li><p>给root元素添加子元素；</p>
</li>
<li><p>给子元素设置username属性，值为user.getUsername()；</p>
</li>
<li><p>给子元素设置password属性，值为user.getPassword()；</p>
</li>
<li><p>创建OutputFormat对象，指定缩进为“\t”，指定添加换行；</p>
</li>
<li><p>设置OutputFormat清空原有空白；</p>
</li>
<li><p>使用FileWrtier和OutputFormat创建XMLWriter对象；</p>
</li>
<li><p>使用XMLWriter对象的write()保存Document；</p>
</li>
<li><p>关闭XMLWriter对象；</p>
</li>
</ul>
</li>
<li><p>User findByUsername(String username)：</p>
<ul>
<li><p>创建SAXReader对象，获取Document对象；</p>
</li>
<li><p>使用Xpath（//user[username=’xxx’]）来查询元素；</p>
</li>
<li><p>如果元素没有查询到，返回null；</p>
</li>
<li><p>如果元素查询到了，那么创建User对象；</p>
</li>
<li><p>把元素的username属性赋给User的username属性；</p>
</li>
<li><p>把元素的password属性赋给User的password属性；</p>
</li>
<li><p>返回user对象；</p>
</li>
</ul>
</li>
</ul>
<h4 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h4><h5 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h5><ul>
<li><p>用户在浏览器地址栏中请求regist.jsp；</p>
</li>
<li><p>服务器发送html给浏览器；</p>
</li>
<li><p>浏览器收到html，开始解析，并显示；</p>
</li>
<li><p>解析到<code>&lt;img&gt;</code>时，请求VerifyCodeServlet；</p>
</li>
<li><p>VerifyCodeServlet生成验证码图片，保存验证码文本，把图片响应给浏览器；</p>
</li>
<li><p>浏览器显示在页面中显示图片。</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/07/03/YzSxaTW74DgGftM.png" alt="2.png"></p>
<p><img src="https://i.loli.net/2020/07/03/DTSVv3xPeZFXInH.png" alt="2.png"></p>
<h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><p>省略。。。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p>login.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;登录&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;p style="font-weight: 900; color: red;"&gt;$&#123;msg &#125;&lt;/p&gt;</span><br><span class="line">    &lt;form action=<span class="string">"&lt;c:url value='/LoginServlet'/&gt;"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> value=<span class="string">"$&#123;user.username &#125;"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        密　码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        验证码：&lt;input type=<span class="string">"text"</span> name=<span class="string">"loginCode"</span> size=<span class="string">"2"</span>/&gt;</span><br><span class="line">        &lt;img id=<span class="string">"vCode"</span> src=<span class="string">"&lt;c:url value='/VerifyCodeServlet?name=loginCode'/&gt;"</span> border=<span class="string">"2"</span>/&gt;</span><br><span class="line">        &lt;a href="javascript:_change()" style="font-size: 12;"&gt;看不清，换一张&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!-------------------------------------------&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="function">function <span class="title">_change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> img = document.getElementById(<span class="string">"vCode"</span>);</span><br><span class="line">        img.src = <span class="string">"&lt;c:url value='/VerifyCodeServlet?name=loginCode&amp;'/&gt;"</span> + <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>regist.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;注册&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;p style="font-weight: 900; color: red;"&gt;$&#123;msg &#125;&lt;/p&gt;</span><br><span class="line">    &lt;form action=<span class="string">"&lt;c:url value='/RegistServlet'/&gt;"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> value=<span class="string">"$&#123;user.username &#125;"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        密　码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        确认密码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"repassword"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        验证码：&lt;input type=<span class="string">"text"</span> name=<span class="string">"registCode"</span> size=<span class="string">"2"</span>/&gt;</span><br><span class="line">        &lt;img id=<span class="string">"vCode"</span> src=<span class="string">"&lt;c:url value='/VerifyCodeServlet?name=registCode'/&gt;"</span> border=<span class="string">"2"</span>/&gt;</span><br><span class="line">        &lt;a href="javascript:_change()" style="font-size: 12;"&gt;看不清，换一张&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"注册"</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!----------------------------------------------------------------------&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="function">function <span class="title">_change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> img = document.getElementById(<span class="string">"vCode"</span>);</span><br><span class="line">        img.src = <span class="string">"&lt;c:url value='/VerifyCodeServlet?name=registCode&amp;'/&gt;"</span> + <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>index.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;主页&lt;/h1&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;c:choose&gt;</span><br><span class="line">        &lt;c:when test=<span class="string">"$&#123;empty sessionScope.user &#125;"</span>&gt;</span><br><span class="line">            您还没有登录</span><br><span class="line">        &lt;/c:when&gt;</span><br><span class="line">        &lt;c:otherwise&gt;</span><br><span class="line">            用户名：$&#123;sessionScope.user.username &#125;</span><br><span class="line">            &lt;a href="&lt;c:url value='/QuitServlet'/&gt;"&gt;退出&lt;/a&gt;</span><br><span class="line">        &lt;/c:otherwise&gt;</span><br><span class="line">    &lt;/c:choose&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VerifyCodeServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"></span><br><span class="line">        VerifyCode vc = <span class="keyword">new</span> VerifyCode();<span class="comment">//创建验证码类</span></span><br><span class="line">        BufferedImage image  = vc.getImage();<span class="comment">//创建验证码图片</span></span><br><span class="line">        request.getSession().setAttribute(name, vc.getText());<span class="comment">//获取验证码文本</span></span><br><span class="line">        System.out.println(vc.getText());</span><br><span class="line">        VerifyCode.output(image, response.getOutputStream());<span class="comment">//输出图片到页面</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RegistServlet.java</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegistServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		User user = <span class="keyword">new</span> User();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			BeanUtils.populate(user, request.getParameterMap());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		String loginCode = request.getParameter(<span class="string">"registCode"</span>);</span><br><span class="line">		String repassword = request.getParameter(<span class="string">"repassword"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(user.getUsername() == <span class="keyword">null</span> || user.getUsername().trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"用户名不能为空!"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(user.getPassword() == <span class="keyword">null</span> || user.getPassword().trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"密码不能为空!"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!user.getPassword().equals(repassword)) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"两次输入不一致！"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(loginCode == <span class="keyword">null</span> || loginCode.trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"验证码不能为空！"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String vCode = (String)request.getSession().getAttribute(<span class="string">"registCode"</span>);</span><br><span class="line">		request.getSession().removeAttribute(<span class="string">"registCode"</span>);</span><br><span class="line">		<span class="keyword">if</span>(!vCode.equalsIgnoreCase(loginCode)) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"验证码错误！"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			userService.regist(user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UserException e) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, e.getMessage());</span><br><span class="line">			request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/regist.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LoginServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">		String loginCode = request.getParameter(<span class="string">"loginCode"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(username == <span class="keyword">null</span> || username.trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"用户名不能为空!"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(password == <span class="keyword">null</span> || password.trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"密码不能为空!"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(loginCode == <span class="keyword">null</span> || loginCode.trim().isEmpty()) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"验证码不能为空！"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String vCode = (String)request.getSession().getAttribute(<span class="string">"loginCode"</span>);</span><br><span class="line">		request.getSession().removeAttribute(<span class="string">"loginCode"</span>);</span><br><span class="line">		<span class="keyword">if</span>(!vCode.equalsIgnoreCase(loginCode)) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, <span class="string">"验证码错误！"</span>);</span><br><span class="line">			request.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">		User user;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			user = userService.login(username, password);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UserException e) &#123;</span><br><span class="line">			request.setAttribute(<span class="string">"msg"</span>, e.getMessage());</span><br><span class="line">			request.setAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/login.jsp"</span>).forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;	</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		request.getSession().setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">		request.getRequestDispatcher(<span class="string">"/index.jsp"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// QuitServlet.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuitServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 使session失效</span></span><br><span class="line">		request.getSession().invalidate();</span><br><span class="line">		response.sendRedirect(request.getContextPath() + <span class="string">"/index.jsp"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserException.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(message, cause);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(message);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(cause);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDao();</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> UserException </span>&#123;</span><br><span class="line">		User user = userDao.findByUsername(username);</span><br><span class="line">		<span class="keyword">if</span>(user == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> UserException(<span class="string">"用户名错误！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!user.getPassword().equals(password)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> UserException(<span class="string">"密码错误！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">regist</span><span class="params">(User user)</span> <span class="keyword">throws</span> UserException </span>&#123;</span><br><span class="line">		User _user = userDao.findByUsername(user.getUsername());</span><br><span class="line">		<span class="keyword">if</span>(_user != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> UserException(<span class="string">"用户名已注册！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		userDao.add(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserDao.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String path;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		path = <span class="keyword">this</span>.getClass().getResource(<span class="string">"/users.xml"</span>).getPath();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">			Document doc = reader.read(path);</span><br><span class="line">			</span><br><span class="line">			Element root = doc.getRootElement();</span><br><span class="line">			Element userEle = root.addElement(<span class="string">"user"</span>);</span><br><span class="line">			userEle.addAttribute(<span class="string">"username"</span>, user.getUsername());</span><br><span class="line">			userEle.addAttribute(<span class="string">"password"</span>, user.getPassword());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 创建格式化器，使用\t缩进，添加换行</span></span><br><span class="line">			OutputFormat format = <span class="keyword">new</span> OutputFormat(<span class="string">"\t"</span>, <span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">// 清空数据中原有的换行</span></span><br><span class="line">			format.setTrimText(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">// 创建XML输出流对象</span></span><br><span class="line">			XMLWriter writer = <span class="keyword">new</span> XMLWriter(<span class="keyword">new</span> FileWriter(path), format);</span><br><span class="line">			<span class="comment">// 输出Document</span></span><br><span class="line">			writer.write(doc);</span><br><span class="line">			<span class="comment">// 关闭流</span></span><br><span class="line">			writer.close();</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">			Document doc = reader.read(path);</span><br><span class="line">			Element ele = (Element) doc.selectSingleNode(<span class="string">"//user[@username='"</span> + username + <span class="string">"']"</span>);</span><br><span class="line">			<span class="keyword">if</span>(ele == <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			User user = <span class="keyword">new</span> User();</span><br><span class="line">			user.setUsername(ele.attributeValue(<span class="string">"username"</span>));</span><br><span class="line">			user.setPassword(ele.attributeValue(<span class="string">"password"</span>));</span><br><span class="line">			<span class="keyword">return</span> user;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p>在这里呢小结一下，对于之前这么多天的学习，对JavaWeb有了一个初步的了解，例如Servlet、Tomcat、jsp、xml等相关都有了一定的认识，但是还不够深入，对于某些基础的东西还不够了解，所以在这里这个部分的学习就先告一段落了，之后的学习则是从b站上进行更基础更细节的学习了，整理的东西也不会太多了。在那上面学习完成之后，还会在这里继续之前没完成的数据库部分，因为本人已经在大学中学习了数据库这门课了，所以对于这部分之后的内容就先不做延申了，之后会来补上。</p>
<p>b站的学习相关博文则会在本博客新开一篇来更新。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%87%AA%E5%AD%A6%E6%80%BB%E7%BB%93/" rel="tag"># 自学总结</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/27/%C2%96%E7%AE%97%E6%B3%95%E8%AE%B0%E5%BD%95/" rel="prev" title="算法记录">
      <i class="fa fa-chevron-left"></i> 算法记录
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/03/JavaWeb/" rel="next" title="JavaWeb">
      JavaWeb <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JavaWeb初探"><span class="nav-number">1.</span> <span class="nav-text">JavaWeb初探</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-01"><span class="nav-number">1.1.</span> <span class="nav-text">Day 01</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JAVA反射"><span class="nav-number">1.1.1.</span> <span class="nav-text">JAVA反射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获取Class实例："><span class="nav-number">1.1.1.1.</span> <span class="nav-text">获取Class实例：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问字段"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">访问字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取方法"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">获取方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调用构造方法"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">调用构造方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取继承关系"><span class="nav-number">1.1.1.5.</span> <span class="nav-text">获取继承关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态代理"><span class="nav-number">1.1.1.6.</span> <span class="nav-text">动态代理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-02"><span class="nav-number">1.2.</span> <span class="nav-text">Day 02</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XML"><span class="nav-number">1.2.1.</span> <span class="nav-text">XML</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#XML语法"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">XML语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DTD"><span class="nav-number">1.2.2.</span> <span class="nav-text">DTD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分类"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DTD语法"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">DTD语法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#定义元素"><span class="nav-number">1.2.2.2.1.</span> <span class="nav-text">定义元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#定义属性"><span class="nav-number">1.2.2.2.2.</span> <span class="nav-text">定义属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#定义实体"><span class="nav-number">1.2.2.2.3.</span> <span class="nav-text">定义实体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema"><span class="nav-number">1.2.3.</span> <span class="nav-text">Schema</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#schema名称空间"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">schema名称空间</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#目标名称空间"><span class="nav-number">1.2.3.1.1.</span> <span class="nav-text">目标名称空间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML指定XSD文件"><span class="nav-number">1.2.3.1.2.</span> <span class="nav-text">XML指定XSD文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#定义名称空间"><span class="nav-number">1.2.3.1.3.</span> <span class="nav-text">定义名称空间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#默认名称空间"><span class="nav-number">1.2.3.1.4.</span> <span class="nav-text">默认名称空间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#W3C的元素和属性"><span class="nav-number">1.2.3.1.5.</span> <span class="nav-text">W3C的元素和属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XML解析器"><span class="nav-number">1.2.4.</span> <span class="nav-text">XML解析器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM-and-SAX-简介"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">DOM and SAX 简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM-和-SAX-解析"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">DOM 和 SAX 解析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JAXP-DOM"><span class="nav-number">1.2.4.2.1.</span> <span class="nav-text">JAXP-DOM</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JAXP-SAX"><span class="nav-number">1.2.4.2.2.</span> <span class="nav-text">JAXP-SAX</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM4j-解析"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">DOM4j 解析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#读取、保存、创建Document"><span class="nav-number">1.2.4.3.1.</span> <span class="nav-text">读取、保存、创建Document</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DOM4j-API-介绍"><span class="nav-number">1.2.4.3.2.</span> <span class="nav-text">DOM4j API 介绍</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-03"><span class="nav-number">1.3.</span> <span class="nav-text">Day 03</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#C-S"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">C/S</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-S"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">B/S</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tomcat"><span class="nav-number">1.3.1.</span> <span class="nav-text">Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web-应用"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">Web 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#静态应用"><span class="nav-number">1.3.1.1.1.</span> <span class="nav-text">静态应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#动态应用"><span class="nav-number">1.3.1.1.2.</span> <span class="nav-text">动态应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置外部应用"><span class="nav-number">1.3.1.1.3.</span> <span class="nav-text">配置外部应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#server-xml"><span class="nav-number">1.3.1.1.4.</span> <span class="nav-text">server.xml</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#映射虚拟主机"><span class="nav-number">1.3.1.1.5.</span> <span class="nav-text">映射虚拟主机</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-协议"><span class="nav-number">1.3.2.</span> <span class="nav-text">HTTP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#URL-和-URI"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">URL 和 URI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#请求协议"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">请求协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#响应协议"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">响应协议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-04"><span class="nav-number">1.4.</span> <span class="nav-text">Day 04</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet"><span class="nav-number">1.4.1.</span> <span class="nav-text">Servlet</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实现Servlet的方式"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">实现Servlet的方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建应用"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">创建应用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet接口"><span class="nav-number">1.4.2.</span> <span class="nav-text">Servlet接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Servlet-的生命周期"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">Servlet 的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#init"><span class="nav-number">1.4.2.1.1.</span> <span class="nav-text">init</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#service"><span class="nav-number">1.4.2.1.2.</span> <span class="nav-text">service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#destroy"><span class="nav-number">1.4.2.1.3.</span> <span class="nav-text">destroy</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Servlet-接口相关类型"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">Servlet 接口相关类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ServletRequest和ServletResponse"><span class="nav-number">1.4.2.2.1.</span> <span class="nav-text">ServletRequest和ServletResponse</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ServletConfig"><span class="nav-number">1.4.2.2.2.</span> <span class="nav-text">ServletConfig</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GenericServlet"><span class="nav-number">1.4.3.</span> <span class="nav-text">GenericServlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HttpServlet"><span class="nav-number">1.4.4.</span> <span class="nav-text">HttpServlet</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#doGet-和doPost"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">doGet()和doPost()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet-细节"><span class="nav-number">1.4.5.</span> <span class="nav-text">Servlet 细节</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Servlet与线程安全"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">Servlet与线程安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#让服务器在启动时就创建Servlet"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">让服务器在启动时就创建Servlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-url-pattern-gt"><span class="nav-number">1.4.5.3.</span> <span class="nav-text">&lt;url-pattern&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web-xml文件的继承（了解）"><span class="nav-number">1.4.5.4.</span> <span class="nav-text">web.xml文件的继承（了解）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ServletContext"><span class="nav-number">1.4.6.</span> <span class="nav-text">ServletContext</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获取ServletContext"><span class="nav-number">1.4.6.1.</span> <span class="nav-text">获取ServletContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#域对象的功能"><span class="nav-number">1.4.6.2.</span> <span class="nav-text">域对象的功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取应用初始化参数"><span class="nav-number">1.4.6.3.</span> <span class="nav-text">获取应用初始化参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取资源相关方法"><span class="nav-number">1.4.6.4.</span> <span class="nav-text">获取资源相关方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取真实路径"><span class="nav-number">1.4.6.4.1.</span> <span class="nav-text">获取真实路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取资源流"><span class="nav-number">1.4.6.4.2.</span> <span class="nav-text">获取资源流</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取指定目录下所有资源路径"><span class="nav-number">1.4.6.4.3.</span> <span class="nav-text">获取指定目录下所有资源路径</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问量统计"><span class="nav-number">1.4.6.5.</span> <span class="nav-text">访问量统计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取类路径资源"><span class="nav-number">1.4.7.</span> <span class="nav-text">获取类路径资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-05"><span class="nav-number">1.5.</span> <span class="nav-text">Day 05</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#response"><span class="nav-number">1.5.1.</span> <span class="nav-text">response</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#响应正文"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">响应正文</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#字符流"><span class="nav-number">1.5.1.1.1.</span> <span class="nav-text">字符流</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置响应头"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">设置响应头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置状态码及其他方法"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">设置状态码及其他方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重定向"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">重定向</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#更便捷的重定向"><span class="nav-number">1.5.1.4.1.</span> <span class="nav-text">更便捷的重定向</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#小结"><span class="nav-number">1.5.1.4.2.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#request"><span class="nav-number">1.5.2.</span> <span class="nav-text">request</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#域方法"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">域方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#request获取请求头数据"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">request获取请求头数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#request其他方法"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">request其他方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#request获取请求参数"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">request获取请求参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#请求转发与请求包含"><span class="nav-number">1.5.2.5.</span> <span class="nav-text">请求转发与请求包含</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#请求转发"><span class="nav-number">1.5.2.5.1.</span> <span class="nav-text">请求转发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求包含"><span class="nav-number">1.5.2.5.2.</span> <span class="nav-text">请求包含</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求转发与请求包含比较"><span class="nav-number">1.5.2.5.3.</span> <span class="nav-text">请求转发与请求包含比较</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求转发与重定向比较"><span class="nav-number">1.5.2.5.4.</span> <span class="nav-text">请求转发与重定向比较</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路径"><span class="nav-number">1.5.3.</span> <span class="nav-text">路径</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端路径"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">客户端路径</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#建议使用”-“"><span class="nav-number">1.5.3.1.1.</span> <span class="nav-text">建议使用”/“</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务器端路径"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">服务器端路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-url-pattern-gt-路径"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">&lt;url-pattern&gt;路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ServletContext获取资源"><span class="nav-number">1.5.3.4.</span> <span class="nav-text">ServletContext获取资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class获取资源"><span class="nav-number">1.5.3.5.</span> <span class="nav-text">Class获取资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ClassLoader获取资源"><span class="nav-number">1.5.3.6.</span> <span class="nav-text">ClassLoader获取资源</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编码"><span class="nav-number">1.5.4.</span> <span class="nav-text">编码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#请求编码"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">请求编码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#直接在地址栏中给出中文"><span class="nav-number">1.5.4.1.1.</span> <span class="nav-text">直接在地址栏中给出中文</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在页面中发出请求"><span class="nav-number">1.5.4.1.2.</span> <span class="nav-text">在页面中发出请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GET请求解读编码"><span class="nav-number">1.5.4.1.3.</span> <span class="nav-text">GET请求解读编码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#POST请求解读编码"><span class="nav-number">1.5.4.1.4.</span> <span class="nav-text">POST请求解读编码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#响应编码"><span class="nav-number">1.5.4.2.</span> <span class="nav-text">响应编码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URL编码"><span class="nav-number">1.5.4.3.</span> <span class="nav-text">URL编码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-06"><span class="nav-number">1.6.</span> <span class="nav-text">Day 06</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP"><span class="nav-number">1.6.1.</span> <span class="nav-text">JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP语法"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">JSP语法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP-脚本"><span class="nav-number">1.6.1.1.1.</span> <span class="nav-text">JSP 脚本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#内置对象-out"><span class="nav-number">1.6.1.1.2.</span> <span class="nav-text">内置对象 out</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多个-lt-gt-可以通用"><span class="nav-number">1.6.1.1.3.</span> <span class="nav-text">多个&lt;%...%&gt;可以通用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP-原理"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">JSP 原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP真身存放目录"><span class="nav-number">1.6.1.2.1.</span> <span class="nav-text">JSP真身存放目录</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP脚本"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">JSP脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP注释"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">JSP注释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#会话跟踪技术"><span class="nav-number">1.6.2.</span> <span class="nav-text">会话跟踪技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是会话跟踪技术"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">什么是会话跟踪技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#会话路径技术使用Cookie或session完成"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">会话路径技术使用Cookie或session完成</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie"><span class="nav-number">1.6.3.</span> <span class="nav-text">Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie概述"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">Cookie概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie规范"><span class="nav-number">1.6.3.1.1.</span> <span class="nav-text">Cookie规范</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie与HTTP头"><span class="nav-number">1.6.3.1.2.</span> <span class="nav-text">Cookie与HTTP头</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie的覆盖"><span class="nav-number">1.6.3.1.3.</span> <span class="nav-text">Cookie的覆盖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie第一例"><span class="nav-number">1.6.3.1.4.</span> <span class="nav-text">Cookie第一例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-生命"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">Cookie 生命</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是Cookie的生命"><span class="nav-number">1.6.3.2.1.</span> <span class="nav-text">什么是Cookie的生命</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#案例：显示上次访问时间"><span class="nav-number">1.6.3.2.2.</span> <span class="nav-text">案例：显示上次访问时间</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie的path"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">Cookie的path</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是Cookie的路径"><span class="nav-number">1.6.3.3.1.</span> <span class="nav-text">什么是Cookie的路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie路径与请求路径的关系"><span class="nav-number">1.6.3.3.2.</span> <span class="nav-text">Cookie路径与请求路径的关系</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#设置Cookie的路径"><span class="nav-number">1.6.3.3.3.</span> <span class="nav-text">设置Cookie的路径</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie的domain"><span class="nav-number">1.6.3.4.</span> <span class="nav-text">Cookie的domain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie保存中文"><span class="nav-number">1.6.3.5.</span> <span class="nav-text">Cookie保存中文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#显示曾经浏览过的商品"><span class="nav-number">1.6.3.6.</span> <span class="nav-text">显示曾经浏览过的商品</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HttpSession"><span class="nav-number">1.6.4.</span> <span class="nav-text">HttpSession</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpSession概述"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">HttpSession概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取HttpSession对象"><span class="nav-number">1.6.4.1.1.</span> <span class="nav-text">获取HttpSession对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HttpSession是域对象"><span class="nav-number">1.6.4.1.2.</span> <span class="nav-text">HttpSession是域对象</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#登录案例"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">登录案例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session的实现原理"><span class="nav-number">1.6.4.3.</span> <span class="nav-text">session的实现原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session与浏览器"><span class="nav-number">1.6.4.4.</span> <span class="nav-text">session与浏览器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session其他常用API"><span class="nav-number">1.6.4.5.</span> <span class="nav-text">session其他常用API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URL重写"><span class="nav-number">1.6.4.6.</span> <span class="nav-text">URL重写</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例：一次性图片验证码"><span class="nav-number">1.6.5.</span> <span class="nav-text">案例：一次性图片验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#验证码有啥用"><span class="nav-number">1.6.5.1.</span> <span class="nav-text">验证码有啥用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VerifyCode类"><span class="nav-number">1.6.5.2.</span> <span class="nav-text">VerifyCode类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在页面中显示动态图片"><span class="nav-number">1.6.5.3.</span> <span class="nav-text">在页面中显示动态图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在注册页面中使用验证码"><span class="nav-number">1.6.5.4.</span> <span class="nav-text">在注册页面中使用验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RegistServlet"><span class="nav-number">1.6.5.5.</span> <span class="nav-text">RegistServlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结验证码案例"><span class="nav-number">1.6.5.6.</span> <span class="nav-text">总结验证码案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-07"><span class="nav-number">1.7.</span> <span class="nav-text">Day 07</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP-指令"><span class="nav-number">1.7.1.</span> <span class="nav-text">JSP 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#page-指令"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">page 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的pageEncoding和contentType（重点）"><span class="nav-number">1.7.1.1.1.</span> <span class="nav-text">page指令的pageEncoding和contentType（重点）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的import属性"><span class="nav-number">1.7.1.1.2.</span> <span class="nav-text">page指令的import属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的errorPage和isErrorPage"><span class="nav-number">1.7.1.1.3.</span> <span class="nav-text">page指令的errorPage和isErrorPage</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#web-xml中配置错误页面"><span class="nav-number">1.7.1.1.3.1.</span> <span class="nav-text">web.xml中配置错误页面</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的authFlush和buffer"><span class="nav-number">1.7.1.1.4.</span> <span class="nav-text">page指令的authFlush和buffer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的isELIgnored"><span class="nav-number">1.7.1.1.5.</span> <span class="nav-text">page指令的isELIgnored</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#page指令的其他属性"><span class="nav-number">1.7.1.1.6.</span> <span class="nav-text">page指令的其他属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-jsp-config-gt-（了解）"><span class="nav-number">1.7.1.1.7.</span> <span class="nav-text">&lt;jsp-config&gt;（了解）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#include指令"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">include指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#taglib指令"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">taglib指令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP-九大内置对象"><span class="nav-number">1.7.2.</span> <span class="nav-text">JSP 九大内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是JSP九大内置对象"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">什么是JSP九大内置对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过”真身”来对照JSP"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">通过”真身”来对照JSP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pageContext对象"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">pageContext对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#域对象功能"><span class="nav-number">1.7.2.3.1.</span> <span class="nav-text">域对象功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#代理其它域对象功能"><span class="nav-number">1.7.2.3.2.</span> <span class="nav-text">代理其它域对象功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取其他内置对象"><span class="nav-number">1.7.2.3.3.</span> <span class="nav-text">获取其他内置对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP-动作标签"><span class="nav-number">1.7.3.</span> <span class="nav-text">JSP 动作标签</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP动作标签概述"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">JSP动作标签概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-jsp-include-gt"><span class="nav-number">1.7.3.2.</span> <span class="nav-text">&lt;jsp:include&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-jsp-forward-gt"><span class="nav-number">1.7.3.3.</span> <span class="nav-text">&lt;jsp:forward&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-jsp-param-gt"><span class="nav-number">1.7.3.4.</span> <span class="nav-text">&lt;jsp:param&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaBean"><span class="nav-number">1.7.4.</span> <span class="nav-text">JavaBean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaBean概述"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">JavaBean概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是JavaBean"><span class="nav-number">1.7.4.1.1.</span> <span class="nav-text">什么是JavaBean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JavaBean属性"><span class="nav-number">1.7.4.1.2.</span> <span class="nav-text">JavaBean属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内省（了解）"><span class="nav-number">1.7.4.2.</span> <span class="nav-text">内省（了解）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#内省之获取BeanInfo"><span class="nav-number">1.7.4.2.1.</span> <span class="nav-text">内省之获取BeanInfo</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#得到所有属性描述符（PropertyDescriptor）"><span class="nav-number">1.7.4.2.2.</span> <span class="nav-text">得到所有属性描述符（PropertyDescriptor）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#完成Map数据封装到User对象中"><span class="nav-number">1.7.4.2.3.</span> <span class="nav-text">完成Map数据封装到User对象中</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#commons-beanutils"><span class="nav-number">1.7.4.3.</span> <span class="nav-text">commons-beanutils</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#设置JavaBean属性"><span class="nav-number">1.7.4.3.1.</span> <span class="nav-text">设置JavaBean属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取JavaBean属性"><span class="nav-number">1.7.4.3.2.</span> <span class="nav-text">获取JavaBean属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#封装Map数据到JavaBean对象中"><span class="nav-number">1.7.4.3.3.</span> <span class="nav-text">封装Map数据到JavaBean对象中</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSP与JavaBean相关的动作标签"><span class="nav-number">1.7.4.4.</span> <span class="nav-text">JSP与JavaBean相关的动作标签</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-jsp-useBean-gt"><span class="nav-number">1.7.4.4.1.</span> <span class="nav-text">&lt;jsp:useBean&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-jsp-setProperty-gt-和-lt-jsp-getProperty-gt"><span class="nav-number">1.7.4.4.2.</span> <span class="nav-text">&lt;jsp:setProperty&gt;和&lt;jsp:getProperty&gt;</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EL（表达式语言）"><span class="nav-number">1.7.5.</span> <span class="nav-text">EL（表达式语言）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#EL概述"><span class="nav-number">1.7.5.1.</span> <span class="nav-text">EL概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#EL的作用"><span class="nav-number">1.7.5.1.1.</span> <span class="nav-text">EL的作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#EL的格式"><span class="nav-number">1.7.5.1.2.</span> <span class="nav-text">EL的格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关闭EL"><span class="nav-number">1.7.5.1.3.</span> <span class="nav-text">关闭EL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#EL运算符"><span class="nav-number">1.7.5.1.4.</span> <span class="nav-text">EL运算符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#EL不显示null"><span class="nav-number">1.7.5.1.5.</span> <span class="nav-text">EL不显示null</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EL表达式格式"><span class="nav-number">1.7.5.2.</span> <span class="nav-text">EL表达式格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EL内置对象"><span class="nav-number">1.7.5.3.</span> <span class="nav-text">EL内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#域相关内置对象（重点）"><span class="nav-number">1.7.5.3.1.</span> <span class="nav-text">域相关内置对象（重点）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求参数相关内置对象"><span class="nav-number">1.7.5.3.2.</span> <span class="nav-text">请求参数相关内置对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求头相关内置对象"><span class="nav-number">1.7.5.3.3.</span> <span class="nav-text">请求头相关内置对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#应用初始化参数相关内置对象"><span class="nav-number">1.7.5.3.4.</span> <span class="nav-text">应用初始化参数相关内置对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie相关内置对象"><span class="nav-number">1.7.5.3.5.</span> <span class="nav-text">Cookie相关内置对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pageContext对象-1"><span class="nav-number">1.7.5.3.6.</span> <span class="nav-text">pageContext对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EL函数库"><span class="nav-number">1.7.6.</span> <span class="nav-text">EL函数库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么EL函数库"><span class="nav-number">1.7.6.1.</span> <span class="nav-text">什么EL函数库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#导入函数库"><span class="nav-number">1.7.6.2.</span> <span class="nav-text">导入函数库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EL函数库介绍"><span class="nav-number">1.7.6.3.</span> <span class="nav-text">EL函数库介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义EL函数库"><span class="nav-number">1.7.6.4.</span> <span class="nav-text">自定义EL函数库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-08"><span class="nav-number">1.8.</span> <span class="nav-text">Day 08</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSTL-标签库"><span class="nav-number">1.8.1.</span> <span class="nav-text">JSTL 标签库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是JSTL"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">什么是JSTL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSTL标签库"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">JSTL标签库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用taglib指令导入标签库"><span class="nav-number">1.8.1.3.</span> <span class="nav-text">使用taglib指令导入标签库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#core标签库常用标签"><span class="nav-number">1.8.1.4.</span> <span class="nav-text">core标签库常用标签</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#out和set"><span class="nav-number">1.8.1.4.1.</span> <span class="nav-text">out和set</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#remove"><span class="nav-number">1.8.1.4.2.</span> <span class="nav-text">remove</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#url"><span class="nav-number">1.8.1.4.3.</span> <span class="nav-text">url</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#if"><span class="nav-number">1.8.1.4.4.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#choose"><span class="nav-number">1.8.1.4.5.</span> <span class="nav-text">choose</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#forEach"><span class="nav-number">1.8.1.4.6.</span> <span class="nav-text">forEach</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fmt标签库常用标签"><span class="nav-number">1.8.1.5.</span> <span class="nav-text">fmt标签库常用标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义标签"><span class="nav-number">1.8.2.</span> <span class="nav-text">自定义标签</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义标签概述"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">自定义标签概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义标签的步骤"><span class="nav-number">1.8.2.1.1.</span> <span class="nav-text">自定义标签的步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleTag接口介绍"><span class="nav-number">1.8.2.1.2.</span> <span class="nav-text">SimpleTag接口介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#标签库描述文件（TLD）"><span class="nav-number">1.8.2.1.3.</span> <span class="nav-text">标签库描述文件（TLD）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用标签"><span class="nav-number">1.8.2.1.4.</span> <span class="nav-text">使用标签</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义标签进阶"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">自定义标签进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#继承SimpleTagSupport"><span class="nav-number">1.8.2.2.1.</span> <span class="nav-text">继承SimpleTagSupport</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#有标签体的标签"><span class="nav-number">1.8.2.2.2.</span> <span class="nav-text">有标签体的标签</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#不执行标签下面的页面内容"><span class="nav-number">1.8.2.2.3.</span> <span class="nav-text">不执行标签下面的页面内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#带有属性的标签"><span class="nav-number">1.8.2.2.4.</span> <span class="nav-text">带有属性的标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC"><span class="nav-number">1.8.3.</span> <span class="nav-text">MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MVC设计模式"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">MVC设计模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaWeb与MVC"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">JavaWeb与MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP-Model1第一代"><span class="nav-number">1.8.3.2.1.</span> <span class="nav-text">JSP Model1第一代</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP-Model1第二代"><span class="nav-number">1.8.3.2.2.</span> <span class="nav-text">JSP Model1第二代</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP-Model2"><span class="nav-number">1.8.3.2.3.</span> <span class="nav-text">JSP Model2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaWeb三层框架"><span class="nav-number">1.8.4.</span> <span class="nav-text">JavaWeb三层框架</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-09"><span class="nav-number">1.9.</span> <span class="nav-text">Day 09</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#案例-用户注册登录"><span class="nav-number">1.9.1.</span> <span class="nav-text">案例 用户注册登录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#功能分析"><span class="nav-number">1.9.1.1.</span> <span class="nav-text">功能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JSP页面"><span class="nav-number">1.9.1.1.1.</span> <span class="nav-text">JSP页面</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实体类"><span class="nav-number">1.9.1.1.2.</span> <span class="nav-text">实体类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Servlet-1"><span class="nav-number">1.9.1.1.3.</span> <span class="nav-text">Servlet</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Service"><span class="nav-number">1.9.1.1.4.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DAO"><span class="nav-number">1.9.1.1.5.</span> <span class="nav-text">DAO</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#流程图"><span class="nav-number">1.9.1.2.</span> <span class="nav-text">流程图</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#注册"><span class="nav-number">1.9.1.2.1.</span> <span class="nav-text">注册</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#登录"><span class="nav-number">1.9.1.2.2.</span> <span class="nav-text">登录</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代码"><span class="nav-number">1.9.1.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-1"><span class="nav-number">1.10.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Bcutty Kmy</p>
  <div class="site-description" itemprop="description">NO DEPENDENCE ONLY PRIDE</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bcutty Kmy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"2z9X7Dx6RjzhCEydcpBXNAF5-gzGzoHsz","app_key":"d4qtySNKtCjyy1f975pQrdgB","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '2z9X7Dx6RjzhCEydcpBXNAF5-gzGzoHsz',
      appKey     : 'd4qtySNKtCjyy1f975pQrdgB',
      placeholder: "Please leave your comments here.",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
